import{u as E,a4 as H,r as o,j as e,as as L,S as r,at as s,au as l,l as a,D as d,A as R,T as P,I as B,E as k,av as F,B as c,aw as j,ax as N,y as x,ay as b,a as q,az as Y,aA as U,M as V}from"./index-CeqpX1Nb.js";import{u as G}from"./useClient-BnfOapIz.js";import{f as p,a as m}from"./date-Cygk3yQx.js";import{f as h}from"./phone-CUaemfYv.js";import{M as J}from"./MoreVert-2tfujLn5.js";import{E as K}from"./Edit-DmtXJ-nr.js";import{C as Q,H as X}from"./History-BFPC7bZh.js";import{P as Z}from"./Phone-C3wTJmHb.js";import{P as ee}from"./Place-WwDqjt_j.js";const ce=()=>{const g=E(),{role:C}=H(),{findAllClients:y,deleteClient:D}=G(),{data:S,isLoading:w}=y,[v,_]=o.useState({isOpen:!1,clientId:null}),M=i=>{_({isOpen:!0,clientId:i})},f=()=>{_({isOpen:!1,clientId:null})},W=()=>new Promise((i,u)=>{v.clientId?D.mutateAsync({clientId:v.clientId}).then(()=>{f(),i()}).catch(()=>{f(),u()}):(f(),u())}),T=o.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:i})=>e.jsx(L,{to:`/client/${i.id}`,children:i.name})},{id:"created_by_user",label:"Criado por",align:"left",sortable:!1,renderComponent:({row:i})=>e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(s,{alt:i.created_by_user.username,src:`${l}/users/${i.created_by_user.id}/avatar?size=80`,name:i.created_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:i.created_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:i.created_by_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:p(i.created_at_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:m(i.created_at_datetime)})]})]})},{id:"last_modified_by_user",label:"Modificado pela última vez por",align:"left",sortable:!1,renderComponent:({row:i})=>e.jsx(e.Fragment,{children:i.last_modified_by_user?e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(s,{alt:i.last_modified_by_user.username,src:`${l}/users/${i.last_modified_by_user.id}/avatar?size=80`,name:i.last_modified_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:i.last_modified_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:i.last_modified_by_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:p(i.last_modified_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:m(i.last_modified_datetime)})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})},{id:"moreOptions",align:"right",sortable:!1,renderComponent:({row:i})=>e.jsx(R,{mode:"custom",customButton:e.jsx(P,{title:"Mais opções",placement:"bottom",sx:{margin:-1},children:e.jsx(B,{children:e.jsx(J,{})})}),children:e.jsx(k,{buttons:[{label:"Editar",icon:e.jsx(K,{fontSize:"small"}),onClick:()=>g(`/client/${i.id}`)},{label:"Eliminar",icon:e.jsx(F,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>M(i.id)}]})})}],[]),O=o.useMemo(()=>({row:i})=>{const u=o.useMemo(()=>[{id:"type",label:"Tipo",align:"left",sortable:!0},{id:"contact",label:"Contacto",align:"left",sortable:!0,formatter:h},{id:"created_by_user",label:"Criado por",align:"left",sortable:!1,renderComponent:({row:t})=>e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(s,{alt:t.created_by_user.username,src:`${l}/users/${t.created_by_user.id}/avatar?size=80`,name:t.created_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:t.created_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:t.created_by_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:p(t.created_at_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:m(t.created_at_datetime)})]})]})},{id:"last_modified_by_user",label:"Modificado pela última vez por",align:"left",sortable:!1,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:t.last_modified_by_user?e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(s,{alt:t.last_modified_by_user.username,src:`${l}/users/${t.last_modified_by_user.id}/avatar?size=80`,name:t.last_modified_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:t.last_modified_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:t.last_modified_by_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:p(t.last_modified_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:m(t.last_modified_datetime)})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}],[]),I=o.useMemo(()=>[{id:"country",label:"País",align:"left",sortable:!0},{id:"city",label:"Cidade",align:"left",sortable:!0},{id:"locality",label:"Localidade",align:"left",sortable:!0},{id:"address",label:"Morada",align:"left",sortable:!0},{id:"postal_code",label:"Código postal",align:"left",sortable:!0},{id:"created_by_user",label:"Criado por",align:"left",sortable:!1,renderComponent:({row:t})=>e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(s,{alt:t.created_by_user.username,src:`${l}/users/${t.created_by_user.id}/avatar?size=80`,name:t.created_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:t.created_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:t.created_by_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:p(t.created_at_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:m(t.created_at_datetime)})]})]})},{id:"last_modified_by_user",label:"Modificado pela última vez por",align:"left",sortable:!1,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:t.last_modified_by_user?e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(s,{alt:t.last_modified_by_user.username,src:`${l}/users/${t.last_modified_by_user.id}/avatar?size=80`,name:t.last_modified_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:t.last_modified_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:t.last_modified_by_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:p(t.last_modified_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:m(t.last_modified_datetime)})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}],[]),$=o.useMemo(()=>[{id:"type",label:"Atividade",align:"left",sortable:!0},{id:"responsible_user",label:"Responsável",align:"left",sortable:!1,renderComponent:({row:t})=>e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(s,{alt:t.responsible_user.username,src:`${l}/users/${t.responsible_user.id}/avatar?size=80`,name:t.responsible_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:t.responsible_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:t.responsible_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:p(t.created_at_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:m(t.created_at_datetime)})]})]})}],[]),A=o.useMemo(()=>({row:t})=>{const z=o.useMemo(()=>[{id:"field",label:"Campo",align:"left",sortable:!0},{id:"before",label:"Antes",align:"left",sortable:!0,renderComponent:({row:n})=>n.field==="Descrição"&&n.before?e.jsx(c,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:e.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:j(n.before)})}):n.field==="Contacto"&&n.before?h(n.before):n.before?n.before:e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"after",label:"Depois",align:"left",sortable:!0,renderComponent:({row:n})=>n.field==="Descrição"&&n.after?e.jsx(c,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:e.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:j(n.after)})}):n.field==="Contacto"&&n.after?h(n.after):n.after?n.after:e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"changed",label:"Alterado",align:"left",sortable:!0,renderComponent:({row:n})=>e.jsx(e.Fragment,{children:n.changed?e.jsx(Q,{color:"success"}):e.jsx(N,{color:"error"})})}],[]);return e.jsx(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden",margin:3},children:e.jsx(x,{data:t.details??[],columns:z})})},[]);return e.jsxs(r,{sx:{margin:3,gap:3},children:[e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(b,{title:"Contactos",description:"Contactos do cliente",icon:e.jsx(Z,{})}),e.jsx(x,{mode:"datatable",data:i.contacts??[],columns:u})]}),e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(b,{title:"Moradas",description:"Moradas do cliente",icon:e.jsx(ee,{})}),e.jsx(x,{mode:"datatable",data:i.addresses??[],columns:I})]}),C!=="Funcionário"&&e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(b,{title:"Histórico de Atividades",description:"Histórico de atividades sobre os clientes",icon:e.jsx(X,{})}),e.jsx(x,{mode:"datatable",data:i.interactions_history??[],columns:$,ExpandableContentComponent:A})]})]})},[]);return e.jsx(q,{elevation:1,children:e.jsxs(c,{sx:{marginTop:3},children:[e.jsx(Y,{isLoading:w,LoadingComponent:e.jsx(U,{mode:"datatable"}),LoadedComponent:e.jsx(x,{mode:"datatable",data:S??[],columns:T,ExpandableContentComponent:O})}),e.jsx(V,{mode:"delete",title:"Eliminar Cliente",open:v.isOpen,onClose:f,onSubmit:W,description:"Tem a certeza que deseja eliminar este cliente?",subDescription:"Ao eliminar este cliente, todos os dados relacionados, incluindo contactos, moradas, equipamentos e reparações associadas, serão removidos de forma permanente."})]})})};export{ce as default};
