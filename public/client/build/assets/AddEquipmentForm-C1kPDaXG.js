import{d as D,r as H,j as e,S as g,f as P,H as U,ay as Q,F as u,T as q,ag as $,aM as z,ah as G,b9 as J,aR as j,a$ as f,aW as C,b3 as K,B as X,L as Y,aU as Z,ba as _,h as ee,b0 as ne,ak as ae,s as te}from"./index-_NktdslD.js";import{u as oe,a as re,C as p,t as se}from"./index-8QsUXVhp.js";import{e as ie}from"./equipment-DMqeKo_-.js";import{u as de}from"./useClient-B8aLe1Fc.js";import{u as le}from"./useEquipment-Dy7ZmQ0L.js";const xe=()=>{var E,S;const T=D(),{control:d,register:M,handleSubmit:w,setValue:b,formState:{errors:r},setError:A}=oe({resolver:se(ie)}),{findAllClients:v}=de(),{findAllEquipmentTypes:y,findAllEquipmentBrands:I,findAllEquipmentModelsByBrandId:k,createNewEquipment:B}=le(),{data:W,isLoading:N,isError:F}=k(re({control:d,name:"brandId"})),[h,x]=H.useState({isOpen:!1,client:{id:null,name:""}}),L=()=>{x(n=>({...n,isOpen:!0}))},O=()=>{x(n=>({...n,isOpen:!1}))},R=(n,a)=>{x({client:{id:n,name:a}}),b("clientId",n)},V=async n=>{await B.mutateAsync({...n,description:n.description===""?null:n.description}).then(()=>{T("/equipment/list"),ae("Equipamento adicionado com sucesso!")}).catch(a=>{if(a.error.code==="EQU-008"){A("sn",{type:"manual",message:"Número de série já existente"});return}te("Erro ao adicionar equipamento!")})};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:w(V),children:e.jsx(g,{sx:{marginTop:3,gap:3},children:e.jsxs(P,{elevation:1,children:[e.jsx(U,{title:"Detalhes",description:"Cliente, tipo, marca, modelo,... do equipamento",icon:e.jsx(Q,{})}),e.jsxs(g,{sx:{padding:3,gap:2},children:[e.jsx(u,{fullWidth:!0,children:e.jsx(q,{label:"Cliente",placeholder:"Selecione um cliente",value:h.client.name,onClick:L,InputProps:{readOnly:!0,startAdornment:e.jsx($,{position:"start",children:e.jsx(z,{children:e.jsx(G,{onClick:L,children:e.jsx(J,{})})})})},error:!!r.clientId,helperText:(E=r.clientId)==null?void 0:E.message})}),e.jsx(j,{isLoading:y.isLoading,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"typeId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=y.data??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Tipo",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||"")},error:!!r.typeId,helperText:(i=r.typeId)==null?void 0:i.message})}})})}),e.jsx(j,{isLoading:I.isLoading,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"brandId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=I.data??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Marca",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||""),b("modelId","")},error:!!r.brandId,helperText:(i=r.brandId)==null?void 0:i.message})}})})}),e.jsx(j,{isLoading:N||F,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"modelId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=W??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Modelo",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||"")},error:!!r.modelId,helperText:(i=r.modelId)==null?void 0:i.message})}})})}),e.jsx(u,{fullWidth:!0,children:e.jsx(q,{...M("sn"),label:"Número de série",error:!!r.sn,helperText:(S=r.sn)==null?void 0:S.message,autoComplete:"off"})}),e.jsx(p,{name:"description",control:d,defaultValue:"",render:({field:n})=>e.jsx(K,{label:"Descrição",value:n.value,onChange:n.onChange,shouldImmediatelyRender:!0})}),e.jsx(X,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(Y,{loading:B.isPending,type:"submit",variant:"contained",children:"Adicionar Equipamento"})})]})]})})}),e.jsx(Z,{open:h.isOpen??!1,onClose:O,mode:"data",data:v.data??[],isLoading:v.isLoading,title:"Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(n,a)=>e.jsx(_,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:n.id===h.client.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{R(n.id,n.name),a()},children:e.jsxs(g,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(ee,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:n.name}),n.description&&e.jsx(ne,{title:n.description})]})})})]})};export{xe as default};
