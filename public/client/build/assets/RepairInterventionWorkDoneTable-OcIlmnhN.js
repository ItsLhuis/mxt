import{r as m,j as a,S as i,b7 as S,h as n,aV as v,aW as f,aE as _,aM as h,aN as b,aF as T,aP as O,ag as L,aQ as B,aG as A,aX as F,aY as j,f as $,B as P,aZ as N,a_ as U,aK as V,a$ as q,aj as G,s as D}from"./index-DJpfvod0.js";import{u as K}from"./useRepair-DQBibyZW.js";import{R as Q}from"./List-D35Y_BUW.js";import{E as X}from"./Edit-CSDBMvJz.js";import"./repair-CTbFyE7G.js";import"./Container-C0eSQIXe.js";import"./Add-Dwyl4Jrm.js";const ne=()=>{const{findAllInterventionWorksDone:W,deleteInterventionWorkDone:k}=K(),{data:g,isLoading:I}=W,[p,x]=m.useState({isOpen:!1,interventionWorkDone:null}),y=e=>{x({isOpen:!0,interventionWorkDone:e})},C=()=>{x({isOpen:!1,interventionWorkDone:null})},[c,u]=m.useState({isOpen:!1,interventionWorkDoneId:null}),E=e=>{u({isOpen:!0,interventionWorkDoneId:e})},s=()=>{u({isOpen:!1,interventionWorkDoneId:null})},z=()=>new Promise((e,t)=>{c.interventionWorkDoneId?k.mutateAsync({interventionWorkDoneId:c.interventionWorkDoneId}).then(()=>{G("Trabalho realizado eliminado com sucesso!"),s(),e()}).catch(o=>{if(o.error.code==="REP-017"){s(),D("Este trabalho realizado está associado a uma ou mais reparações e não pode ser eliminado!",{duration:6e3}),t();return}s(),D("Erro ao eliminar trabalho realizado"),t()}):(s(),t())}),M=m.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsxs(i,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&a.jsx(S,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,o,r,l,d;return a.jsx(a.Fragment,{children:a.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[a.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?a.jsxs(a.Fragment,{children:[a.jsx(v,{alt:(t=e==null?void 0:e.created_by_user)==null?void 0:t.username,src:`${f}/users/${(o=e==null?void 0:e.created_by_user)==null?void 0:o.id}/avatar?size=80`,name:(r=e==null?void 0:e.created_by_user)==null?void 0:r.username}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(n,{variant:"p",component:"p",fontWeight:500,children:(l=e==null?void 0:e.created_by_user)==null?void 0:l.username}),a.jsx(n,{variant:"p",component:"p",color:"var(--outline)",children:(d=e==null?void 0:e.created_by_user)==null?void 0:d.role})]})]}):a.jsx(n,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),a.jsx(_,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(n,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.created_at_datetime)}),a.jsx(n,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,o,r,l,d;return a.jsx(a.Fragment,{children:e!=null&&e.last_modified_datetime?a.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[a.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?a.jsxs(a.Fragment,{children:[a.jsx(v,{alt:(t=e==null?void 0:e.last_modified_by_user)==null?void 0:t.username,src:`${f}/users/${(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.id}/avatar?size=80`,name:(r=e==null?void 0:e.last_modified_by_user)==null?void 0:r.username}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(n,{variant:"p",component:"p",fontWeight:500,children:(l=e==null?void 0:e.last_modified_by_user)==null?void 0:l.username}),a.jsx(n,{variant:"p",component:"p",color:"var(--outline)",children:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.role})]})]}):a.jsx(n,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),a.jsx(_,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(n,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.last_modified_datetime)}),a.jsx(n,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.last_modified_datetime)})]})]}):a.jsx(n,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>a.jsx(T,{mode:"custom",customButton:a.jsx(O,{title:"Mais opções",sx:{margin:-1},children:a.jsx(L,{children:a.jsx(B,{})})}),children:a.jsx(A,{buttons:[{label:"Editar",icon:a.jsx(X,{fontSize:"small"}),onClick:()=>y(e)},{label:"Eliminar",icon:a.jsx(F,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>E(e==null?void 0:e.id)}]})})}],[]),R=m.useMemo(()=>[{id:"name",label:"Trabalho realizado"},{id:"created_by_user.username",label:"Criado por"},{id:"created_at_datetime",label:"Data de criação",formatter:e=>e?j(e):""},{id:"last_modified_by_user.username",label:"Modificado pela última vez por"},{id:"last_modified_datetime",label:"Última data de modificação",formatter:e=>e?j(e):""}],[]);return a.jsx($,{elevation:1,children:a.jsxs(P,{sx:{marginTop:3},children:[a.jsx(N,{isLoading:I,LoadingComponent:a.jsx(U,{mode:"datatable"}),LoadedComponent:a.jsx(V,{mode:"datatable",data:g??[],columns:M,exportFileName:"trabalhos_realizados_reparacao",exportColumns:R})}),a.jsx(Q,{interventionWorkDone:p.interventionWorkDone,open:p.isOpen,onClose:C}),a.jsx(q,{mode:"delete",title:"Eliminar Trabalho Realizado",open:c.isOpen,onClose:s,onSubmit:z,description:"Tem a certeza que deseja eliminar este trabalho realizado?",subDescription:"Ao eliminar este trabalho realizado, os dados serão removidos de forma permanente."})]})})};export{ne as default};
