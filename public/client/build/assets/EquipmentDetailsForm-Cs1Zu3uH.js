import{r as na,j as a,f as da,H as ea,aA as ra,S as ta,aZ as m,b6 as j,F as u,T as R,af as ia,b7 as la,b1 as p,ba as ca,B as ha,L as xa,aj as ga,s as ma}from"./index-DJpfvod0.js";import{u as ja,b as ua,a as fa,C as f,t as pa}from"./index-o_NukjCy.js";import{u as ba}from"./equipment-6gFyHN-s.js";import{u as Ca}from"./useEquipment-c2-M7uo4.js";const va=({equipment:o,isLoading:U,isError:O})=>{var y,E,v,B,S,T,w,A,F,M,W,N,D,P,V,k,z,H;const r=!U&&!O,{control:c,register:Q,handleSubmit:Z,setValue:G,getValues:J,formState:{errors:t},setError:K,reset:X}=ja({resolver:pa(ba)}),Y={typeId:((E=(y=o==null?void 0:o[0])==null?void 0:y.type)==null?void 0:E.id)||"",brandId:((B=(v=o==null?void 0:o[0])==null?void 0:v.brand)==null?void 0:B.id)||"",modelId:((T=(S=o==null?void 0:o[0])==null?void 0:S.model)==null?void 0:T.id)||"",sn:((w=o==null?void 0:o[0])==null?void 0:w.sn)||"",description:((A=o==null?void 0:o[0])==null?void 0:A.description)||""},{isDirty:_}=ua({control:c}),b=()=>!_;na.useEffect(()=>{r&&o&&o[0]&&X(Y)},[r,o]);const{findAllEquipmentTypes:C,findAllEquipmentBrands:L,findAllEquipmentModelsByBrandId:$,updateEquipment:I}=Ca(),{data:q,isLoading:aa,isError:oa}=$(fa({control:c,name:"brandId",defaultValue:(M=(F=o==null?void 0:o[0])==null?void 0:F.brand)==null?void 0:M.id})),sa=async s=>{!r||b()||await I.mutateAsync({equipmentId:o[0].id,...s,description:s.description===""?null:s.description}).then(()=>ga("Equipamento atualizado com sucesso!")).catch(d=>{if(d.error.code==="EQU-008"){K("sn",{type:"manual",message:"Número de série já existente"});return}ma("Erro ao atualizar equipamento!")})};return a.jsxs(da,{elevation:1,children:[a.jsx(ea,{title:"Detalhes",description:"Cliente, tipo, marca, modelo,... do equipamento",icon:a.jsx(ra,{})}),a.jsx("form",{onSubmit:Z(sa),children:a.jsxs(ta,{sx:{padding:3,gap:2},children:[a.jsx(m,{isLoading:!r,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(R,{label:"Cliente",value:(N=(W=o==null?void 0:o[0])==null?void 0:W.client)==null?void 0:N.name,InputProps:{readOnly:!0,endAdornment:a.jsx(ia,{position:"end",children:((P=(D=o==null?void 0:o[0])==null?void 0:D.client)==null?void 0:P.description)&&a.jsx(la,{title:(k=(V=o==null?void 0:o[0])==null?void 0:V.client)==null?void 0:k.description})})}})})}),a.jsx(m,{isLoading:!r||C.isLoading,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(f,{name:"typeId",control:c,render:({field:s})=>{var i,l;const d=C.data??[],h=["",...d.map(n=>n.name)],x=((i=d.find(n=>n.id===s.value))==null?void 0:i.name)||"";return a.jsx(p,{ref:s.ref,label:"Tipo",data:h,value:x,onChange:n=>{const e=d.find(g=>g.name===n);s.onChange((e==null?void 0:e.id)||"")},error:!!t.typeId,helperText:(l=t.typeId)==null?void 0:l.message})}})})}),a.jsx(m,{isLoading:!r||L.isLoading,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(f,{name:"brandId",control:c,render:({field:s})=>{var i,l;const d=L.data??[],h=["",...d.map(n=>n.name)],x=((i=d.find(n=>n.id===s.value))==null?void 0:i.name)||"";return a.jsx(p,{ref:s.ref,label:"Marca",data:h,value:x,onChange:n=>{const e=d.find(g=>g.name===n);s.onChange((e==null?void 0:e.id)||""),G("modelId","")},error:!!t.brandId,helperText:(l=t.brandId)==null?void 0:l.message})}})})}),a.jsx(m,{isLoading:!r||aa&&oa,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(f,{name:"modelId",control:c,render:({field:s})=>{var i,l;const d=q??[],h=["",...d.map(n=>n.name)],x=((i=d.find(n=>n.id===s.value))==null?void 0:i.name)||"";return a.jsx(p,{ref:s.ref,label:"Modelo",data:h,value:x,onChange:n=>{const e=d.find(g=>g.name===n);s.onChange((e==null?void 0:e.id)||"")},error:!!t.modelId,helperText:(l=t.modelId)==null?void 0:l.message})}})})}),a.jsx(m,{isLoading:!r,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(R,{...Q("sn"),label:"Número de série",error:!!t.sn,helperText:(z=t.sn)==null?void 0:z.message,autoComplete:"off",InputLabelProps:{shrink:((H=J("sn"))==null?void 0:H.length)>0}})})}),a.jsx(f,{name:"description",control:c,render:({field:s})=>a.jsx(ca,{label:"Descrição",value:s.value,onChange:s.onChange,isLoading:!r})}),a.jsx(ha,{sx:{marginLeft:"auto",marginTop:1},children:a.jsx(xa,{loading:I.isPending,type:"submit",variant:"contained",disabled:!r||b(),children:"Atualizar Equipamento"})})]})})]})};export{va as default};
