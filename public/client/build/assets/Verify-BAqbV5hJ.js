import{z as Y,a0 as Z,a5 as w,j as o,B as A,a6 as G,u as J,X as Q,Y as S,Z as B,a7 as _,a8 as W,a1 as ee,a2 as te,a3 as ne,a4 as re}from"./index-DjYwzy8o.js";import{c as ae}from"./user-B-uUes6W.js";import{u as oe}from"./useAuth-CoEWSEqt.js";const se=Y(Z)`
  input {
    text-align: center;
  }
`,ie={TextFieldStyled:se},ce=r=>o.jsx(ie.TextFieldStyled,{...r}),F={left:"ArrowLeft",right:"ArrowRight",backspace:"Backspace",home:"Home",end:"End"};function le(r,i){return r<=0?[]:Array.from({length:r},i)}function ue(r,i,d){return r.map((l,y)=>i===y?d:l)}function N(r){return r.join("")}function O(r,i){return[...r,i]}function pe(r,i,d){return r.reduce((l,y,c)=>{const{characters:m,restArrayMerged:u}=l;if(c<d)return{restArrayMerged:u,characters:O(m,y)};const[j,...R]=u;return{restArrayMerged:R,characters:O(m,j||"")}},{restArrayMerged:i,characters:[]}).characters}function fe(r){return r.split("")}function $(r){const i=w.useRef(()=>{throw new Error("Cannot call an event handler while rendering.")});return w.useInsertionEffect(()=>{i.current=r}),w.useCallback((...d)=>{var l;return(l=i.current)==null?void 0:l.call(i,...d)},[])}const de=()=>!0,he=w.forwardRef((r,i)=>{const{value:d="",length:l=4,autoFocus:y=!1,onChange:c,TextFieldsProps:m,onComplete:u,validateChar:j=de,className:R,onBlur:E,...L}=r,z=w.useRef(d),C=$(u),D=$(e=>{const t=e.slice(0,l);return{isCompleted:t.length===l,finalValue:t}});w.useEffect(()=>{const{isCompleted:e,finalValue:t}=D(z.current);e&&C(t)},[l,C,D]);const g=le(l,(e,t)=>({character:d[t]||"",inputRef:w.createRef()})),V=e=>g.findIndex(({inputRef:t})=>t.current===e),I=()=>g.map(({character:e})=>e),M=(e,t)=>{const n=ue(I(),e,t);return N(n)},H=e=>{var t,n;(n=(t=g[e])==null?void 0:t.inputRef.current)==null||n.focus()},f=e=>{var t,n;(n=(t=g[e])==null?void 0:t.inputRef.current)==null||n.select()},P=e=>{e+1!==l&&(g[e+1].character?f(e+1):H(e+1))},b=(e,t)=>typeof j!="function"?!0:j(e,t),K=e=>{const t=V(e.target);if(t===0&&e.target.value.length>1){const{finalValue:v,isCompleted:k}=D(e.target.value);c==null||c(v),k&&(u==null||u(v)),f(v.length-1);return}const n=e.target.value[0]||"";let p=n;p&&!b(p,t)&&(p="");const a=M(t,p);c==null||c(a);const{isCompleted:x,finalValue:h}=D(a);x&&(u==null||u(h)),p!==""?a.length-1<t?f(a.length):P(t):n===""&&a.length<=t&&f(t-1)},U=e=>{const t=e.target,n=t.selectionStart,p=t.selectionEnd,a=V(t),x=n===0&&p===0;if(t.value===e.key)e.preventDefault(),P(a);else if(F.backspace===e.key){if(!t.value)e.preventDefault(),f(a-1);else if(x){e.preventDefault();const h=M(a,"");c==null||c(h),h.length<=a&&f(a-1)}}else F.left===e.key?(e.preventDefault(),f(a-1)):F.right===e.key?(e.preventDefault(),f(a+1)):F.home===e.key?(e.preventDefault(),f(0)):F.end===e.key&&(e.preventDefault(),f(g.length-1))},q=e=>{const t=e.clipboardData.getData("text/plain"),n=e.target,p=g.findIndex(({character:s,inputRef:T})=>s===""||T.current===n),a=I(),x=pe(a,fe(t),p).map((s,T)=>b(s,T)?s:""),h=N(x);c==null||c(h);const{isCompleted:v,finalValue:k}=D(h);v?(u==null||u(k),f(l-1)):f(h.length)},X=e=>{if(!g.some(({inputRef:t})=>t.current===e.relatedTarget)){const{isCompleted:t,finalValue:n}=D(d);E==null||E(n,t)}};return o.jsx(A,{display:"flex",gap:"20px",alignItems:"center",ref:i,className:`MuiOtpInput-Box ${R||""}`,...L,children:g.map(({character:e,inputRef:t},n)=>{const{onPaste:p,onFocus:a,onKeyDown:x,className:h,onBlur:v,...k}=typeof m=="function"?m(n)||{}:m||{};return o.jsx(ce,{autoFocus:y?n===0:!1,autoComplete:"one-time-code",value:e,inputRef:t,className:`MuiOtpInput-TextField MuiOtpInput-TextField-${n+1} ${h||""}`,onPaste:s=>{s.preventDefault(),q(s),p==null||p(s)},onFocus:s=>{s.preventDefault(),s.target.select(),a==null||a(s)},onChange:K,onKeyDown:s=>{U(s),x==null||x(s)},onBlur:s=>{v==null||v(s),X(s)},...k},n)})})}),ve=()=>{const{token:r}=G(),i=J(),{control:d,handleSubmit:l,formState:{errors:y},setError:c}=Q({resolver:ne(ae)}),{verifyResetPassword:m}=oe(),u=async j=>{await m.mutateAsync({token:r,...j}).then(R=>i(`/auth/resetPassword/confirm/${R.token}`)).catch(R=>{if(R.error.code==="USR-013"||R.error.code==="USR-014"){c("otp",{type:"manual",message:"Código inválido ou expirado"});return}re("Erro ao verificar código!")})};return o.jsxs(A,{children:[o.jsx(S,{variant:"h3",component:"h3",sx:{marginBottom:4,fontSize:"2.5rem !important"},children:"Mixtech"}),o.jsx(B,{sx:{gap:2,marginBottom:4},children:o.jsxs(B,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[o.jsx(S,{variant:"h4",component:"h4",children:"Esqueceu a sua senha?"}),o.jsx(S,{variant:"p",component:"p",children:"Digite o código que lhe foi enviado para o e-mail!"})]})}),o.jsx("form",{onSubmit:l(u),children:o.jsxs(B,{sx:{gap:2},children:[o.jsxs(B,{children:[o.jsx(S,{variant:"p",component:"p",sx:{marginBottom:1},children:"Código"}),o.jsx(_,{name:"otp",control:d,render:({field:j})=>o.jsxs(A,{children:[o.jsx(he,{sx:{gap:1},...j,length:6}),!!y.otp&&o.jsx(W,{error:!0,children:y.otp.message})]})})]}),o.jsx(ee,{to:"/auth/login",style:{alignSelf:"flex-end",fontSize:"13px"},children:"Iniciar sessão"}),o.jsx(te,{loading:m.isPending,type:"submit",variant:"contained",children:"Enviar Código"})]})})]})};export{ve as default};
