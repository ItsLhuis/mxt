import{u as A,S as L,r as o,j as e,Z as r,a2 as E,an as g,Y as i,au as s,av as l,aF as d,ab as R,ah as P,ai as U,ac as B,aw as k,B as c,aG as C,aH as N,ae as x,aA as h,a as Y,ax as q,ay as G,az as V}from"./index-BzXGUPkY.js";import{u as Z}from"./useClient-CPTGHj4z.js";import{f as p,a as m}from"./date-UO0O52K_.js";import{f as _}from"./phone-d4Gopd80.js";import{M as J}from"./MoreVert-DdwSIp8d.js";import{E as K}from"./Edit-Djdsgm-9.js";import{C as Q,H as X}from"./History-CZxfx-C7.js";import{P as ee}from"./Phone-Icaa9BFK.js";import{P as te}from"./Place-cPpy2nG_.js";const pe=()=>{const y=A(),{role:b}=L(),{findAllClients:D,deleteClient:S}=Z(),{data:M,isLoading:z}=D,[v,j]=o.useState({isOpen:!1,clientId:null}),W=a=>{j({isOpen:!0,clientId:a})},u=()=>{j({isOpen:!1,clientId:null})},w=()=>new Promise((a,f)=>{v.clientId?S.mutateAsync({clientId:v.clientId}).then(()=>{u(),a()}).catch(()=>{u(),f()}):(u(),f())}),F=o.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:a})=>e.jsxs(r,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(E,{to:`/client/${a.id}`,children:a.name}),a.description&&e.jsx(g,{fontSize:"small",title:a.description,isHtml:!0})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:a})=>e.jsx(e.Fragment,{children:e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsx(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:a.created_by_user?e.jsxs(e.Fragment,{children:[e.jsx(s,{alt:a.created_by_user.username,src:`${l}/users/${a.created_by_user.id}/avatar?size=80`,name:a.created_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:a.created_by_user.username}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:a.created_by_user.role})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:p(a.created_at_datetime)}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:m(a.created_at_datetime)})]})]})})},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:a})=>e.jsx(e.Fragment,{children:a.last_modified_datetime?e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsx(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:a.last_modified_by_user?e.jsxs(e.Fragment,{children:[e.jsx(s,{alt:a.last_modified_by_user.username,src:`${l}/users/${a.last_modified_by_user.id}/avatar?size=80`,name:a.last_modified_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:a.last_modified_by_user.username}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:a.last_modified_by_user.role})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:p(a.last_modified_datetime)}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:m(a.last_modified_datetime)})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:a})=>e.jsx(R,{mode:"custom",customButton:e.jsx(P,{title:"Mais opções",sx:{margin:-1},children:e.jsx(U,{children:e.jsx(J,{})})}),children:e.jsx(B,{buttons:[{label:"Editar",icon:e.jsx(K,{fontSize:"small"}),onClick:()=>y(`/client/${a.id}`)},...b!=="Funcionário"?[{label:"Eliminar",icon:e.jsx(k,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>W(a.id)}]:[]]})})}],[]),I=o.useMemo(()=>({row:a})=>{const f=o.useMemo(()=>[{id:"type",label:"Tipo",align:"left",sortable:!0},{id:"contact",label:"Contacto",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsxs(r,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(e.Fragment,{children:_(t.contact)}),t.description&&e.jsx(g,{fontSize:"small",title:t.description,isHtml:!0})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsx(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:t.created_by_user?e.jsxs(e.Fragment,{children:[e.jsx(s,{alt:t.created_by_user.username,src:`${l}/users/${t.created_by_user.id}/avatar?size=80`,name:t.created_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:t.created_by_user.username}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:t.created_by_user.role})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:p(t.created_at_datetime)}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:m(t.created_at_datetime)})]})]})})},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:t.last_modified_datetime?e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsx(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:t.last_modified_by_user?e.jsxs(e.Fragment,{children:[e.jsx(s,{alt:t.last_modified_by_user.username,src:`${l}/users/${t.last_modified_by_user.id}/avatar?size=80`,name:t.last_modified_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:t.last_modified_by_user.username}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:t.last_modified_by_user.role})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:p(t.last_modified_datetime)}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:m(t.last_modified_datetime)})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}],[]),T=o.useMemo(()=>[{id:"country",label:"País",align:"left",sortable:!0},{id:"city",label:"Cidade",align:"left",sortable:!0},{id:"locality",label:"Localidade",align:"left",sortable:!0},{id:"address",label:"Morada",align:"left",sortable:!0},{id:"postal_code",label:"Código postal",align:"left",sortable:!0},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsx(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:t.created_by_user?e.jsxs(e.Fragment,{children:[e.jsx(s,{alt:t.created_by_user.username,src:`${l}/users/${t.created_by_user.id}/avatar?size=80`,name:t.created_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:t.created_by_user.username}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:t.created_by_user.role})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:p(t.created_at_datetime)}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:m(t.created_at_datetime)})]})]})})},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:t.last_modified_datetime?e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsx(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:t.last_modified_by_user?e.jsxs(e.Fragment,{children:[e.jsx(s,{alt:t.last_modified_by_user.username,src:`${l}/users/${t.last_modified_by_user.id}/avatar?size=80`,name:t.last_modified_by_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:t.last_modified_by_user.username}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:t.last_modified_by_user.role})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:p(t.last_modified_datetime)}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:m(t.last_modified_datetime)})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}],[]),O=o.useMemo(()=>[{id:"type",label:"Atividade",align:"left",sortable:!0},{id:"responsible_user",visible:!1},{id:"created_at_datetime",label:"Responsável",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:e.jsxs(r,{sx:{flexDirection:"row",gap:2},children:[e.jsx(r,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:t.responsible_user?e.jsxs(e.Fragment,{children:[e.jsx(s,{alt:t.responsible_user.username,src:`${l}/users/${t.responsible_user.id}/avatar?size=80`,name:t.responsible_user.username}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:t.responsible_user.username}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:t.responsible_user.role})]})]}):e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(r,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(i,{variant:"p",component:"p",fontWeight:500,children:p(t.created_at_datetime)}),e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:m(t.created_at_datetime)})]})]})})}],[]),H=o.useMemo(()=>({row:t})=>{const $=o.useMemo(()=>[{id:"field",label:"Campo",align:"left",sortable:!0},{id:"before",label:"Antes",align:"left",sortable:!0,renderComponent:({row:n})=>n.field==="Descrição"&&n.before?e.jsx(c,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:e.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:C(n.before)})}):n.field==="Contacto"&&n.before?_(n.before):n.before?n.before:e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"after",label:"Depois",align:"left",sortable:!0,renderComponent:({row:n})=>n.field==="Descrição"&&n.after?e.jsx(c,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:e.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:C(n.after)})}):n.field==="Contacto"&&n.after?_(n.after):n.after?n.after:e.jsx(i,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"changed",label:"Alterado",align:"left",sortable:!0,renderComponent:({row:n})=>e.jsx(e.Fragment,{children:n.changed?e.jsx(Q,{color:"success"}):e.jsx(N,{color:"error"})})}],[]);return e.jsx(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden",margin:3},children:e.jsx(x,{data:t.details??[],columns:$})})},[]);return e.jsxs(r,{sx:{margin:3,gap:3},children:[e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(h,{title:"Contactos",description:"Contactos do cliente",icon:e.jsx(ee,{})}),e.jsx(x,{mode:"datatable",data:a.contacts??[],columns:f})]}),e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(h,{title:"Moradas",description:"Moradas do cliente",icon:e.jsx(te,{})}),e.jsx(x,{mode:"datatable",data:a.addresses??[],columns:T})]}),b!=="Funcionário"&&e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(h,{title:"Histórico de Atividades",description:"Histórico de atividades sobre o cliente",icon:e.jsx(X,{})}),e.jsx(x,{mode:"datatable",data:a.interactions_history??[],columns:O,ExpandableContentComponent:H})]})]})},[]);return e.jsx(Y,{elevation:1,children:e.jsxs(c,{sx:{marginTop:3},children:[e.jsx(q,{isLoading:z,LoadingComponent:e.jsx(G,{mode:"datatable"}),LoadedComponent:e.jsx(x,{mode:"datatable",data:M??[],columns:F,ExpandableContentComponent:I})}),e.jsx(V,{mode:"delete",title:"Eliminar Cliente",open:v.isOpen,onClose:u,onSubmit:w,description:"Tem a certeza que deseja eliminar este cliente?",subDescription:"Ao eliminar este cliente, todos os dados relacionados, incluindo contactos, moradas, equipamentos e reparações associadas, serão removidos de forma permanente."})]})})};export{pe as default};
