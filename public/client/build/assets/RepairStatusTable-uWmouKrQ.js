import{e as I,r as p,j as t,S as i,aN as z,aG as L,h as a,aZ as f,a_ as h,a$ as _,aE as j,aF as b,ax as A,aH as B,aj as F,ay as W,b0 as $,f as k,B as P,aM as U,b1 as N,aC as q,b2 as G,ab as H,s as v}from"./index-C9HasOiM.js";import{u as V}from"./useRepair-Cho1bqHB.js";import{R as Z}from"./List-CwMZzCSp.js";import{M as J}from"./MoreVert-CDz2P5kD.js";import{E as K}from"./Edit-CYRFZ1bJ.js";import"./repair-DgMqRd6F.js";import"./Container-B2tOqq2a.js";import"./Add-Hwv7pAxz.js";const ie=()=>{const{role:g}=I(),{findAllRepairStatuses:S,deleteRepairStatus:C}=V(),{data:y,isLoading:E}=S,[m,u]=p.useState({isOpen:!1,status:null}),R=e=>{u({isOpen:!0,status:e})},M=()=>{u({isOpen:!1,status:null})},[c,x]=p.useState({isOpen:!1,statusId:null}),D=e=>{x({isOpen:!0,statusId:e})},l=()=>{x({isOpen:!1,statusId:null})},O=()=>new Promise((e,s)=>{c.statusId?C.mutateAsync({statusId:c.statusId}).then(()=>{H("Estado eliminado com sucesso!"),l(),e()}).catch(n=>{if(n.error.code==="REP-008"){l(),v("Este estado está associado a uma ou mais reparações e não pode ser eliminado!",{duration:6e3}),s();return}l(),v("Erro ao eliminar estado"),s()}):(l(),s())}),T=p.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>t.jsxs(i,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&t.jsx(z,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"color",label:"Cor",align:"left",sortable:!0,renderComponent:({row:e})=>t.jsx(L,{color:e.color,sx:{borderRadius:"50% !important",width:20,height:20}})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var s,n,o,d,r;return t.jsx(t.Fragment,{children:t.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[t.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?t.jsxs(t.Fragment,{children:[t.jsx(f,{alt:(s=e==null?void 0:e.created_by_user)==null?void 0:s.username,src:`${h}/users/${(n=e==null?void 0:e.created_by_user)==null?void 0:n.id}/avatar?size=80`,name:(o=e==null?void 0:e.created_by_user)==null?void 0:o.username}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(d=e==null?void 0:e.created_by_user)==null?void 0:d.username}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(r=e==null?void 0:e.created_by_user)==null?void 0:r.role})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),t.jsx(_,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:j(e==null?void 0:e.created_at_datetime)}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var s,n,o,d,r;return t.jsx(t.Fragment,{children:e!=null&&e.last_modified_datetime?t.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[t.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?t.jsxs(t.Fragment,{children:[t.jsx(f,{alt:(s=e==null?void 0:e.last_modified_by_user)==null?void 0:s.username,src:`${h}/users/${(n=e==null?void 0:e.last_modified_by_user)==null?void 0:n.id}/avatar?size=80`,name:(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.username}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.username}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(r=e==null?void 0:e.last_modified_by_user)==null?void 0:r.role})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),t.jsx(_,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:j(e==null?void 0:e.last_modified_datetime)}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.last_modified_datetime)})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>t.jsx(A,{mode:"custom",customButton:t.jsx(B,{title:"Mais opções",sx:{margin:-1},children:t.jsx(F,{children:t.jsx(J,{})})}),children:t.jsx(W,{buttons:[{label:"Editar",icon:t.jsx(K,{fontSize:"small"}),onClick:()=>R(e)},...g!=="Funcionário"?[{label:"Eliminar",icon:t.jsx($,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>D(e==null?void 0:e.id)}]:[]]})})}],[]);return t.jsx(k,{elevation:1,children:t.jsxs(P,{sx:{marginTop:3},children:[t.jsx(U,{isLoading:E,LoadingComponent:t.jsx(N,{mode:"datatable"}),LoadedComponent:t.jsx(q,{mode:"datatable",data:y??[],columns:T})}),t.jsx(Z,{status:m.status,open:m.isOpen,onClose:M}),t.jsx(G,{mode:"delete",title:"Eliminar Estado",open:c.isOpen,onClose:l,onSubmit:O,description:"Tem a certeza que deseja eliminar este estado?",subDescription:"Ao eliminar este estado, os dados serão removidos de forma permanente."})]})})};export{ie as default};
