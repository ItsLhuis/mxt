import{r as b,j as a,S as t,aF as $,aG as K,h as s,aI as N,aJ as O,aK as U,B as u,b1 as z,aH as I,b4 as E,b2 as j,b0 as Y,b5 as q,b6 as G,b7 as J,aT as h,f as V,H as Q,aR as X,aS as Z}from"./index-_NktdslD.js";import{g as L}from"./getValidChipColor-D8WVyITM.js";import{C as g}from"./Check-DhRqV4Lx.js";import{H as r}from"./History-B4BUT27R.js";const ie=({repair:M,isLoading:k,isError:B})=>{var D;const C=!k&&!B,P=b.useMemo(()=>[{id:"type",label:"Atividade",align:"left",sortable:!0},{id:"responsible_user",label:"Responsável",align:"left",sortable:!1,renderComponent:({row:i})=>{var x,l,d,c,f;return a.jsx(a.Fragment,{children:i!=null&&i.responsible_user?a.jsxs(t,{sx:{flexDirection:"row",gap:2},children:[a.jsxs(t,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[a.jsx($,{alt:(x=i==null?void 0:i.responsible_user)==null?void 0:x.username,src:`${K}/users/${(l=i==null?void 0:i.responsible_user)==null?void 0:l.id}/avatar?size=80`,name:(d=i==null?void 0:i.responsible_user)==null?void 0:d.username}),a.jsxs(t,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(s,{variant:"p",component:"p",fontWeight:500,children:(c=i==null?void 0:i.responsible_user)==null?void 0:c.username}),a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:(f=i==null?void 0:i.responsible_user)==null?void 0:f.role})]})]}),a.jsx(N,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(t,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(s,{variant:"p",component:"p",fontWeight:500,children:O(i==null?void 0:i.created_at_datetime)}),a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:U(i==null?void 0:i.created_at_datetime)})]})]}):a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})})}}],[]),W=b.useMemo(()=>({row:i})=>{var d,c,f,_;const x=b.useMemo(()=>[{id:"field",label:"Campo",align:"left",sortable:!0},{id:"before",label:"Antes",align:"left",sortable:!0,renderComponent:({row:e})=>{var p,m;return((e==null?void 0:e.field)==="Descrição da entrada"||(e==null?void 0:e.field)==="Descrição dos acessórios da entrada"||(e==null?void 0:e.field)==="Descrição dos problemas reportados"||(e==null?void 0:e.field)==="Descrição dos trabalhos realizados"||(e==null?void 0:e.field)==="Descrição dos acessórios da intervenção"||(e==null?void 0:e.field)==="Descrição da intervenção")&&e!=null&&e.before?a.jsx(u,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:a.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:z(e==null?void 0:e.before)})}):(e==null?void 0:e.field)==="Estado"&&e!=null&&e.before?a.jsx(I,{label:(p=e==null?void 0:e.before)==null?void 0:p.name,color:L((m=e==null?void 0:e.before)==null?void 0:m.color)}):((e==null?void 0:e.field)==="Data de entrada"||(e==null?void 0:e.field)==="Data de conclusão"||(e==null?void 0:e.field)==="Data de entrega")&&e!=null&&e.before?a.jsx(a.Fragment,{children:E(e==null?void 0:e.before)}):(e==null?void 0:e.field)==="Cliente notificado"?a.jsx(a.Fragment,{children:e!=null&&e.before?a.jsx(g,{color:"success"}):a.jsx(j,{color:"error"})}):(e==null?void 0:e.field)==="Acessórios da entrada"||(e==null?void 0:e.field)==="Problemas reportados"||(e==null?void 0:e.field)==="Trabalhos realizados"||(e==null?void 0:e.field)==="Acessórios da intervenção"?e!=null&&e.before&&(e==null?void 0:e.before.length)>0?e==null?void 0:e.before.map(n=>n==null?void 0:n.name).join(", "):a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"}):e!=null&&e.before?e==null?void 0:e.before:a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})}},{id:"after",label:"Depois",align:"left",sortable:!0,renderComponent:({row:e})=>{var p,m,n,S,y,H,T,F,A,R;return((e==null?void 0:e.field)==="Descrição da entrada"||(e==null?void 0:e.field)==="Descrição dos acessórios da entrada"||(e==null?void 0:e.field)==="Descrição dos problemas reportados"||(e==null?void 0:e.field)==="Descrição dos trabalhos realizados"||(e==null?void 0:e.field)==="Descrição dos acessórios da intervenção"||(e==null?void 0:e.field)==="Descrição da intervenção")&&e!=null&&e.after?a.jsx(u,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:a.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:z(e==null?void 0:e.after)})}):(e==null?void 0:e.field)==="Equipamento"&&e!=null&&e.after?a.jsx(Y,{fontSize:"small",title:a.jsxs(t,{sx:{justifyContent:"center",alignItems:"flex-start",gap:.5},children:[a.jsx(s,{variant:"h5",component:"h5",sx:{wordBreak:"break-all"},children:(m=(p=e==null?void 0:e.after)==null?void 0:p.client)==null?void 0:m.name}),a.jsx(t,{sx:{flexDirection:"row",width:"100%"},children:a.jsxs(s,{variant:"p",component:"p",sx:{wordBreak:"break-all"},children:[(S=(n=e==null?void 0:e.after)==null?void 0:n.type)==null?void 0:S.name,", ",(H=(y=e==null?void 0:e.after)==null?void 0:y.brand)==null?void 0:H.name,(F=(T=e==null?void 0:e.after)==null?void 0:T.model)==null?void 0:F.name]})})]})}):(e==null?void 0:e.field)==="Estado"&&e!=null&&e.after?a.jsx(I,{label:(A=e==null?void 0:e.after)==null?void 0:A.name,color:L((R=e==null?void 0:e.after)==null?void 0:R.color)}):((e==null?void 0:e.field)==="Data de entrada"||(e==null?void 0:e.field)==="Data de conclusão"||(e==null?void 0:e.field)==="Data de entrega")&&e!=null&&e.after?a.jsx(a.Fragment,{children:E(e==null?void 0:e.after)}):(e==null?void 0:e.field)==="Cliente notificado"?a.jsx(a.Fragment,{children:e!=null&&e.after?a.jsx(g,{color:"success"}):a.jsx(j,{color:"error"})}):(e==null?void 0:e.field)==="Acessórios da entrada"||(e==null?void 0:e.field)==="Problemas reportados"||(e==null?void 0:e.field)==="Trabalhos realizados"||(e==null?void 0:e.field)==="Acessórios da intervenção"?e!=null&&e.after&&(e==null?void 0:e.after.length)>0?e==null?void 0:e.after.map(v=>v==null?void 0:v.name).join(", "):a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"}):e!=null&&e.after?e==null?void 0:e.after:a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})}},{id:"changed",label:"Alterado",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsx(a.Fragment,{children:e!=null&&e.changed?a.jsx(g,{color:"success"}):a.jsx(j,{color:"error"})})}],[]),l=b.useMemo(()=>[{id:"file_mime_type",label:"Tipo",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsx(t,{sx:{alignItems:"flex-start"},children:(e==null?void 0:e.file_mime_type)==="application/pdf"?a.jsx("img",{src:q}):e!=null&&e.file_mime_type.startsWith("image/")?a.jsx("img",{src:G}):a.jsx("img",{src:J})})},{id:"original_filename",label:"Ficheiro",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsxs(t,{children:[a.jsx(s,{variant:"p",component:"p",children:e==null?void 0:e.original_filename}),a.jsx(s,{variant:"p",component:"p",sx:{color:"var(--outline)"},children:`${(e==null?void 0:e.file_size)<1024*1024?((e==null?void 0:e.file_size)/1024).toFixed(2)+" Kb":((e==null?void 0:e.file_size)/(1024*1024)).toFixed(2)+" Mb"}`})]})}],[]);return a.jsx(u,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden",margin:3},children:((d=i==null?void 0:i.details[0])==null?void 0:d.field)==="Anexos"?a.jsx(a.Fragment,{children:(c=i==null?void 0:i.details[0])!=null&&c.after?a.jsx(h,{data:((f=i==null?void 0:i.details[0])==null?void 0:f.after)??[],columns:l}):a.jsx(h,{showSearch:!1,data:[(_=i==null?void 0:i.details[0])==null?void 0:_.before],columns:l})}):a.jsx(h,{data:(i==null?void 0:i.details)??[],columns:x})})},[]);return a.jsxs(V,{elevation:1,children:[a.jsx(Q,{title:"Histórico de Atividades",description:"Histórico de atividades sobre a reparação",icon:a.jsx(r,{})}),a.jsx(X,{isLoading:!C,LoadingComponent:a.jsx(Z,{mode:"datatable"}),LoadedComponent:a.jsx(u,{sx:{margin:3,border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:a.jsx(h,{mode:"datatable",data:C?(D=M[0])==null?void 0:D.interactions_history:[],columns:P,ExpandableContentComponent:W})})})]})};export{ie as default};
