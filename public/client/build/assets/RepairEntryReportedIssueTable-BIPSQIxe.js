import{r as p,j as t,S as i,b7 as z,h as a,aV as f,aW as _,aE as b,aM as h,aN as y,aF as L,aP as A,ag as B,aQ as W,aG as F,aX as P,aY as j,f as $,B as k,aZ as N,a_ as U,aK as V,a$ as q,aj as G,s as v}from"./index-D5KQThVv.js";import{u as K}from"./useRepair-BQF6lWd4.js";import{R as Q}from"./List-DMKw9kah.js";import{E as X}from"./Edit-xbPDb8dm.js";import"./repair-DMHLqADZ.js";import"./Container-Cp_CcLvm.js";import"./Add-7WJY652X.js";const ae=()=>{const{findAllEntryReportedIssues:R,deleteEntryReportedIssue:I}=K(),{data:E,isLoading:g}=R,[c,u]=p.useState({isOpen:!1,entryReportedIssue:null}),C=e=>{u({isOpen:!0,entryReportedIssue:e})},D=()=>{u({isOpen:!1,entryReportedIssue:null})},[m,x]=p.useState({isOpen:!1,entryReportedIssueId:null}),M=e=>{x({isOpen:!0,entryReportedIssueId:e})},r=()=>{x({isOpen:!1,entryReportedIssueId:null})},S=()=>new Promise((e,s)=>{m.entryReportedIssueId?I.mutateAsync({entryReportedIssueId:m.entryReportedIssueId}).then(()=>{G("Problema reportado eliminado com sucesso!"),r(),e()}).catch(n=>{if(n.error.code==="REP-014"){r(),v("Este problema reportado está associado a uma ou mais reparações e não pode ser eliminado!",{duration:6e3}),s();return}r(),v("Erro ao eliminar problema reportado"),s()}):(r(),s())}),T=p.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>t.jsxs(i,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&t.jsx(z,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var s,n,d,o,l;return t.jsx(t.Fragment,{children:t.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[t.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?t.jsxs(t.Fragment,{children:[t.jsx(f,{alt:(s=e==null?void 0:e.created_by_user)==null?void 0:s.username,src:`${_}/users/${(n=e==null?void 0:e.created_by_user)==null?void 0:n.id}/avatar?size=80`,name:(d=e==null?void 0:e.created_by_user)==null?void 0:d.username}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(o=e==null?void 0:e.created_by_user)==null?void 0:o.username}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(l=e==null?void 0:e.created_by_user)==null?void 0:l.role})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),t.jsx(b,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.created_at_datetime)}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:y(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var s,n,d,o,l;return t.jsx(t.Fragment,{children:e!=null&&e.last_modified_datetime?t.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[t.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?t.jsxs(t.Fragment,{children:[t.jsx(f,{alt:(s=e==null?void 0:e.last_modified_by_user)==null?void 0:s.username,src:`${_}/users/${(n=e==null?void 0:e.last_modified_by_user)==null?void 0:n.id}/avatar?size=80`,name:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.username}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.username}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(l=e==null?void 0:e.last_modified_by_user)==null?void 0:l.role})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),t.jsx(b,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),t.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.last_modified_datetime)}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:y(e==null?void 0:e.last_modified_datetime)})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>t.jsx(L,{mode:"custom",customButton:t.jsx(A,{title:"Mais opções",sx:{margin:-1},children:t.jsx(B,{children:t.jsx(W,{})})}),children:t.jsx(F,{buttons:[{label:"Editar",icon:t.jsx(X,{fontSize:"small"}),onClick:()=>C(e)},{label:"Eliminar",icon:t.jsx(P,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>M(e==null?void 0:e.id)}]})})}],[]),O=p.useMemo(()=>[{id:"name",label:"Problema reportado"},{id:"created_by_user.username",label:"Criado por"},{id:"created_at_datetime",label:"Data de criação",formatter:e=>e?j(e):""},{id:"last_modified_by_user.username",label:"Modificado pela última vez por"},{id:"last_modified_datetime",label:"Última data de modificação",formatter:e=>e?j(e):""}],[]);return t.jsx($,{elevation:1,children:t.jsxs(k,{sx:{marginTop:3},children:[t.jsx(N,{isLoading:g,LoadingComponent:t.jsx(U,{mode:"datatable"}),LoadedComponent:t.jsx(V,{mode:"datatable",data:E??[],columns:T,exportFileName:"problemas_reportados_reparacao",exportColumns:O})}),t.jsx(Q,{entryReportedIssue:c.entryReportedIssue,open:c.isOpen,onClose:D}),t.jsx(q,{mode:"delete",title:"Eliminar Acessório da Entrada",open:m.isOpen,onClose:r,onSubmit:S,description:"Tem a certeza que deseja eliminar este acessório da entrada?",subDescription:"Ao eliminar este acessório da entrada, os dados serão removidos de forma permanente."})]})})};export{ae as default};
