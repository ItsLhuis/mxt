import{d as w,r as A,j as e,S as s,f as B,H as O,aC as P,F as f,T as j,ag as F,aM as L,ah as D,b9 as H,B as E,L as N,aU as R,h as d,b0 as v,ba as W}from"./index-_NktdslD.js";import{z as o,u as V,t as $}from"./index-8QsUXVhp.js";import{u as q}from"./useClient-B8aLe1Fc.js";import{u as z}from"./useSms-BtFrSTcP.js";import{f as b}from"./phone-B8ybmA3k.js";import"./sms-C6P6uXfu.js";import"./isPossiblePhoneNumber-DES16dOz.js";const K=o.object({clientId:o.number({message:"O para é obrigatório"}).int().positive(),contactId:o.number({message:"O para é obrigatório"}).int().positive(),message:o.string().trim().min(1,{message:"A mensagem é obrigatória"})}),ee=()=>{var u,g,h;const S=w(),{control:U,register:C,handleSubmit:y,setValue:c,formState:{errors:i}}=V({resolver:$(K),defaultValues:{attachments:[]}}),[r,l]=A.useState({isOpen:!1,client:{id:null,name:""},contact:{id:null,name:""}}),m=()=>{l(t=>({...t,isOpen:!0}))},T=()=>{l(t=>({...t,isOpen:!1}))},I=(t,a,n,k)=>{l({client:{id:t,name:a},contact:{id:n,name:k}}),c("clientId",t),c("contactId",n)},{findAllClients:p}=q(),{sendSms:x}=z(),M=async t=>{await x.mutateAsync(t).then(()=>S("/sms/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:y(M),children:e.jsx(s,{sx:{marginTop:3,gap:3},children:e.jsxs(B,{elevation:1,children:[e.jsx(O,{title:"Detalhes",description:"Para e mensagem do SMS",icon:e.jsx(P,{})}),e.jsxs(s,{sx:{padding:3,gap:2},children:[e.jsx(f,{fullWidth:!0,children:e.jsx(j,{label:"Para",placeholder:"Selecione o contacto de um cliente",value:r.client.name?`${b(r.contact.name)} (${r.client.name})`:"",onClick:m,InputProps:{readOnly:!0,startAdornment:e.jsx(F,{position:"start",children:e.jsx(L,{children:e.jsx(D,{onClick:m,children:e.jsx(H,{})})})})},error:!!i.clientId,helperText:(u=i.clientId)==null?void 0:u.message})}),e.jsx(f,{fullWidth:!0,children:e.jsx(j,{...C("message"),label:"Mensagem",error:!!i.message,helperText:(g=i.message)==null?void 0:g.message,autoComplete:"off",multiline:!0,rows:14})}),e.jsx(E,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(N,{loading:x.isPending,type:"submit",variant:"contained",children:"Enviar SMS"})})]})]})})}),e.jsx(R,{open:r.isOpen??!1,onClose:T,mode:"data",data:((h=p.data)==null?void 0:h.map(t=>({...t,filteredContacts:t.contacts.filter(a=>a.type==="Telemóvel"||a.type==="Telefone")})))??[],searchKeys:["name","contacts.contact"],isLoading:p.isLoading,title:"Contactos dos Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(t,a)=>e.jsxs(s,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:"8px"},children:[e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:1,marginInline:2,marginTop:2},children:[e.jsx(d,{variant:"h5",component:"h5",sx:{wordBreak:"break-all",textAlign:"start"},children:t.name}),t.description&&e.jsx(v,{title:t.description})]}),e.jsxs(s,{sx:{padding:1},children:[t.contacts.filter(n=>n.type==="Telemóvel"||n.type==="Telefone").map(n=>e.jsx(W,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:n.id===r.contact.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,marginTop:1,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{I(t.id,t.name,n.id,n.contact),a()},children:e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:b(n.contact)}),n.description&&e.jsx(v,{title:n.description})]})},n.id)),t.contacts.filter(n=>n.type==="Telemóvel"||n.type==="Telefone").length===0&&e.jsx(d,{variant:"p",component:"p",sx:{color:"var(--outline)",margin:1,marginTop:0},children:"Não há contactos de SMS disponíveis!"})]})]})})]})};export{ee as default};
