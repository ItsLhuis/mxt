import{d as H,r as P,j as e,S as g,f as R,H as Q,ax as z,F as u,T,af as U,aL as _,ag as $,b8 as G,aQ as j,a_ as f,aV as C,b2 as J,B as K,L as X,aT as Y,b9 as Z,h as ee,a$ as ne,aj as ae,s as te}from"./index-mWc9gLhA.js";import{u as oe,a as re,C as p,t as se}from"./index-COzNbWAj.js";import{e as ie}from"./equipment-oKlO_vtn.js";import{u as de}from"./useClient-D52tlv0a.js";import{u as le}from"./useEquipment-DvbTvh-h.js";import"./client-BRbWEP8n.js";const ge=()=>{var S,E;const q=H(),{control:d,register:M,handleSubmit:w,setValue:v,formState:{errors:r},setError:A}=oe({resolver:se(ie)}),{findAllClients:I}=de(),{findAllEquipmentTypes:b,findAllEquipmentBrands:y,findAllEquipmentModelsByBrandId:k,createNewEquipment:B}=le(),{data:N,isLoading:W,isError:F}=k(re({control:d,name:"brandId"})),[h,x]=P.useState({isOpen:!1,client:{id:null,name:""}}),L=()=>{x(n=>({...n,isOpen:!0}))},V=()=>{x(n=>({...n,isOpen:!1}))},O=(n,a)=>{x({client:{id:n,name:a}}),v("clientId",n)},D=async n=>{await B.mutateAsync({...n,description:n.description===""?null:n.description}).then(()=>{q("/equipment/list"),ae("Equipamento adicionado com sucesso!")}).catch(a=>{if(a.error.code==="EQU-008"){A("sn",{type:"manual",message:"Número de série já existente"});return}te("Erro ao adicionar equipamento!")})};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:w(D),children:e.jsx(g,{sx:{marginTop:3,gap:3},children:e.jsxs(R,{elevation:1,children:[e.jsx(Q,{title:"Detalhes",description:"Cliente, tipo, marca, modelo,... do equipamento",icon:e.jsx(z,{})}),e.jsxs(g,{sx:{padding:3,gap:2},children:[e.jsx(u,{fullWidth:!0,children:e.jsx(T,{label:"Cliente",placeholder:"Selecione um cliente",value:h.client.name,onClick:L,InputProps:{readOnly:!0,startAdornment:e.jsx(U,{position:"start",children:e.jsx(_,{children:e.jsx($,{onClick:L,children:e.jsx(G,{})})})})},error:!!r.clientId,helperText:(S=r.clientId)==null?void 0:S.message})}),e.jsx(j,{isLoading:b.isLoading,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"typeId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=b.data??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Tipo",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||"")},error:!!r.typeId,helperText:(i=r.typeId)==null?void 0:i.message})}})})}),e.jsx(j,{isLoading:y.isLoading,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"brandId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=y.data??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Marca",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||""),v("modelId","")},error:!!r.brandId,helperText:(i=r.brandId)==null?void 0:i.message})}})})}),e.jsx(j,{isLoading:W||F,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"modelId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=N??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Modelo",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||"")},error:!!r.modelId,helperText:(i=r.modelId)==null?void 0:i.message})}})})}),e.jsx(u,{fullWidth:!0,children:e.jsx(T,{...M("sn"),label:"Número de série",error:!!r.sn,helperText:(E=r.sn)==null?void 0:E.message,autoComplete:"off"})}),e.jsx(p,{name:"description",control:d,defaultValue:"",render:({field:n})=>e.jsx(J,{label:"Descrição",value:n.value,onChange:n.onChange,shouldImmediatelyRender:!0})}),e.jsx(K,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(X,{loading:B.isPending,type:"submit",variant:"contained",children:"Adicionar Equipamento"})})]})]})})}),e.jsx(Y,{open:h.isOpen??!1,onClose:V,mode:"data",data:I.data??[],isLoading:I.isLoading,title:"Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(n,a)=>e.jsx(Z,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:n.id===h.client.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{O(n.id,n.name),a()},children:e.jsxs(g,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(ee,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:n.name}),n.description&&e.jsx(ne,{fontSize:"small",title:n.description})]})})})]})};export{ge as default};
