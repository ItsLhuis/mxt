import{d as A,r as k,j as e,S as o,f as M,H as P,aB as w,F as x,T as g,ag as z,aM as L,ah as R,b9 as D,b3 as H,bB as V,B as W,L as N,aU as U,h,b0 as T,ba as $}from"./index-_NktdslD.js";import{z as i,u as q,C as O,t as K}from"./index-8QsUXVhp.js";import{u as G}from"./useClient-B8aLe1Fc.js";import{u as J}from"./useEmail-DPEZ0mRc.js";import"./email-CZ5mtdVc.js";const Q=i.object({clientId:i.number({message:"O cliente é obrigatório"}).int().positive(),contactId:i.number({message:"O contacto é obrigatório"}).int().positive(),subject:i.string().trim().min(1,{message:"O assunto é obrigatório"}).max(255,{message:"O assunto não pode exceder 255 caracteres"}),title:i.string().trim().min(1,{message:"O título é obrigatório"}).max(255,{message:"O título não pode exceder 255 caracteres"}),message:i.string().trim().min(1,{message:"A mensagem é obrigatória"}),text:i.string().trim().min(1,{message:"O texto é obrigatório"}).optional(),attachments:i.array(i.instanceof(File,{message:"Os anexos são inválidos"})).optional()}).refine(l=>l.attachments?l.attachments.reduce((c,m)=>c+m.size,0)<=20*1024*1024:!0,{message:"O tamanho total de todos os anexos deve ser de 20 MB ou menos",path:["attachments"]}),te=()=>{var v,C,y,S;const l=A(),{control:d,register:c,handleSubmit:m,setValue:j,formState:{errors:n}}=q({resolver:K(Q),defaultValues:{attachments:[]}}),[r,u]=k.useState({isOpen:!1,client:{id:null,name:""},contact:{id:null,name:""}}),b=()=>{u(t=>({...t,isOpen:!0}))},E=()=>{u(t=>({...t,isOpen:!1}))},I=(t,s,a,F)=>{u({client:{id:t,name:s},contact:{id:a,name:F}}),j("clientId",t),j("contactId",a)},{findAllClients:f}=G(),{sendEmail:p}=J(),B=async t=>{await p.mutateAsync({...t,text:t.subject}).then(()=>l("/email/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:m(B),children:e.jsx(o,{sx:{marginTop:3,gap:3},children:e.jsxs(M,{elevation:1,children:[e.jsx(P,{title:"Detalhes",description:"Para, assunto, título,... do e-mail",icon:e.jsx(w,{})}),e.jsxs(o,{sx:{padding:3,gap:2},children:[e.jsx(x,{fullWidth:!0,children:e.jsx(g,{label:"Para",placeholder:"Selecione o e-mail de um cliente",value:r.client.name?`${r.contact.name} (${r.client.name})`:"",onClick:b,InputProps:{readOnly:!0,startAdornment:e.jsx(z,{position:"start",children:e.jsx(L,{children:e.jsx(R,{onClick:b,children:e.jsx(D,{})})})})},error:!!n.clientId,helperText:(v=n.clientId)==null?void 0:v.message})}),e.jsx(x,{fullWidth:!0,children:e.jsx(g,{...c("subject"),label:"Assunto",error:!!n.subject,helperText:(C=n.subject)==null?void 0:C.message,autoComplete:"off"})}),e.jsx(x,{fullWidth:!0,children:e.jsx(g,{...c("title"),label:"Título",error:!!n.title,helperText:(y=n.title)==null?void 0:y.message,autoComplete:"off"})}),e.jsx(O,{name:"message",control:d,defaultValue:"",render:({field:t})=>{var s;return e.jsx(H,{label:"Mensagem",value:t.value,onChange:t.onChange,error:!!n.message,helperText:(s=n.message)==null?void 0:s.message,shouldImmediatelyRender:!0})}}),e.jsx(O,{name:"attachments",control:d,defaultValue:"",render:({field:t})=>{var s;return e.jsx(V,{label:"Anexos",acceptedFiles:"",maxTotalFileSize:20*1024*1024,disabled:p.isPending,value:t.value,onChange:t.onChange,error:!!n.attachments,helperText:(s=n.attachments)==null?void 0:s.message})}}),e.jsx(W,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(N,{loading:p.isPending,type:"submit",variant:"contained",children:"Enviar E-mail"})})]})]})})}),e.jsx(U,{open:r.isOpen??!1,onClose:E,mode:"data",data:((S=f.data)==null?void 0:S.map(t=>({...t,filteredContacts:t.contacts.filter(s=>s.type==="E-mail")})))??[],searchKeys:["name","contacts.contact"],isLoading:f.isLoading,title:"E-mails dos Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(t,s)=>e.jsxs(o,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:"8px"},children:[e.jsxs(o,{sx:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:1,marginInline:2,marginTop:2},children:[e.jsx(h,{variant:"h5",component:"h5",sx:{wordBreak:"break-all",textAlign:"start"},children:t.name}),t.description&&e.jsx(T,{title:t.description})]}),e.jsxs(o,{sx:{padding:1},children:[t.contacts.filter(a=>a.type==="E-mail").map(a=>e.jsx($,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:a.id===r.contact.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,marginTop:1,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{I(t.id,t.name,a.id,a.contact),s()},children:e.jsxs(o,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(h,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:a.contact}),a.description&&e.jsx(T,{title:a.description})]})},a.id)),t.contacts.filter(a=>a.type==="E-mail").length===0&&e.jsx(h,{variant:"p",component:"p",sx:{color:"var(--outline)",margin:1,marginTop:0},children:"Não há contactos de e-mail disponíveis!"})]})]})})]})};export{te as default};
