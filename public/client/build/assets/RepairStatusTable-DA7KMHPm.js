import{r as c,j as a,S as i,b7 as I,aO as L,h as t,aV as f,aW as _,aE as h,aM as b,aN as j,aF as B,aP as W,ag as A,aQ as F,aG as $,aX as k,aY as v,f as P,B as N,aZ as U,a_ as V,aK as q,a$ as G,aj as K,s as g}from"./index-D5KQThVv.js";import{u as Q}from"./useRepair-BQF6lWd4.js";import{R as X}from"./List-oS2EUpaH.js";import{E as Y}from"./Edit-xbPDb8dm.js";import"./repair-DMHLqADZ.js";import"./Container-Cp_CcLvm.js";import"./Add-7WJY652X.js";const se=()=>{const{findAllRepairStatuses:S,deleteRepairStatus:C}=Q(),{data:E,isLoading:y}=S,[p,u]=c.useState({isOpen:!1,status:null}),R=e=>{u({isOpen:!0,status:e})},D=()=>{u({isOpen:!1,status:null})},[m,x]=c.useState({isOpen:!1,statusId:null}),M=e=>{x({isOpen:!0,statusId:e})},l=()=>{x({isOpen:!1,statusId:null})},O=()=>new Promise((e,s)=>{m.statusId?C.mutateAsync({statusId:m.statusId}).then(()=>{K("Estado eliminado com sucesso!"),l(),e()}).catch(n=>{if(n.error.code==="REP-008"){l(),g("Este estado está associado a uma ou mais reparações e não pode ser eliminado!",{duration:6e3}),s();return}l(),g("Erro ao eliminar estado"),s()}):(l(),s())}),T=c.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsxs(i,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&a.jsx(I,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"color",label:"Cor",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsx(L,{color:e.color,sx:{borderRadius:"50% !important",width:20,height:20}})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var s,n,o,d,r;return a.jsx(a.Fragment,{children:a.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[a.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?a.jsxs(a.Fragment,{children:[a.jsx(f,{alt:(s=e==null?void 0:e.created_by_user)==null?void 0:s.username,src:`${_}/users/${(n=e==null?void 0:e.created_by_user)==null?void 0:n.id}/avatar?size=80`,name:(o=e==null?void 0:e.created_by_user)==null?void 0:o.username}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(d=e==null?void 0:e.created_by_user)==null?void 0:d.username}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(r=e==null?void 0:e.created_by_user)==null?void 0:r.role})]})]}):a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),a.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:b(e==null?void 0:e.created_at_datetime)}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:j(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var s,n,o,d,r;return a.jsx(a.Fragment,{children:e!=null&&e.last_modified_datetime?a.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[a.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?a.jsxs(a.Fragment,{children:[a.jsx(f,{alt:(s=e==null?void 0:e.last_modified_by_user)==null?void 0:s.username,src:`${_}/users/${(n=e==null?void 0:e.last_modified_by_user)==null?void 0:n.id}/avatar?size=80`,name:(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.username}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.username}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(r=e==null?void 0:e.last_modified_by_user)==null?void 0:r.role})]})]}):a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),a.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:b(e==null?void 0:e.last_modified_datetime)}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:j(e==null?void 0:e.last_modified_datetime)})]})]}):a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>a.jsx(B,{mode:"custom",customButton:a.jsx(W,{title:"Mais opções",sx:{margin:-1},children:a.jsx(A,{children:a.jsx(F,{})})}),children:a.jsx($,{buttons:[{label:"Editar",icon:a.jsx(Y,{fontSize:"small"}),onClick:()=>R(e)},{label:"Eliminar",icon:a.jsx(k,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>M(e==null?void 0:e.id)}]})})}],[]),z=c.useMemo(()=>[{id:"name",label:"Estado"},{id:"color",label:"Cor",color:e=>e,formatter:()=>""},{id:"created_by_user.username",label:"Criado por"},{id:"created_at_datetime",label:"Data de criação",formatter:e=>e?v(e):""},{id:"last_modified_by_user.username",label:"Modificado pela última vez por"},{id:"last_modified_datetime",label:"Última data de modificação",formatter:e=>e?v(e):""}],[]);return a.jsx(P,{elevation:1,children:a.jsxs(N,{sx:{marginTop:3},children:[a.jsx(U,{isLoading:y,LoadingComponent:a.jsx(V,{mode:"datatable"}),LoadedComponent:a.jsx(q,{mode:"datatable",data:E??[],columns:T,exportFileName:"estados_reparacao",exportColumns:z})}),a.jsx(X,{status:p.status,open:p.isOpen,onClose:D}),a.jsx(G,{mode:"delete",title:"Eliminar Estado",open:m.isOpen,onClose:l,onSubmit:O,description:"Tem a certeza que deseja eliminar este estado?",subDescription:"Ao eliminar este estado, os dados serão removidos de forma permanente."})]})})};export{se as default};
