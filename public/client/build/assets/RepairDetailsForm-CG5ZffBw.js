import{t as ke,j as e,r as ye,f as Ne,H as qe,aV as ze,S as h,B as b,aM as u,aQ as m,aG as Pe,G as Le,h as D,a8 as Ie,aN as $e,F as x,b4 as Be,bK as p,bc as v,L as Fe,ab as Me,s as Ge}from"./index-C9HasOiM.js";import{u as Oe,b as Qe,a as Ke,C as c,t as Je}from"./index-BTi6rd4V.js";import{u as Xe}from"./repair-C13Y1Qe-.js";import{u as Ye}from"./useRepair-Cho1bqHB.js";import{D as f}from"./DatePicker-DKvslnkv.js";import{g as Ze}from"./getValidChipColor-D8WVyITM.js";import{T as en,a as fe}from"./Tabs-DFEwvjbC.js";import{S as nn}from"./Switch-Bq2ajAyO.js";import"./repair-DgMqRd6F.js";const sn=ke(e.jsx("path",{d:"M18 16h-2v-1H8v1H6v-1H2v5h20v-5h-4zm2-8h-3V6c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v4h4v-2h2v2h8v-2h2v2h4v-4c0-1.1-.9-2-2-2m-5 0H9V6h6z"}),"HomeRepairService"),tn=ke(e.jsx("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42M5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7"}),"LocalOffer"),Ae=n=>{const{children:y,value:C,index:t,...g}=n;return e.jsx(b,{sx:{margin:3},role:"tabpanel",hidden:C!==t,id:`repair-tabpanel-${t}`,"aria-labelledby":`repair-tab-${t}`,...g,children:C===t&&y})},_e=n=>({id:`repair-tab-${n}`,"aria-controls":`repair-tabpanel-${n}`}),xn=({repair:n,isLoading:y,isError:C})=>{var W,E,H,U,N,q,z,P,$,B,F,M,G,O,Q,K,J,X,Y,Z,ee,ne,se,te,oe,ie,ae,de,le,ce,re,ue,me,he,xe,ve,ge,je,De,Ce,pe;const t=!y&&!C,[g,Se]=ye.useState(0),Re=(s,o)=>{Se(o)},{control:d,handleSubmit:we,reset:Te,getValues:L,formState:{errors:l}}=Oe({resolver:Je(Xe)}),A={statusId:((E=(W=n==null?void 0:n[0])==null?void 0:W.status)==null?void 0:E.id)||"",entryDatetime:(H=n==null?void 0:n[0])!=null&&H.entry_datetime?new Date((U=n==null?void 0:n[0])==null?void 0:U.entry_datetime):null,entryAccessories:((q=(N=n==null?void 0:n[0])==null?void 0:N.entry_accessories)==null?void 0:q.map(s=>s.id))||[],entryAccessoriesDescription:((z=n==null?void 0:n[0])==null?void 0:z.entry_accessories_description)||"",entryReportedIssues:(($=(P=n==null?void 0:n[0])==null?void 0:P.entry_reported_issues)==null?void 0:$.map(s=>s.id))||[],entryReportedIssuesDescription:((B=n==null?void 0:n[0])==null?void 0:B.entry_reported_issues_description)||"",entryDescription:((F=n==null?void 0:n[0])==null?void 0:F.entry_description)||"",interventionWorksDone:((G=(M=n==null?void 0:n[0])==null?void 0:M.intervention_works_done)==null?void 0:G.map(s=>s.id))||[],interventionWorksDoneDescription:((O=n==null?void 0:n[0])==null?void 0:O.intervention_works_done_description)||"",interventionAccessoriesUsed:((K=(Q=n==null?void 0:n[0])==null?void 0:Q.intervention_accessories_used)==null?void 0:K.map(s=>s.id))||[],interventionAccessoriesUsedDescription:((J=n==null?void 0:n[0])==null?void 0:J.intervention_accessories_used_description)||"",conclusionDatetime:(X=n==null?void 0:n[0])!=null&&X.conclusion_datetime?new Date((Y=n==null?void 0:n[0])==null?void 0:Y.conclusion_datetime):null,deliveryDatetime:(Z=n==null?void 0:n[0])!=null&&Z.delivery_datetime?new Date((ee=n==null?void 0:n[0])==null?void 0:ee.delivery_datetime):null,isClientNotified:!!((ne=n==null?void 0:n[0])!=null&&ne.is_client_notified)||!1,interventionDescription:((se=n==null?void 0:n[0])==null?void 0:se.intervention_description)||""},{isDirty:Ve}=Qe({control:d}),_=()=>!Ve;ye.useEffect(()=>{t&&n&&n[0]&&Te(A)},[t,n]);const{findAllRepairStatuses:k,findAllEntryAccessories:S,findAllEntryReportedIssues:R,findAllInterventionWorksDone:w,findAllInterventionAccessoriesUsed:T,updateRepair:V}=Ye(),We=async s=>{!t||_()||await V.mutateAsync({repairId:n[0].id,...s,entryAccessoriesDescription:s.entryAccessoriesDescription===""?null:s.entryAccessoriesDescription,entryReportedIssuesDescription:s.entryReportedIssuesDescription===""?null:s.entryReportedIssuesDescription,entryDescription:s.entryDescription===""?null:s.entryDescription,interventionWorksDoneDescription:s.interventionWorksDoneDescription===""?null:s.interventionWorksDoneDescription,interventionAccessoriesUsedDescription:s.interventionAccessoriesUsedDescription===""?null:s.interventionAccessoriesUsedDescription,interventionDescription:s.interventionDescription===""?null:s.interventionDescription}).then(()=>Me("Reparação atualizada com sucesso!")).catch(o=>{if(o.error.code==="EQU-008"){setError("sn",{type:"manual",message:"Número de série já existente"});return}Ge("Erro ao atualizar reparação!")})},Ee=[{label:"Cliente",link:`/client/${(oe=(te=n==null?void 0:n[0].equipment)==null?void 0:te.client)==null?void 0:oe.id}`,value:(ae=(ie=n==null?void 0:n[0].equipment)==null?void 0:ie.client)==null?void 0:ae.name,description:(le=(de=n==null?void 0:n[0].equipment)==null?void 0:de.client)==null?void 0:le.description},{label:"Equipamento",link:`/equipment/${(ce=n==null?void 0:n[0].equipment)==null?void 0:ce.id}`,value:`${(ue=(re=n==null?void 0:n[0].equipment)==null?void 0:re.type)==null?void 0:ue.name} | ${(he=(me=n==null?void 0:n[0].equipment)==null?void 0:me.brand)==null?void 0:he.name} ${(ve=(xe=n==null?void 0:n[0].equipment)==null?void 0:xe.model)==null?void 0:ve.name}`,description:(ge=n==null?void 0:n[0].equipment)==null?void 0:ge.description}],He=Ke({control:d,name:"isClientNotified"});return e.jsxs(Ne,{elevation:1,children:[e.jsx(qe,{title:"Detalhes",description:"Dados da reparação",icon:e.jsx(ze,{})}),e.jsx("form",{onSubmit:we(We),children:e.jsxs(h,{children:[e.jsxs(h,{children:[e.jsx(b,{sx:{paddingInline:3,paddingTop:2},children:e.jsx(u,{isLoading:!t,LoadingComponent:e.jsx(m,{variant:"rounded",width:70,height:32}),LoadedComponent:e.jsx(Pe,{label:(De=(je=n==null?void 0:n[0])==null?void 0:je.status)==null?void 0:De.name,color:Ze((pe=(Ce=n==null?void 0:n[0])==null?void 0:Ce.status)==null?void 0:pe.color)})})}),e.jsx(Le,{container:!0,spacing:2,sx:{paddingInline:3},children:Ee.map((s,o)=>e.jsx(Le,{item:!0,xs:12,children:e.jsx(u,{isLoading:!t,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsxs(h,{children:[e.jsx(D,{variant:"p",component:"p",sx:{color:"var(--outline)",fontWeight:550},children:s.label}),s.value?e.jsxs(h,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(D,{variant:"p",component:"p",children:s.isHtml?s.link?e.jsx(Ie,{to:s.link,dangerouslySetInnerHTML:{__html:s.value}}):e.jsx("span",{dangerouslySetInnerHTML:{__html:s.value}}):s.link?e.jsx(Ie,{to:s.link,children:s.value}):e.jsx("span",{children:s.value})}),s.description&&e.jsx($e,{fontSize:"small",title:s.description})]}):e.jsx(D,{variant:"p",component:"p",sx:{color:"var(--outline)"},children:"Sem valor"})]})})},o))}),e.jsx(h,{sx:{padding:3,paddingBottom:0},children:e.jsx(u,{isLoading:!t||k.isLoading,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(x,{fullWidth:!0,children:e.jsx(c,{name:"statusId",control:d,defaultValue:"",render:({field:s})=>{var i,be;const o=k.data??[],a=["",...o.map(j=>j.name)],r=((i=o.find(j=>j.id===s.value))==null?void 0:i.name)||"";return e.jsx(Be,{ref:s.ref,label:"Estado",data:a,value:r,onChange:j=>{const I=o.find(Ue=>Ue.name===j);s.onChange((I==null?void 0:I.id)||"")},error:!!l.statusId,helperText:(be=l.statusId)==null?void 0:be.message})}})})})}),e.jsxs(b,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:2,margin:3},children:[e.jsxs(en,{value:g,onChange:Re,"aria-label":"repair-tabs",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{borderBottom:"2px solid var(--elevation-level5)",paddingInline:3},children:[e.jsx(fe,{icon:e.jsx(tn,{fontSize:"inherit"}),label:"Entrada",..._e("Entrada")}),e.jsx(fe,{icon:e.jsx(sn,{fontSize:"inherit"}),label:"Intervenção",..._e("Intervenção")})]}),e.jsx(Ae,{value:g,index:0,children:e.jsxs(h,{sx:{gap:2},children:[e.jsx(u,{isLoading:!t,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(c,{name:"entryDatetime",control:d,defaultValue:null,render:({field:s})=>{var o,a;return e.jsx(f,{label:"Data de entrada",value:s.value,onChange:s.onChange,error:!!l.entryDatetime,helperText:(o=l.entryDatetime)==null?void 0:o.message,InputLabelProps:{shrink:((a=L("entryDatetime"))==null?void 0:a.length)>0}})}})}),e.jsx(u,{isLoading:!t||S.isLoading,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(x,{fullWidth:!0,children:e.jsx(c,{name:"entryAccessories",control:d,defaultValue:[],render:({field:s})=>{var r;const a=(S.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(p,{label:"Acessórios",data:a,selectedIds:s.value,onChange:i=>{s.onChange(i)},error:!!l.entryAccessories,helperText:(r=l.entryAccessories)==null?void 0:r.message})}})})}),e.jsx(c,{name:"entryAccessoriesDescription",control:d,defaultValue:"",render:({field:s})=>e.jsx(v,{label:"Descrição dos acessórios",value:s.value,onChange:s.onChange,isLoading:!t})}),e.jsx(u,{isLoading:!t||R.isLoading,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(x,{fullWidth:!0,children:e.jsx(c,{name:"entryReportedIssues",control:d,defaultValue:[],render:({field:s})=>{var r;const a=(R.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(p,{label:"Problemas reportados",data:a,selectedIds:s.value,onChange:i=>{s.onChange(i)},error:!!l.entryReportedIssues,helperText:(r=l.entryReportedIssues)==null?void 0:r.message})}})})}),e.jsx(c,{name:"entryReportedIssuesDescription",control:d,defaultValue:"",render:({field:s})=>e.jsx(v,{label:"Descrição dos problemas reportados",value:s.value,onChange:s.onChange,isLoading:!t})}),e.jsx(c,{name:"entryDescription",control:d,defaultValue:"",render:({field:s})=>e.jsx(v,{label:"Descrição da entrada",value:s.value,onChange:s.onChange,isLoading:!t})})]})}),e.jsx(Ae,{value:g,index:1,children:e.jsxs(h,{sx:{gap:2},children:[e.jsx(u,{isLoading:!t||w.isLoading,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(x,{fullWidth:!0,children:e.jsx(c,{name:"interventionWorksDone",control:d,defaultValue:[],render:({field:s})=>{var r;const a=(w.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(p,{label:"Trabalhos realizados",data:a,selectedIds:s.value,onChange:i=>{s.onChange(i)},error:!!l.interventionWorksDone,helperText:(r=l.interventionWorksDone)==null?void 0:r.message})}})})}),e.jsx(c,{name:"interventionWorksDoneDescription",control:d,defaultValue:"",render:({field:s})=>e.jsx(v,{label:"Descrição dos trabalhos realizados",value:s.value,onChange:s.onChange,isLoading:!t})}),e.jsx(u,{isLoading:!t||T.isLoading,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(x,{fullWidth:!0,children:e.jsx(c,{name:"interventionAccessoriesUsed",control:d,defaultValue:[],render:({field:s})=>{var r;const a=(T.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(p,{label:"Acessórios usados",data:a,selectedIds:s.value,onChange:i=>{s.onChange(i)},error:!!l.interventionAccessoriesUsed,helperText:(r=l.interventionAccessoriesUsed)==null?void 0:r.message})}})})}),e.jsx(c,{name:"interventionAccessoriesUsedDescription",control:d,defaultValue:"",render:({field:s})=>e.jsx(v,{label:"Descrição dos acessórios usados",value:s.value,onChange:s.onChange,isLoading:!t})}),e.jsx(u,{isLoading:!t,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(c,{name:"conclusionDatetime",control:d,defaultValue:null,render:({field:s})=>{var o,a;return e.jsx(f,{label:"Data de conclusão",value:s.value,onChange:s.onChange,error:!!l.conclusionDatetime,helperText:(o=l.conclusionDatetime)==null?void 0:o.message,InputLabelProps:{shrink:((a=L("conclusionDatetime"))==null?void 0:a.length)>0}})}})}),e.jsx(u,{isLoading:!t,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(c,{name:"deliveryDatetime",control:d,defaultValue:null,render:({field:s})=>{var o,a;return e.jsx(f,{label:"Data de entrega",value:s.value,onChange:s.onChange,error:!!l.deliveryDatetime,helperText:(o=l.deliveryDatetime)==null?void 0:o.message,InputLabelProps:{shrink:((a=L("deliveryDatetime"))==null?void 0:a.length)>0}})}})}),e.jsx(u,{isLoading:!t,LoadingComponent:e.jsx(m,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(x,{fullWidth:!0,children:e.jsxs(h,{sx:{flexDirection:"row",alignItems:"center"},children:[e.jsx(c,{name:"isClientNotified",control:d,render:({field:s})=>e.jsx(nn,{edge:"start",value:s.value,onChange:s.onChange,defaultChecked:A.isClientNotified})}),e.jsxs(h,{children:[e.jsx(D,{variant:"p",component:"p",children:"Cliente notificado"}),e.jsx(D,{variant:"p",component:"p",sx:{color:"var(--outline)"},children:He?"Sim":"Não"})]})]})})}),e.jsx(c,{name:"interventionDescription",control:d,defaultValue:"",render:({field:s})=>e.jsx(v,{label:"Descrição da intervenção",value:s.value,onChange:s.onChange,isLoading:!t})})]})})]})]}),e.jsx(b,{sx:{padding:3,paddingTop:0,marginLeft:"auto"},children:e.jsx(Fe,{loading:V.isPending,type:"submit",variant:"contained",disabled:!t||_(),children:"Atualizar Reparação"})})]})})]})};export{xn as default};
