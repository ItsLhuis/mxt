import{d as k,r as B,j as e,S as o,f as P,H as z,aC as M,F as x,T as g,af as w,aP as L,ag as R,bg as D,ba as H,bI as V,B as W,L as $,a$ as N,h,b7 as T,aL as q}from"./index-D5KQThVv.js";import{z as i,u as K,C as O,t as U}from"./index-DCkCG_3f.js";import{u as G}from"./useClient-BpTOlF0d.js";import{u as J}from"./useEmail-nQAPtl2e.js";import"./client-Bk3KRFvh.js";import"./email-Dl0E8x3e.js";const Q=i.object({clientId:i.number({message:"O cliente é obrigatório"}).int().positive(),contactId:i.number({message:"O contacto é obrigatório"}).int().positive(),subject:i.string().trim().min(1,{message:"O assunto é obrigatório"}).max(255,{message:"O assunto não pode exceder 255 caracteres"}),title:i.string().trim().min(1,{message:"O título é obrigatório"}).max(255,{message:"O título não pode exceder 255 caracteres"}),message:i.string().trim().min(1,{message:"A mensagem é obrigatória"}),text:i.string().trim().min(1,{message:"O texto é obrigatório"}).optional(),attachments:i.array(i.instanceof(File,{message:"Os anexos são inválidos"})).optional()}).refine(l=>l.attachments?l.attachments.reduce((c,d)=>c+d.size,0)<=20*1024*1024:!0,{message:"O tamanho total de todos os anexos deve ser de 20 MB ou menos",path:["attachments"]}),ae=()=>{var v,C,S,y;const l=k(),{control:m,register:c,handleSubmit:d,setValue:j,formState:{errors:n}}=K({resolver:U(Q),defaultValues:{attachments:[]}}),[r,p]=B.useState({isOpen:!1,client:{id:null,name:""},contact:{id:null,name:""}}),f=()=>{p(t=>({...t,isOpen:!0}))},E=()=>{p(t=>({...t,isOpen:!1}))},I=(t,s,a,A)=>{p({client:{id:t,name:s},contact:{id:a,name:A}}),j("clientId",t),j("contactId",a)},{findAllClients:b}=G(),{sendEmail:u}=J(),F=async t=>{await u.mutateAsync({...t,text:t.subject}).then(()=>l("/email/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:d(F),children:e.jsx(o,{sx:{marginTop:3,gap:3},children:e.jsxs(P,{elevation:1,children:[e.jsx(z,{title:"Detalhes",description:"Para, assunto, título,... do e-mail",icon:e.jsx(M,{})}),e.jsxs(o,{sx:{padding:3,gap:2},children:[e.jsx(x,{fullWidth:!0,children:e.jsx(g,{label:"Para",placeholder:"Selecione o e-mail de um cliente",value:r.client.name?`${r.contact.name} (${r.client.name})`:"",onClick:f,InputProps:{readOnly:!0,startAdornment:e.jsx(w,{position:"start",children:e.jsx(L,{children:e.jsx(R,{onClick:f,children:e.jsx(D,{})})})})},error:!!n.clientId,helperText:(v=n.clientId)==null?void 0:v.message})}),e.jsx(x,{fullWidth:!0,children:e.jsx(g,{...c("subject"),label:"Assunto",error:!!n.subject,helperText:(C=n.subject)==null?void 0:C.message,autoComplete:"off"})}),e.jsx(x,{fullWidth:!0,children:e.jsx(g,{...c("title"),label:"Título",error:!!n.title,helperText:(S=n.title)==null?void 0:S.message,autoComplete:"off"})}),e.jsx(O,{name:"message",control:m,defaultValue:"",render:({field:t})=>{var s;return e.jsx(H,{label:"Mensagem",value:t.value,onChange:t.onChange,error:!!n.message,helperText:(s=n.message)==null?void 0:s.message,shouldImmediatelyRender:!0})}}),e.jsx(O,{name:"attachments",control:m,defaultValue:"",render:({field:t})=>{var s;return e.jsx(V,{label:"Anexos",acceptedFiles:"",maxTotalFileSize:20*1024*1024,disabled:u.isPending,value:t.value,onChange:t.onChange,error:!!n.attachments,helperText:(s=n.attachments)==null?void 0:s.message})}}),e.jsx(W,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx($,{loading:u.isPending,type:"submit",variant:"contained",children:"Enviar E-mail"})})]})]})})}),e.jsx(N,{open:r.isOpen??!1,onClose:E,mode:"data",data:((y=b.data)==null?void 0:y.map(t=>({...t,filteredContacts:t.contacts.filter(s=>s.type==="E-mail")})))??[],searchKeys:["name","contacts.contact"],isLoading:b.isLoading,title:"E-mails dos Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(t,s)=>e.jsxs(o,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:"8px"},children:[e.jsxs(o,{sx:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:1,marginInline:2,marginTop:2},children:[e.jsx(h,{variant:"h5",component:"h5",sx:{wordBreak:"break-all",textAlign:"start"},children:t.name}),t.description&&e.jsx(T,{fontSize:"small",title:t.description})]}),e.jsxs(o,{sx:{padding:1},children:[t.contacts.filter(a=>a.type==="E-mail").map(a=>e.jsx(q,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:a.id===r.contact.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,marginTop:1,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{I(t.id,t.name,a.id,a.contact),s()},children:e.jsxs(o,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(h,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:a.contact}),a.description&&e.jsx(T,{fontSize:"small",title:a.description})]})},a.id)),t.contacts.filter(a=>a.type==="E-mail").length===0&&e.jsx(h,{variant:"p",component:"p",sx:{color:"var(--outline)",margin:1,marginTop:0},children:"Não há contactos de e-mail disponíveis!"})]})]})})]})};export{ae as default};
