import{d as A,e as I,p as z,r as c,j as a,S as s,aV as v,aW as f,h as l,aO as h,a7 as O,aE as B,aM as $,aN as F,aF as N,aP as P,ag as k,aQ as U,aG as W,aX as R,aY as V,f as q,B as G,aZ as K,a_ as Q,aK as X,a$ as Y}from"./index-QasZhORg.js";import{f as j}from"./phone-B8ybmA3k.js";import{E as Z}from"./Edit-CaWpXbPs.js";import"./isPossiblePhoneNumber-DES16dOz.js";const ae=()=>{const _=A(),{id:u,role:y}=I(),{findAllEmployees:C,deleteEmployee:g}=z(),{data:m,isLoading:E}=C,[p,x]=c.useState({isOpen:!1,userId:null}),S=e=>{x({isOpen:!0,userId:e})},r=()=>{x({isOpen:!1,userId:null})},D=()=>new Promise((e,t)=>{p.userId?g.mutateAsync({userId:p.userId}).then(()=>{r(),e()}).catch(()=>{r(),t()}):(r(),t())}),M=c.useMemo(()=>m?m.filter(e=>e.user.id!==u):[],[m,u]),L=c.useMemo(()=>[{id:"user.username",label:"Utilizador",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,n,i,d,o;return a.jsxs(s,{sx:{flexDirection:"row",justifyContent:"flex-start",alignItems:"center",gap:1},children:[a.jsx(v,{alt:(t=e==null?void 0:e.user)==null?void 0:t.username,src:`${f}/users/${(n=e==null?void 0:e.user)==null?void 0:n.id}/avatar?size=80`,name:(i=e==null?void 0:e.user)==null?void 0:i.username}),a.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(l,{variant:"p",component:"p",fontWeight:500,children:(d=e==null?void 0:e.user)==null?void 0:d.username}),a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:(o=e==null?void 0:e.user)==null?void 0:o.role})]})]})}},{id:"user.is_active",label:"Estado",align:"left",sortable:!0,renderComponent:({row:e})=>{var t;return a.jsx(a.Fragment,{children:(t=e==null?void 0:e.user)!=null&&t.is_active?a.jsx(h,{color:"success",label:"Ativo"}):a.jsx(h,{color:"error",label:"Inativo"})})}},{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>{var t;return e!=null&&e.name?a.jsx(O,{to:`/employee/${(t=e==null?void 0:e.user)==null?void 0:t.id}`,children:e==null?void 0:e.name}):a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})}},{id:"user.email",label:"E-mail",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,n;return(t=e==null?void 0:e.user)!=null&&t.email?(n=e==null?void 0:e.user)==null?void 0:n.email:a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})}},{id:"phone_number",label:"Contacto",align:"left",sortable:!0,renderComponent:({row:e})=>e!=null&&e.phone_number?j(e==null?void 0:e.phone_number):a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"country",label:"País",align:"left",sortable:!0,renderComponent:({row:e})=>e!=null&&e.country?e==null?void 0:e.country:a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"city",label:"Cidade",align:"left",sortable:!0,renderComponent:({row:e})=>e!=null&&e.city?e==null?void 0:e.city:a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"locality",label:"Localidade",align:"left",sortable:!0,renderComponent:({row:e})=>e!=null&&e.locality?e==null?void 0:e.locality:a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"address",label:"Morada",align:"left",sortable:!0,renderComponent:({row:e})=>e!=null&&e.address?e==null?void 0:e.address:a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"postal_code",label:"Código postal",align:"left",sortable:!0,renderComponent:({row:e})=>e!=null&&e.postal_code?e==null?void 0:e.postal_code:a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,n,i,d,o,b;return a.jsx(a.Fragment,{children:((t=e==null?void 0:e.user)==null?void 0:t.role)!=="Chefe"&&(e!=null&&e.created_by_user)?a.jsxs(s,{sx:{flexDirection:"row",gap:2},children:[a.jsx(s,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?a.jsxs(a.Fragment,{children:[a.jsx(v,{alt:(n=e==null?void 0:e.created_by_user)==null?void 0:n.username,src:`${f}/users/${(i=e==null?void 0:e.created_by_user)==null?void 0:i.id}/avatar?size=80`,name:(d=e==null?void 0:e.created_by_user)==null?void 0:d.username}),a.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(l,{variant:"p",component:"p",fontWeight:500,children:(o=e==null?void 0:e.created_by_user)==null?void 0:o.username}),a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:(b=e==null?void 0:e.created_by_user)==null?void 0:b.role})]})]}):a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),a.jsx(B,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(l,{variant:"p",component:"p",fontWeight:500,children:$(e==null?void 0:e.created_at_datetime)}),a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:F(e==null?void 0:e.created_at_datetime)})]})]}):a.jsx(l,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>(e==null?void 0:e.user.role)!=="Chefe"&&!(y==="Administrador"&&(e==null?void 0:e.user.role)==="Administrador")?a.jsx(N,{mode:"custom",customButton:a.jsx(P,{title:"Mais opções",sx:{margin:-1},children:a.jsx(k,{children:a.jsx(U,{})})}),children:a.jsx(W,{buttons:[{label:"Editar",icon:a.jsx(Z,{fontSize:"small"}),onClick:()=>{var t;return _(`/employee/${(t=e==null?void 0:e.user)==null?void 0:t.id}`)}},{label:"Eliminar",icon:a.jsx(R,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>{var t;return S((t=e==null?void 0:e.user)==null?void 0:t.id)}}]})}):null}],[]),T=c.useMemo(()=>[{id:"user.username",label:"Utilizador"},{id:"user.is_active",label:"Estado",formatter:e=>e===!0?"Ativo":"Desativo",color:e=>e===!0?"success":"error"},{id:"name",label:"Nome"},{id:"user.email",label:"E-mail"},{id:"phone_number",label:"Contacto",formatter:j},{id:"country",label:"País"},{id:"city",label:"Cidade"},{id:"locality",label:"Localidade"},{id:"address",label:"Morada"},{id:"postal_code",label:"Código postal"},{id:"created_by_user.username",label:"Criado por"},{id:"created_at_datetime",label:"Data de criação",formatter:e=>e?V(e):""}],[]);return a.jsx(q,{elevation:1,children:a.jsxs(G,{sx:{marginTop:3},children:[a.jsx(K,{isLoading:E,LoadingComponent:a.jsx(Q,{mode:"datatable"}),LoadedComponent:a.jsx(X,{mode:"datatable",data:M??[],columns:L,exportFileName:"funcionarios",exportColumns:T})}),a.jsx(Y,{mode:"delete",title:"Eliminar Funcionário",open:p.isOpen,onClose:r,onSubmit:D,description:"Tem a certeza que deseja eliminar este funcionário?",subDescription:"Ao eliminar este funcionário, os dados serão removidos de forma permanente."})]})})};export{ae as default};
