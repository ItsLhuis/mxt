import{r as p,j as a,S as l,aV as E,aW as L,h as s,aE as S,aM as B,aN as P,B as m,b8 as H,aO as T,bb as z,b9 as u,b7 as W,aK as x,f as o,H as N,aZ as O,a_ as $}from"./index-DJpfvod0.js";import{g as A}from"./getValidChipColor-D8WVyITM.js";import{C as h}from"./Check-D1jSKKzw.js";import{P as K,I as Q,Q as U}from"./QuestionMark-mRkQ2knm.js";import{H as V}from"./History-r8vFQPvs.js";const X=({repair:F,isLoading:I,isError:k})=>{const v=!I&&!k,M=p.useMemo(()=>[{id:"type",label:"Atividade",align:"left",sortable:!0},{id:"responsible_user",label:"Responsável",align:"left",sortable:!1,renderComponent:({row:i})=>{var f,c,e,t,n;return a.jsx(a.Fragment,{children:i!=null&&i.responsible_user?a.jsxs(l,{sx:{flexDirection:"row",gap:2},children:[a.jsxs(l,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[a.jsx(E,{alt:(f=i==null?void 0:i.responsible_user)==null?void 0:f.username,src:`${L}/users/${(c=i==null?void 0:i.responsible_user)==null?void 0:c.id}/avatar?size=80`,name:(e=i==null?void 0:i.responsible_user)==null?void 0:e.username}),a.jsxs(l,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(s,{variant:"p",component:"p",fontWeight:500,children:(t=i==null?void 0:i.responsible_user)==null?void 0:t.username}),a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:(n=i==null?void 0:i.responsible_user)==null?void 0:n.role})]})]}),a.jsx(S,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(l,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(s,{variant:"p",component:"p",fontWeight:500,children:B(i==null?void 0:i.created_at_datetime)}),a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:P(i==null?void 0:i.created_at_datetime)})]})]}):a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})})}}],[]),R=p.useMemo(()=>({row:i})=>{const f=p.useMemo(()=>[{id:"field",label:"Campo",align:"left",sortable:!0},{id:"before",label:"Antes",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,n;return((e==null?void 0:e.field)==="Descrição da entrada"||(e==null?void 0:e.field)==="Descrição dos acessórios da entrada"||(e==null?void 0:e.field)==="Descrição dos problemas reportados"||(e==null?void 0:e.field)==="Descrição dos trabalhos realizados"||(e==null?void 0:e.field)==="Descrição dos acessórios da intervenção"||(e==null?void 0:e.field)==="Descrição da intervenção")&&e!=null&&e.before?a.jsx(m,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:a.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:H(e==null?void 0:e.before)})}):(e==null?void 0:e.field)==="Estado"&&e!=null&&e.before?a.jsx(T,{label:(t=e==null?void 0:e.before)==null?void 0:t.name,color:A((n=e==null?void 0:e.before)==null?void 0:n.color)}):((e==null?void 0:e.field)==="Data de entrada"||(e==null?void 0:e.field)==="Data de conclusão"||(e==null?void 0:e.field)==="Data de entrega")&&e!=null&&e.before?a.jsx(a.Fragment,{children:z(e==null?void 0:e.before)}):(e==null?void 0:e.field)==="Cliente notificado"?a.jsx(a.Fragment,{children:e!=null&&e.before?a.jsx(h,{color:"success"}):a.jsx(u,{color:"error"})}):(e==null?void 0:e.field)==="Acessórios da entrada"||(e==null?void 0:e.field)==="Problemas reportados"||(e==null?void 0:e.field)==="Trabalhos realizados"||(e==null?void 0:e.field)==="Acessórios da intervenção"?e!=null&&e.before&&(e==null?void 0:e.before.length)>0?e==null?void 0:e.before.map(d=>d==null?void 0:d.name).join(", "):a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"}):e!=null&&e.before?e==null?void 0:e.before:a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})}},{id:"after",label:"Depois",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,n,d,j,r,g,C,D,_,y;return((e==null?void 0:e.field)==="Descrição da entrada"||(e==null?void 0:e.field)==="Descrição dos acessórios da entrada"||(e==null?void 0:e.field)==="Descrição dos problemas reportados"||(e==null?void 0:e.field)==="Descrição dos trabalhos realizados"||(e==null?void 0:e.field)==="Descrição dos acessórios da intervenção"||(e==null?void 0:e.field)==="Descrição da intervenção")&&e!=null&&e.after?a.jsx(m,{sx:{maxHeight:300,overflow:"hidden",overflowY:"auto",borderRadius:"8px",border:"1px solid var(--elevation-level5)",padding:2},children:a.jsx("span",{className:"table-cell-tiptap-editor",dangerouslySetInnerHTML:H(e==null?void 0:e.after)})}):(e==null?void 0:e.field)==="Equipamento"&&e!=null&&e.after?a.jsx(W,{fontSize:"small",title:a.jsxs(l,{sx:{justifyContent:"center",alignItems:"flex-start",gap:1},children:[a.jsx(s,{variant:"h5",component:"h5",sx:{wordBreak:"break-all"},children:(n=(t=e==null?void 0:e.after)==null?void 0:t.client)==null?void 0:n.name}),a.jsxs(l,{sx:{flexDirection:"row",gap:1,width:"100%"},children:[a.jsx(s,{variant:"p",component:"p",sx:{wordBreak:"break-all"},children:(j=(d=e==null?void 0:e.after)==null?void 0:d.type)==null?void 0:j.name}),a.jsx(S,{flexItem:!0,sx:{borderColor:"var(--outline)",borderWidth:1}}),a.jsxs(s,{variant:"p",component:"p",sx:{wordBreak:"break-all"},children:[(g=(r=e==null?void 0:e.after)==null?void 0:r.brand)==null?void 0:g.name," ",(D=(C=e==null?void 0:e.after)==null?void 0:C.model)==null?void 0:D.name]})]})]})}):(e==null?void 0:e.field)==="Estado"&&e!=null&&e.after?a.jsx(T,{label:(_=e==null?void 0:e.after)==null?void 0:_.name,color:A((y=e==null?void 0:e.after)==null?void 0:y.color)}):((e==null?void 0:e.field)==="Data de entrada"||(e==null?void 0:e.field)==="Data de conclusão"||(e==null?void 0:e.field)==="Data de entrega")&&e!=null&&e.after?a.jsx(a.Fragment,{children:z(e==null?void 0:e.after)}):(e==null?void 0:e.field)==="Cliente notificado"?a.jsx(a.Fragment,{children:e!=null&&e.after?a.jsx(h,{color:"success"}):a.jsx(u,{color:"error"})}):(e==null?void 0:e.field)==="Acessórios da entrada"||(e==null?void 0:e.field)==="Problemas reportados"||(e==null?void 0:e.field)==="Trabalhos realizados"||(e==null?void 0:e.field)==="Acessórios da intervenção"?e!=null&&e.after&&(e==null?void 0:e.after.length)>0?e==null?void 0:e.after.map(b=>b==null?void 0:b.name).join(", "):a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"}):e!=null&&e.after?e==null?void 0:e.after:a.jsx(s,{variant:"p",component:"p",color:"var(--outline)",children:"Sem valor"})}},{id:"changed",label:"Alterado",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsx(a.Fragment,{children:e!=null&&e.changed?a.jsx(h,{color:"success"}):a.jsx(u,{color:"error"})})}],[]),c=p.useMemo(()=>[{id:"file_mime_type",label:"Tipo",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsx(l,{sx:{alignItems:"flex-start"},children:e.file_mime_type==="application/pdf"?a.jsx(K,{fontSize:"medium",sx:{color:"rgb(223, 88, 84)"}}):e.file_mime_type.startsWith("image/")?a.jsx(Q,{fontSize:"medium",sx:{color:"rgb(245, 128, 8)"}}):a.jsx(U,{fontSize:"medium",sx:{color:"var(--outline)"}})})},{id:"original_filename",label:"Ficheiro",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsxs(l,{children:[a.jsx(s,{variant:"p",component:"p",children:e.original_filename}),a.jsx(s,{variant:"p",component:"p",sx:{color:"var(--outline)"},children:`${e.file_size<1024*1024?(e.file_size/1024).toFixed(2)+" Kb":(e.file_size/(1024*1024)).toFixed(2)+" Mb"}`})]})}],[]);return a.jsx(m,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden",margin:3},children:i.details[0].field==="Anexos"?a.jsx(a.Fragment,{children:i.details[0].after?a.jsx(x,{data:i.details[0].after??[],columns:c}):a.jsx(x,{showSearch:!1,data:[i.details[0].before],columns:c})}):a.jsx(x,{data:i.details??[],columns:f})})},[]);return a.jsxs(o,{elevation:1,children:[a.jsx(N,{title:"Histórico de Atividades",description:"Histórico de atividades sobre a reparação",icon:a.jsx(V,{})}),a.jsx(O,{isLoading:!v,LoadingComponent:a.jsx($,{mode:"datatable"}),LoadedComponent:a.jsx(m,{sx:{margin:3,border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:a.jsx(x,{mode:"datatable",data:v?F[0].interactions_history:[],columns:M,ExpandableContentComponent:R})})})]})};export{X as default};
