import{r as na,j as a,f as da,H as ra,aU as ea,S as ta,aM as m,aQ as j,F as u,T as H,ai as ia,aN as la,b4 as p,bc as ca,B as ha,L as xa,ab as ga,s as ma}from"./index-C9HasOiM.js";import{u as ja,b as ua,a as fa,C as f,t as pa}from"./index-BTi6rd4V.js";import{u as Ca}from"./equipment-D4V42Xnu.js";import{u as ba}from"./useEquipment-ClzBGdbo.js";import"./equipment-DQ8Bx2dX.js";const Ba=({equipment:o,isLoading:Q,isError:R})=>{var y,E,v,B,S,T,w,F,A,M,N,W,D,P,V,k,z,U;const e=!Q&&!R,{control:c,register:O,handleSubmit:G,setValue:J,getValues:K,formState:{errors:t},setError:X,reset:Y}=ja({resolver:pa(Ca)}),Z={typeId:((E=(y=o==null?void 0:o[0])==null?void 0:y.type)==null?void 0:E.id)||"",brandId:((B=(v=o==null?void 0:o[0])==null?void 0:v.brand)==null?void 0:B.id)||"",modelId:((T=(S=o==null?void 0:o[0])==null?void 0:S.model)==null?void 0:T.id)||"",sn:((w=o==null?void 0:o[0])==null?void 0:w.sn)||"",description:((F=o==null?void 0:o[0])==null?void 0:F.description)||""},{isDirty:_}=ua({control:c}),C=()=>!_;na.useEffect(()=>{e&&o&&o[0]&&Y(Z)},[e,o]);const{findAllEquipmentTypes:b,findAllEquipmentBrands:L,findAllEquipmentModelsByBrandId:$,updateEquipment:I}=ba(),{data:q,isLoading:aa,isError:oa}=$(fa({control:c,name:"brandId",defaultValue:(M=(A=o==null?void 0:o[0])==null?void 0:A.brand)==null?void 0:M.id})),sa=async s=>{!e||C()||await I.mutateAsync({equipmentId:o[0].id,...s,description:s.description===""?null:s.description}).then(()=>ga("Equipamento atualizado com sucesso!")).catch(d=>{if(d.error.code==="EQU-008"){X("sn",{type:"manual",message:"Número de série já existente"});return}ma("Erro ao atualizar equipamento!")})};return a.jsxs(da,{elevation:1,children:[a.jsx(ra,{title:"Detalhes",description:"Cliente, tipo, marca, modelo,... do equipamento",icon:a.jsx(ea,{})}),a.jsx("form",{onSubmit:G(sa),children:a.jsxs(ta,{sx:{padding:3,gap:2},children:[a.jsx(m,{isLoading:!e,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(H,{label:"Cliente",value:(W=(N=o==null?void 0:o[0])==null?void 0:N.client)==null?void 0:W.name,InputProps:{readOnly:!0,endAdornment:a.jsx(ia,{position:"end",children:((P=(D=o==null?void 0:o[0])==null?void 0:D.client)==null?void 0:P.description)&&a.jsx(la,{title:(k=(V=o==null?void 0:o[0])==null?void 0:V.client)==null?void 0:k.description})})}})})}),a.jsx(m,{isLoading:!e||b.isLoading,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(f,{name:"typeId",control:c,render:({field:s})=>{var i,l;const d=b.data??[],h=["",...d.map(n=>n.name)],x=((i=d.find(n=>n.id===s.value))==null?void 0:i.name)||"";return a.jsx(p,{ref:s.ref,label:"Tipo",data:h,value:x,onChange:n=>{const r=d.find(g=>g.name===n);s.onChange((r==null?void 0:r.id)||"")},error:!!t.typeId,helperText:(l=t.typeId)==null?void 0:l.message})}})})}),a.jsx(m,{isLoading:!e||L.isLoading,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(f,{name:"brandId",control:c,render:({field:s})=>{var i,l;const d=L.data??[],h=["",...d.map(n=>n.name)],x=((i=d.find(n=>n.id===s.value))==null?void 0:i.name)||"";return a.jsx(p,{ref:s.ref,label:"Marca",data:h,value:x,onChange:n=>{const r=d.find(g=>g.name===n);s.onChange((r==null?void 0:r.id)||""),J("modelId","")},error:!!t.brandId,helperText:(l=t.brandId)==null?void 0:l.message})}})})}),a.jsx(m,{isLoading:!e||aa&&oa,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(f,{name:"modelId",control:c,render:({field:s})=>{var i,l;const d=q??[],h=["",...d.map(n=>n.name)],x=((i=d.find(n=>n.id===s.value))==null?void 0:i.name)||"";return a.jsx(p,{ref:s.ref,label:"Modelo",data:h,value:x,onChange:n=>{const r=d.find(g=>g.name===n);s.onChange((r==null?void 0:r.id)||"")},error:!!t.modelId,helperText:(l=t.modelId)==null?void 0:l.message})}})})}),a.jsx(m,{isLoading:!e,LoadingComponent:a.jsx(j,{variant:"rounded",width:"100%",height:52}),LoadedComponent:a.jsx(u,{fullWidth:!0,children:a.jsx(H,{...O("sn"),label:"Número de série",error:!!t.sn,helperText:(z=t.sn)==null?void 0:z.message,autoComplete:"off",InputLabelProps:{shrink:((U=K("sn"))==null?void 0:U.length)>0}})})}),a.jsx(f,{name:"description",control:c,render:({field:s})=>a.jsx(ca,{label:"Descrição",value:s.value,onChange:s.onChange,isLoading:!e})}),a.jsx(ha,{sx:{marginLeft:"auto",marginTop:1},children:a.jsx(xa,{loading:I.isPending,type:"submit",variant:"contained",disabled:!e||C(),children:"Atualizar Equipamento"})})]})})]})};export{Ba as default};
