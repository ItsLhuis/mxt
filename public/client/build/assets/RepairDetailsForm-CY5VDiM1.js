const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/RepairStamp-Bukx41tq.js","assets/index-D5KQThVv.js","assets/index-DOidGzGz.css","assets/phone-B8ybmA3k.js","assets/isPossiblePhoneNumber-DES16dOz.js"])))=>i.map(i=>d[i]);
import{q as Ee,j as e,r as L,_ as Me,f as Oe,H as Ge,aB as Qe,bM as Ke,S as x,B as f,aZ as m,b6 as h,aO as Ye,G as Re,h as b,a7 as Te,b7 as Ze,F as g,b1 as Je,aF as Xe,aP as en,ag as nn,aQ as tn,aG as sn,bN as _,ba as j,L as on,bO as an,bK as dn,aj as ln,s as cn}from"./index-D5KQThVv.js";import{u as rn,b as un,a as mn,C as r,t as hn}from"./index-DCkCG_3f.js";import{u as xn}from"./repair-CEN5k9Q0.js";import{u as vn}from"./useRepair-BQF6lWd4.js";import{u as gn}from"./useCompany-C_ZHSGFP.js";import{D as S}from"./DatePicker-B4ZPpVA9.js";import{g as jn}from"./getValidChipColor-D8WVyITM.js";import{T as pn,a as We}from"./Tabs-xHvsshI4.js";import{S as Cn}from"./Switch-B_dFhpm0.js";import"./repair-DMHLqADZ.js";const Dn=Ee(e.jsx("path",{d:"M18 16h-2v-1H8v1H6v-1H2v5h20v-5h-4zm2-8h-3V6c0-1.1-.9-2-2-2H9c-1.1 0-2 .9-2 2v2H4c-1.1 0-2 .9-2 2v4h4v-2h2v2h8v-2h2v2h4v-4c0-1.1-.9-2-2-2m-5 0H9V6h6z"}),"HomeRepairService"),yn=Ee(e.jsx("path",{d:"m21.41 11.58-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42M5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7"}),"LocalOffer"),bn=(n,{margin:p=0}={})=>new Promise((v,s)=>{const l=document.createElement("iframe");document.body.appendChild(l);const C=l.contentDocument||l.contentWindow.document,w=`
        <!DOCTYPE html>
        <html>
        <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
            <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap" rel="stylesheet" />
            <style type="text/css" media="print">
                * {
                    margin: 0;
                }

                @page { 
                    margin: ${p};
                }

                body {
                    font-family: 'Poppins', Arial, sans-serif;
                    padding: 16px;
                    font-size: 13px;
                }
            </style>
        </head>
        <body>
            ${n}
        </body>
        </html>
    `;C.open(),C.write(w),C.close(),l.onload=()=>{setTimeout(()=>{try{l.contentWindow.focus(),l.contentWindow.print(),document.body.removeChild(l),v()}catch(D){document.body.removeChild(l),s(D)}})},l.onerror=D=>{document.body.removeChild(l),s(D)}}),Ln=L.lazy(()=>Me(()=>import("./RepairStamp-Bukx41tq.js"),__vite__mapDeps([0,1,2,3,4]))),Ve=n=>{const{children:p,value:v,index:s,...l}=n;return e.jsx(f,{sx:{margin:3},role:"tabpanel",hidden:v!==s,id:`repair-tabpanel-${s}`,"aria-labelledby":`repair-tab-${s}`,...l,children:v===s&&p})},Pe=n=>({id:`repair-tab-${n}`,"aria-controls":`repair-tabpanel-${n}`}),Vn=({repair:n,isLoading:p,isError:v})=>{var z,N,F,$,M,O,G,Q,K,Y,Z,J,X,ee,ne,te,se,oe,ie,ae,de,le,ce,re,ue,me,he,xe,ve,ge,je,pe,Ce,De,ye,be,Le,fe,Ie,_e,we,ke,Ae;const s=!p&&!v,[l,C]=L.useState(0),w=(t,o)=>{C(o)},[D,R]=L.useState(!1),T=L.useRef(null),I=async()=>{R(!0);try{await bn(T.current.innerHTML)}finally{R(!1)}},{control:d,handleSubmit:He,reset:qe,getValues:k,formState:{errors:c}}=rn({resolver:hn(xn)}),W={statusId:((N=(z=n==null?void 0:n[0])==null?void 0:z.status)==null?void 0:N.id)||"",entryDatetime:(F=n==null?void 0:n[0])!=null&&F.entry_datetime?new Date(($=n==null?void 0:n[0])==null?void 0:$.entry_datetime):null,entryAccessories:((O=(M=n==null?void 0:n[0])==null?void 0:M.entry_accessories)==null?void 0:O.map(t=>t.id))||[],entryAccessoriesDescription:((G=n==null?void 0:n[0])==null?void 0:G.entry_accessories_description)||"",entryReportedIssues:((K=(Q=n==null?void 0:n[0])==null?void 0:Q.entry_reported_issues)==null?void 0:K.map(t=>t.id))||[],entryReportedIssuesDescription:((Y=n==null?void 0:n[0])==null?void 0:Y.entry_reported_issues_description)||"",entryDescription:((Z=n==null?void 0:n[0])==null?void 0:Z.entry_description)||"",interventionWorksDone:((X=(J=n==null?void 0:n[0])==null?void 0:J.intervention_works_done)==null?void 0:X.map(t=>t.id))||[],interventionWorksDoneDescription:((ee=n==null?void 0:n[0])==null?void 0:ee.intervention_works_done_description)||"",interventionAccessoriesUsed:((te=(ne=n==null?void 0:n[0])==null?void 0:ne.intervention_accessories_used)==null?void 0:te.map(t=>t.id))||[],interventionAccessoriesUsedDescription:((se=n==null?void 0:n[0])==null?void 0:se.intervention_accessories_used_description)||"",conclusionDatetime:(oe=n==null?void 0:n[0])!=null&&oe.conclusion_datetime?new Date((ie=n==null?void 0:n[0])==null?void 0:ie.conclusion_datetime):null,deliveryDatetime:(ae=n==null?void 0:n[0])!=null&&ae.delivery_datetime?new Date((de=n==null?void 0:n[0])==null?void 0:de.delivery_datetime):null,isClientNotified:!!((le=n==null?void 0:n[0])!=null&&le.is_client_notified)||!1,interventionDescription:((ce=n==null?void 0:n[0])==null?void 0:ce.intervention_description)||""},{isDirty:Be}=un({control:d}),V=()=>!Be;L.useEffect(()=>{s&&n&&n[0]&&qe(W)},[s,n]);const{findAllRepairStatuses:P,findAllEntryAccessories:E,findAllEntryReportedIssues:H,findAllInterventionWorksDone:q,findAllInterventionAccessoriesUsed:B,updateRepair:U}=vn(),{findCompany:Ue}=gn(),ze=async t=>{!s||V()||await U.mutateAsync({repairId:n[0].id,...t,entryAccessoriesDescription:t.entryAccessoriesDescription===""?null:t.entryAccessoriesDescription,entryReportedIssuesDescription:t.entryReportedIssuesDescription===""?null:t.entryReportedIssuesDescription,entryDescription:t.entryDescription===""?null:t.entryDescription,interventionWorksDoneDescription:t.interventionWorksDoneDescription===""?null:t.interventionWorksDoneDescription,interventionAccessoriesUsedDescription:t.interventionAccessoriesUsedDescription===""?null:t.interventionAccessoriesUsedDescription,interventionDescription:t.interventionDescription===""?null:t.interventionDescription}).then(()=>ln("Reparação atualizada com sucesso!")).catch(o=>{if(o.error.code==="EQU-008"){setError("sn",{type:"manual",message:"Número de série já existente"});return}cn("Erro ao atualizar reparação!")})},Ne=[{label:"Cliente",link:`/client/${(ue=(re=n==null?void 0:n[0].equipment)==null?void 0:re.client)==null?void 0:ue.id}`,value:(he=(me=n==null?void 0:n[0].equipment)==null?void 0:me.client)==null?void 0:he.name,description:(ve=(xe=n==null?void 0:n[0].equipment)==null?void 0:xe.client)==null?void 0:ve.description},{label:"Equipamento",link:`/equipment/${(ge=n==null?void 0:n[0].equipment)==null?void 0:ge.id}`,value:`${(pe=(je=n==null?void 0:n[0].equipment)==null?void 0:je.type)==null?void 0:pe.name} | ${(De=(Ce=n==null?void 0:n[0].equipment)==null?void 0:Ce.brand)==null?void 0:De.name} ${(be=(ye=n==null?void 0:n[0].equipment)==null?void 0:ye.model)==null?void 0:be.name}`,description:(Le=n==null?void 0:n[0].equipment)==null?void 0:Le.description}],Fe=mn({control:d,name:"isClientNotified"});return e.jsxs(Oe,{elevation:1,children:[e.jsx(Ge,{title:"Detalhes",description:"Dados da reparação",icon:e.jsx(Qe,{})}),e.jsx(Ke,{children:e.jsx(Ln,{ref:T,equipmentId:(Ie=(fe=n==null?void 0:n[0])==null?void 0:fe.equipment)==null?void 0:Ie.id,companyData:Ue.data})}),e.jsx("form",{onSubmit:He(ze),children:e.jsxs(x,{children:[e.jsxs(x,{children:[e.jsx(f,{sx:{paddingInline:3,paddingTop:2},children:e.jsx(m,{isLoading:!s,LoadingComponent:e.jsx(h,{variant:"rounded",width:70,height:32}),LoadedComponent:e.jsx(Ye,{label:(we=(_e=n==null?void 0:n[0])==null?void 0:_e.status)==null?void 0:we.name,color:jn((Ae=(ke=n==null?void 0:n[0])==null?void 0:ke.status)==null?void 0:Ae.color)})})}),e.jsx(Re,{container:!0,spacing:2,sx:{paddingInline:3},children:Ne.map((t,o)=>e.jsx(Re,{item:!0,xs:12,children:e.jsx(m,{isLoading:!s,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsxs(x,{children:[e.jsx(b,{variant:"p",component:"p",sx:{color:"var(--outline)",fontWeight:550},children:t.label}),t.value?e.jsxs(x,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(b,{variant:"p",component:"p",children:t.isHtml?t.link?e.jsx(Te,{to:t.link,dangerouslySetInnerHTML:{__html:t.value}}):e.jsx("span",{dangerouslySetInnerHTML:{__html:t.value}}):t.link?e.jsx(Te,{to:t.link,children:t.value}):e.jsx("span",{children:t.value})}),t.description&&e.jsx(Ze,{fontSize:"small",title:t.description})]}):e.jsx(b,{variant:"p",component:"p",sx:{color:"var(--outline)"},children:"Sem valor"})]})})},o))}),e.jsx(x,{sx:{padding:3,paddingBottom:0},children:e.jsx(m,{isLoading:!s||P.isLoading,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(g,{fullWidth:!0,children:e.jsx(r,{name:"statusId",control:d,defaultValue:"",render:({field:t})=>{var i,Se;const o=P.data??[],a=["",...o.map(y=>y.name)],u=((i=o.find(y=>y.id===t.value))==null?void 0:i.name)||"";return e.jsx(Je,{ref:t.ref,label:"Estado",data:a,value:u,onChange:y=>{const A=o.find($e=>$e.name===y);t.onChange((A==null?void 0:A.id)||"")},error:!!c.statusId,helperText:(Se=c.statusId)==null?void 0:Se.message})}})})})}),e.jsxs(f,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:2,margin:3},children:[e.jsxs(x,{sx:{flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderBottom:"2px solid var(--elevation-level5)"},children:[e.jsxs(pn,{value:l,onChange:w,"aria-label":"repair-tabs",variant:"scrollable",scrollButtons:"auto",allowScrollButtonsMobile:!0,sx:{paddingInline:3},children:[e.jsx(We,{icon:e.jsx(yn,{fontSize:"inherit"}),label:"Entrada",...Pe("Entrada")}),e.jsx(We,{icon:e.jsx(Dn,{fontSize:"inherit"}),label:"Intervenção",...Pe("Intervenção")})]}),e.jsx(f,{sx:{paddingRight:.5},children:e.jsx(m,{isLoading:!s,LoadingComponent:e.jsx(h,{variant:"circular",width:40,height:40}),LoadedComponent:e.jsx(Xe,{mode:"custom",customButton:e.jsx(en,{title:"Mais opções",children:e.jsx(nn,{children:e.jsx(tn,{})})}),children:e.jsx(sn,{buttons:[{title:"Print",label:"Selo",onClick:I},{label:"Ficha informativa",onClick:I},{label:"Entrada",onClick:I},,{label:"Saída",onClick:I}]})})})})]}),e.jsx(Ve,{value:l,index:0,children:e.jsxs(x,{sx:{gap:2},children:[e.jsx(m,{isLoading:!s,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(r,{name:"entryDatetime",control:d,defaultValue:null,render:({field:t})=>{var o,a;return e.jsx(S,{label:"Data de entrada",value:t.value,onChange:t.onChange,error:!!c.entryDatetime,helperText:(o=c.entryDatetime)==null?void 0:o.message,InputLabelProps:{shrink:((a=k("entryDatetime"))==null?void 0:a.length)>0}})}})}),e.jsx(m,{isLoading:!s||E.isLoading,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(g,{fullWidth:!0,children:e.jsx(r,{name:"entryAccessories",control:d,defaultValue:[],render:({field:t})=>{var u;const a=(E.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(_,{label:"Acessórios",data:a,selectedIds:t.value,onChange:i=>{t.onChange(i)},error:!!c.entryAccessories,helperText:(u=c.entryAccessories)==null?void 0:u.message})}})})}),e.jsx(r,{name:"entryAccessoriesDescription",control:d,defaultValue:"",render:({field:t})=>e.jsx(j,{label:"Descrição dos acessórios",value:t.value,onChange:t.onChange,isLoading:!s})}),e.jsx(m,{isLoading:!s||H.isLoading,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(g,{fullWidth:!0,children:e.jsx(r,{name:"entryReportedIssues",control:d,defaultValue:[],render:({field:t})=>{var u;const a=(H.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(_,{label:"Problemas reportados",data:a,selectedIds:t.value,onChange:i=>{t.onChange(i)},error:!!c.entryReportedIssues,helperText:(u=c.entryReportedIssues)==null?void 0:u.message})}})})}),e.jsx(r,{name:"entryReportedIssuesDescription",control:d,defaultValue:"",render:({field:t})=>e.jsx(j,{label:"Descrição dos problemas reportados",value:t.value,onChange:t.onChange,isLoading:!s})}),e.jsx(r,{name:"entryDescription",control:d,defaultValue:"",render:({field:t})=>e.jsx(j,{label:"Descrição da entrada",value:t.value,onChange:t.onChange,isLoading:!s})})]})}),e.jsx(Ve,{value:l,index:1,children:e.jsxs(x,{sx:{gap:2},children:[e.jsx(m,{isLoading:!s||q.isLoading,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(g,{fullWidth:!0,children:e.jsx(r,{name:"interventionWorksDone",control:d,defaultValue:[],render:({field:t})=>{var u;const a=(q.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(_,{label:"Trabalhos realizados",data:a,selectedIds:t.value,onChange:i=>{t.onChange(i)},error:!!c.interventionWorksDone,helperText:(u=c.interventionWorksDone)==null?void 0:u.message})}})})}),e.jsx(r,{name:"interventionWorksDoneDescription",control:d,defaultValue:"",render:({field:t})=>e.jsx(j,{label:"Descrição dos trabalhos realizados",value:t.value,onChange:t.onChange,isLoading:!s})}),e.jsx(m,{isLoading:!s||B.isLoading,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(g,{fullWidth:!0,children:e.jsx(r,{name:"interventionAccessoriesUsed",control:d,defaultValue:[],render:({field:t})=>{var u;const a=(B.data??[]).map(i=>({id:i.id,name:i.name}));return e.jsx(_,{label:"Acessórios usados",data:a,selectedIds:t.value,onChange:i=>{t.onChange(i)},error:!!c.interventionAccessoriesUsed,helperText:(u=c.interventionAccessoriesUsed)==null?void 0:u.message})}})})}),e.jsx(r,{name:"interventionAccessoriesUsedDescription",control:d,defaultValue:"",render:({field:t})=>e.jsx(j,{label:"Descrição dos acessórios usados",value:t.value,onChange:t.onChange,isLoading:!s})}),e.jsx(m,{isLoading:!s,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(r,{name:"conclusionDatetime",control:d,defaultValue:null,render:({field:t})=>{var o,a;return e.jsx(S,{label:"Data de conclusão",value:t.value,onChange:t.onChange,error:!!c.conclusionDatetime,helperText:(o=c.conclusionDatetime)==null?void 0:o.message,InputLabelProps:{shrink:((a=k("conclusionDatetime"))==null?void 0:a.length)>0}})}})}),e.jsx(m,{isLoading:!s,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(r,{name:"deliveryDatetime",control:d,defaultValue:null,render:({field:t})=>{var o,a;return e.jsx(S,{label:"Data de entrega",value:t.value,onChange:t.onChange,error:!!c.deliveryDatetime,helperText:(o=c.deliveryDatetime)==null?void 0:o.message,InputLabelProps:{shrink:((a=k("deliveryDatetime"))==null?void 0:a.length)>0}})}})}),e.jsx(m,{isLoading:!s,LoadingComponent:e.jsx(h,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(g,{fullWidth:!0,children:e.jsxs(x,{sx:{flexDirection:"row",alignItems:"center"},children:[e.jsx(r,{name:"isClientNotified",control:d,render:({field:t})=>e.jsx(Cn,{edge:"start",value:t.value,onChange:t.onChange,defaultChecked:W.isClientNotified})}),e.jsxs(x,{children:[e.jsx(b,{variant:"p",component:"p",children:"Cliente notificado"}),e.jsx(b,{variant:"p",component:"p",sx:{color:"var(--outline)"},children:Fe?"Sim":"Não"})]})]})})}),e.jsx(r,{name:"interventionDescription",control:d,defaultValue:"",render:({field:t})=>e.jsx(j,{label:"Descrição da intervenção",value:t.value,onChange:t.onChange,isLoading:!s})})]})})]})]}),e.jsx(f,{sx:{padding:3,paddingTop:0,marginLeft:"auto"},children:e.jsx(on,{loading:U.isPending,type:"submit",variant:"contained",disabled:!s||V(),children:"Atualizar Reparação"})})]})}),e.jsx(an,{sx:{zIndex:99999},open:D,children:e.jsx(dn,{})})]})};export{Vn as default};
