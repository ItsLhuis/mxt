import{d as L,r as T,j as e,S as s,f as k,H as w,aV as A,aM as R,aQ as B,F as q,b4 as F,T as M,ai as H,aH as O,aj as P,bi as V,bc as $,B as W,L as z,b2 as K,aD as Q,h as u,aN as G,a$ as J}from"./index-C9HasOiM.js";import{u as U,C as x,t as X}from"./index-BTi6rd4V.js";import{r as Y}from"./repair-C13Y1Qe-.js";import{u as Z}from"./useEquipment-ClzBGdbo.js";import{u as _}from"./useRepair-Cho1bqHB.js";import{D as ee}from"./DatePicker-DKvslnkv.js";import"./equipment-DQ8Bx2dX.js";import"./repair-DgMqRd6F.js";import"./Tabs-DFEwvjbC.js";const me=()=>{var b;const y=L(),{control:l,handleSubmit:C,setValue:S,formState:{errors:r}}=U({resolver:X(Y)}),[t,d]=T.useState({isOpen:!1,equipment:{id:null,clientName:"",typeName:"",brandName:"",modelName:""}}),h=()=>{d(a=>({...a,isOpen:!0}))},D=()=>{d(a=>({...a,isOpen:!1}))},I=(a,n,m,p,i)=>{d({equipment:{id:a,clientName:n,typeName:m,brandName:p,modelName:i}}),S("equipmentId",a)},{findAllEquipments:g}=Z(),{createNewRepair:j,findAllRepairStatuses:f}=_(),E=async a=>{await j.mutateAsync({...a,entryDescription:a.entryDescription===""?null:a.entryDescription}).then(()=>y("/repair/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:C(E),children:e.jsx(s,{sx:{marginTop:3,gap:3},children:e.jsxs(k,{elevation:1,children:[e.jsx(w,{title:"Detalhes",description:"Estado, equipamento, data da entrada,... da reparação",icon:e.jsx(A,{})}),e.jsxs(s,{sx:{padding:3,gap:2},children:[e.jsx(R,{isLoading:f.isLoading,LoadingComponent:e.jsx(B,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(q,{fullWidth:!0,children:e.jsx(x,{name:"statusId",control:l,defaultValue:"",render:({field:a})=>{var i,v;const n=f.data??[],m=["",...n.map(o=>o.name)],p=((i=n.find(o=>o.id===a.value))==null?void 0:i.name)||"";return e.jsx(F,{ref:a.ref,label:"Estado",data:m,value:p,onChange:o=>{const c=n.find(N=>N.name===o);a.onChange((c==null?void 0:c.id)||"")},error:!!r.statusId,helperText:(v=r.statusId)==null?void 0:v.message})}})})}),e.jsx(q,{fullWidth:!0,children:e.jsx(M,{label:"Equipamento",placeholder:"Selecione um equipamento",value:t.equipment.clientName?`${t.equipment.typeName} | ${t.equipment.brandName} ${t.equipment.modelName} (${t.equipment.clientName})`:"",onClick:h,InputProps:{readOnly:!0,startAdornment:e.jsx(H,{position:"start",children:e.jsx(O,{children:e.jsx(P,{onClick:h,children:e.jsx(V,{})})})})},error:!!r.equipmentId,helperText:(b=r.equipmentId)==null?void 0:b.message})}),e.jsx(x,{name:"entryDatetime",control:l,defaultValue:new Date,render:({field:a})=>{var n;return e.jsx(ee,{label:"Data de entrada",value:a.value,onChange:a.onChange,error:!!r.entryDatetime,helperText:(n=r.entryDatetime)==null?void 0:n.message})}}),e.jsx(x,{name:"entryDescription",control:l,defaultValue:"",render:({field:a})=>e.jsx($,{label:"Descrição da entrada",value:a.value,onChange:a.onChange})}),e.jsx(W,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(z,{loading:j.isPending,type:"submit",variant:"contained",children:"Adicionar Reparação"})})]})]})})}),e.jsx(K,{open:t.isOpen??!1,onClose:D,mode:"data",data:g.data??[],searchKeys:["client.name","type.name","brand.name","model.name"],isLoading:g.isLoading,title:"Equipamentos",placeholder:"Pesquise por um equipamento",buttonStructure:(a,n)=>e.jsx(Q,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:a.id===t.equipment.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{I(a.id,a.client.name,a.type.name,a.brand.name,a.model.name),n()},children:e.jsxs(s,{sx:{alignItems:"flex-start"},children:[e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1,marginBottom:1},children:[e.jsx(u,{variant:"h5",component:"h5",sx:{wordBreak:"break-all",textAlign:"start"},children:a.client.name}),a.client.description&&e.jsx(G,{fontSize:"small",title:a.client.description})]}),e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(u,{variant:"p",component:"p",children:a.type.name}),e.jsx(J,{flexItem:!0,sx:{borderColor:"var(--outline)",opacity:.5,borderWidth:1}}),e.jsxs(u,{variant:"p",component:"p",children:[a.brand.name," ",a.model.name]})]})]})})})]})};export{me as default};
