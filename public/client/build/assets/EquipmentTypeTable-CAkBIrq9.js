import{r,j as t,S as s,b0 as z,h as a,aF as f,aG as _,aI as h,aJ as b,aK as y,aL as L,aM as B,ah as A,aN as F,aO as W,aP as k,aQ as j,f as U,B as $,aR as N,aS as P,aT as R,aU as Q,ak as G,s as v}from"./index-_NktdslD.js";import{u as J}from"./useEquipment-Dy7ZmQ0L.js";import{E as K}from"./List-Bl7C1mXS.js";import{E as V}from"./Edit-9t-WI8hJ.js";import"./Container-C5zSTFrd.js";import"./Add-BwlUZUTu.js";const te=()=>{const{findAllEquipmentTypes:E,deleteEquipmentType:T}=J(),{data:g,isLoading:C}=E,[c,u]=r.useState({isOpen:!1,type:null}),q=e=>{u({isOpen:!0,type:e})},D=()=>{u({isOpen:!1,type:null})},[m,x]=r.useState({isOpen:!1,typeId:null}),M=e=>{x({isOpen:!0,typeId:e})},l=()=>{x({isOpen:!1,typeId:null})},S=()=>new Promise((e,i)=>{m.typeId?T.mutateAsync({typeId:m.typeId}).then(()=>{G("Tipo eliminado com sucesso!"),l(),e()}).catch(n=>{if(n.error.code==="EQU-012"){l(),v("Este tipo está associado a um ou mais equipamentos e não pode ser eliminado!",{duration:6e3}),i();return}l(),v("Erro ao eliminar tipo"),i()}):(l(),i())}),O=r.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>t.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&t.jsx(z,{title:e==null?void 0:e.description})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,n,d,o,p;return t.jsx(t.Fragment,{children:t.jsxs(s,{sx:{flexDirection:"row",gap:2},children:[t.jsx(s,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?t.jsxs(t.Fragment,{children:[t.jsx(f,{alt:(i=e==null?void 0:e.created_by_user)==null?void 0:i.username,src:`${_}/users/${(n=e==null?void 0:e.created_by_user)==null?void 0:n.id}/avatar?size=80`,name:(d=e==null?void 0:e.created_by_user)==null?void 0:d.username}),t.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(o=e==null?void 0:e.created_by_user)==null?void 0:o.username}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(p=e==null?void 0:e.created_by_user)==null?void 0:p.role})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),t.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),t.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:b(e==null?void 0:e.created_at_datetime)}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:y(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,n,d,o,p;return t.jsx(t.Fragment,{children:e!=null&&e.last_modified_datetime?t.jsxs(s,{sx:{flexDirection:"row",gap:2},children:[t.jsx(s,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?t.jsxs(t.Fragment,{children:[t.jsx(f,{alt:(i=e==null?void 0:e.last_modified_by_user)==null?void 0:i.username,src:`${_}/users/${(n=e==null?void 0:e.last_modified_by_user)==null?void 0:n.id}/avatar?size=80`,name:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.username}),t.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.username}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(p=e==null?void 0:e.last_modified_by_user)==null?void 0:p.role})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),t.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),t.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[t.jsx(a,{variant:"p",component:"p",fontWeight:500,children:b(e==null?void 0:e.last_modified_datetime)}),t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:y(e==null?void 0:e.last_modified_datetime)})]})]}):t.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>t.jsx(L,{mode:"custom",customButton:t.jsx(B,{title:"Mais opções",sx:{margin:-1},children:t.jsx(A,{children:t.jsx(F,{})})}),children:t.jsx(W,{buttons:[{label:"Editar",icon:t.jsx(V,{fontSize:"small"}),onClick:()=>q(e)},{label:"Eliminar",icon:t.jsx(k,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>M(e==null?void 0:e.id)}]})})}],[]),I=r.useMemo(()=>[{id:"name",label:"Tipo"},{id:"created_by_user.username",label:"Criado por"},{id:"created_at_datetime",label:"Data de criação",formatter:e=>e?j(e):""},{id:"last_modified_by_user.username",label:"Modificado pela última vez por"},{id:"last_modified_datetime",label:"Última data de modificação",formatter:e=>e?j(e):""}],[]);return t.jsx(U,{elevation:1,children:t.jsxs($,{sx:{marginTop:3},children:[t.jsx(N,{isLoading:C,LoadingComponent:t.jsx(P,{mode:"datatable"}),LoadedComponent:t.jsx(R,{mode:"datatable",data:g??[],columns:O,exportFileName:"tipos_equipamento",exportColumns:I})}),t.jsx(K,{type:c.type,open:c.isOpen,onClose:D}),t.jsx(Q,{mode:"delete",title:"Eliminar Tipo",open:m.isOpen,onClose:l,onSubmit:S,description:"Tem a certeza que deseja eliminar este tipo?",subDescription:"Ao eliminar este tipo, os dados serão removidos de forma permanente."})]})})};export{te as default};
