import{d as L,r as k,j as e,S as l,f as R,H as w,ay as A,aQ as B,a_ as F,F as b,aV as M,T as O,af as P,aL as V,ag as $,b8 as H,b2 as W,B as z,L as K,aT as Q,h as x,a$ as C,b9 as _}from"./index-mWc9gLhA.js";import{u as G,C as h,t as J}from"./index-COzNbWAj.js";import{r as U}from"./repair-D-n4dckQ.js";import{u as X}from"./useEquipment-DvbTvh-h.js";import{u as Y}from"./useRepair-BcwC0uik.js";import{D as Z}from"./DatePicker-CZE5C8dK.js";import"./Tabs-BuC0mIPe.js";const oe=()=>{var v;const S=L(),{control:p,handleSubmit:D,setValue:q,formState:{errors:i}}=G({resolver:J(U)}),[r,c]=k.useState({isOpen:!1,equipment:{id:null,clientName:"",typeName:"",brandName:"",modelName:""}}),g=()=>{c(a=>({...a,isOpen:!0}))},I=()=>{c(a=>({...a,isOpen:!1}))},E=(a,t,s,o,n)=>{c({equipment:{id:a,clientName:t,typeName:s,brandName:o,modelName:n}}),q("equipmentId",a)},{findAllEquipments:m}=X(),{createNewRepair:j,findAllRepairStatuses:f}=Y(),N=async a=>{await j.mutateAsync({...a,entryDescription:a.entryDescription===""?null:a.entryDescription}).then(()=>S("/repair/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:D(N),children:e.jsx(l,{sx:{marginTop:3,gap:3},children:e.jsxs(R,{elevation:1,children:[e.jsx(w,{title:"Detalhes",description:"Estado, equipamento, data da entrada,... da reparação",icon:e.jsx(A,{})}),e.jsxs(l,{sx:{padding:3,gap:2},children:[e.jsx(B,{isLoading:f.isLoading,LoadingComponent:e.jsx(F,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(b,{fullWidth:!0,children:e.jsx(h,{name:"statusId",control:p,defaultValue:"",render:({field:a})=>{var n,y;const t=f.data??[],s=["",...t.map(d=>d.name)],o=((n=t.find(d=>d.id===a.value))==null?void 0:n.name)||"";return e.jsx(M,{ref:a.ref,label:"Estado",data:s,value:o,onChange:d=>{const u=t.find(T=>T.name===d);a.onChange((u==null?void 0:u.id)||"")},error:!!i.statusId,helperText:(y=i.statusId)==null?void 0:y.message})}})})}),e.jsx(b,{fullWidth:!0,children:e.jsx(O,{label:"Equipamento",placeholder:"Selecione um equipamento",value:r.equipment.clientName?`${r.equipment.typeName} ${r.equipment.brandName} ${r.equipment.modelName} (${r.equipment.clientName})`:"",onClick:g,InputProps:{readOnly:!0,startAdornment:e.jsx(P,{position:"start",children:e.jsx(V,{children:e.jsx($,{onClick:g,children:e.jsx(H,{})})})})},error:!!i.equipmentId,helperText:(v=i.equipmentId)==null?void 0:v.message})}),e.jsx(h,{name:"entryDatetime",control:p,defaultValue:new Date,render:({field:a})=>{var t;return e.jsx(Z,{label:"Data de entrada",value:a.value,onChange:a.onChange,error:!!i.entryDatetime,helperText:(t=i.entryDatetime)==null?void 0:t.message})}}),e.jsx(h,{name:"entryDescription",control:p,defaultValue:"",render:({field:a})=>e.jsx(W,{label:"Descrição da entrada",value:a.value,onChange:a.onChange,shouldImmediatelyRender:!0})}),e.jsx(z,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(K,{loading:j.isPending,type:"submit",variant:"contained",children:"Adicionar Reparação"})})]})]})})}),e.jsx(Q,{open:r.isOpen??!1,onClose:I,mode:"data",data:m.data??[],searchKeys:["client.name","type.name","brand.name","model.name"],isLoading:m.isLoading,title:"Equipamentos",placeholder:"Pesquise por um equipamento",buttonStructure:(a,t)=>{var s,o;return e.jsxs(l,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:"8px"},children:[e.jsxs(l,{sx:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:1,marginInline:2,marginTop:2},children:[e.jsx(x,{variant:"h5",component:"h5",sx:{wordBreak:"break-all",textAlign:"start"},children:a.client.name}),a.client.description&&e.jsx(C,{fontSize:"small",title:a.client.description})]}),e.jsxs(l,{sx:{padding:1},children:[(s=m.data)==null?void 0:s.filter(n=>n.client.name===a.client.name).map(n=>e.jsx(_,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:n.id===r.equipment.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,marginTop:1,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{E(n.id,n.client.name,n.type.name,n.brand.name,n.model.name),t()},children:e.jsxs(l,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsxs(x,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:[n.type.name," ",n.brand.name," ",n.model.name]}),n.description&&e.jsx(C,{fontSize:"small",title:n.description})]})},n.id)),((o=m.data)==null?void 0:o.filter(n=>n.client.name===a.client.name).length)===0&&e.jsx(x,{variant:"p",component:"p",sx:{color:"var(--outline)",margin:1,marginTop:0},children:"Não há equipamentos disponíveis para este cliente!"})]})]})}})]})};export{oe as default};
