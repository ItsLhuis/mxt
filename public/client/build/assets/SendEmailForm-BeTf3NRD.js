import{d as k,r as z,j as e,S as r,f as B,H as M,aW as P,F as x,T as g,ai as w,aH as D,aj as H,bi as L,bc as W,bI as R,B as V,L as N,b2 as $,h,aN as T,aD as q}from"./index-C9HasOiM.js";import{z as i,u as K,C as E,t as U}from"./index-BTi6rd4V.js";import{u as G}from"./useClient-C9FOb7yq.js";import{u as J}from"./useEmail-DBVYW-rH.js";import"./client-CVPJ2IqU.js";import"./email-C8Z12rKf.js";const Q=i.object({clientId:i.number({message:"O para é obrigatório"}).int().positive(),contactId:i.number({message:"O para é obrigatório"}).int().positive(),subject:i.string().trim().min(1,{message:"O assunto é obrigatório"}).max(255),title:i.string().trim().min(1,{message:"O título é obrigatório"}).max(255),message:i.string().trim().min(1,{message:"A mensagen é obrigatória"}),text:i.string().trim().min(1).optional(),attachments:i.array(i.instanceof(File)).optional()}).refine(l=>l.attachments?l.attachments.reduce((c,d)=>c+d.size,0)<=40*1024*1024:!0,{message:"O tamanho total de todos os anexos deve ser de 40 MB ou menos",path:["attachments"]}),ae=()=>{var v,C,S,y;const l=k(),{control:m,register:c,handleSubmit:d,setValue:j,formState:{errors:s}}=K({resolver:U(Q),defaultValues:{attachments:[]}}),[o,p]=z.useState({isOpen:!1,client:{id:null,name:""},contact:{id:null,name:""}}),f=()=>{p(t=>({...t,isOpen:!0}))},I=()=>{p(t=>({...t,isOpen:!1}))},F=(t,n,a,A)=>{p({client:{id:t,name:n},contact:{id:a,name:A}}),j("clientId",t),j("contactId",a)},{findAllClients:b}=G(),{sendEmail:u}=J(),O=async t=>{await u.mutateAsync({...t,text:t.subject}).then(()=>l("/email/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:d(O),children:e.jsx(r,{sx:{marginTop:3,gap:3},children:e.jsxs(B,{elevation:1,children:[e.jsx(M,{title:"Detalhes",description:"Para, assunto, título,... do e-mail",icon:e.jsx(P,{})}),e.jsxs(r,{sx:{padding:3,gap:2},children:[e.jsx(x,{fullWidth:!0,children:e.jsx(g,{label:"Para",placeholder:"Selecione o e-mail de um cliente",value:o.client.name?`${o.contact.name} (${o.client.name})`:"",onClick:f,InputProps:{readOnly:!0,startAdornment:e.jsx(w,{position:"start",children:e.jsx(D,{children:e.jsx(H,{onClick:f,children:e.jsx(L,{})})})})},error:!!s.clientId,helperText:(v=s.clientId)==null?void 0:v.message})}),e.jsx(x,{fullWidth:!0,children:e.jsx(g,{...c("subject"),label:"Assunto",error:!!s.subject,helperText:(C=s.subject)==null?void 0:C.message,autoComplete:"off"})}),e.jsx(x,{fullWidth:!0,children:e.jsx(g,{...c("title"),label:"Título",error:!!s.title,helperText:(S=s.title)==null?void 0:S.message,autoComplete:"off"})}),e.jsx(E,{name:"message",control:m,defaultValue:"",render:({field:t})=>{var n;return e.jsx(W,{label:"Mensagem",value:t.value,onChange:t.onChange,error:!!s.message,helperText:(n=s.message)==null?void 0:n.message})}}),e.jsx(E,{name:"attachments",control:m,defaultValue:"",render:({field:t})=>{var n;return e.jsx(R,{label:"Anexos",acceptedFiles:"",maxSize:10*1024*1024,maxTotalFileSize:40*1024*1024,disabled:u.isPending,value:t.value,onChange:t.onChange,error:!!s.attachments,helperText:(n=s.attachments)==null?void 0:n.message})}}),e.jsx(V,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(N,{loading:u.isPending,type:"submit",variant:"contained",children:"Enviar E-mail"})})]})]})})}),e.jsx($,{open:o.isOpen??!1,onClose:I,mode:"data",data:((y=b.data)==null?void 0:y.map(t=>({...t,filteredContacts:t.contacts.filter(n=>n.type==="E-mail")})))??[],searchKeys:["name","contacts.contact"],isLoading:b.isLoading,title:"E-mails dos Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(t,n)=>e.jsxs(r,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:"8px"},children:[e.jsxs(r,{sx:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:1,marginInline:2,marginTop:2},children:[e.jsx(h,{variant:"h5",component:"h5",sx:{wordBreak:"break-all",textAlign:"start"},children:t.name}),t.description&&e.jsx(T,{fontSize:"small",title:t.description})]}),e.jsxs(r,{sx:{padding:1},children:[t.contacts.filter(a=>a.type==="E-mail").map(a=>e.jsx(q,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:a.id===o.contact.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,marginTop:1,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{F(t.id,t.name,a.id,a.contact),n()},children:e.jsxs(r,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(h,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:a.contact}),a.description&&e.jsx(T,{fontSize:"small",title:a.description})]})},a.id)),t.contacts.filter(a=>a.type==="E-mail").length===0&&e.jsx(h,{variant:"p",component:"p",sx:{color:"var(--outline)",margin:1,marginTop:0},children:"Não há contactos de e-mail disponíveis!"})]})]})})]})};export{ae as default};
