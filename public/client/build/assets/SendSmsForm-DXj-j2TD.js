import{d as P,r as w,j as e,S as s,f as A,H as B,aD as O,F as f,T as j,af as F,aP as L,ag as D,bg as H,B as z,L as E,a$ as N,h as d,b7 as v,aL as R}from"./index-DJpfvod0.js";import{z as o,u as W,t as $}from"./index-o_NukjCy.js";import{u as V}from"./useClient-Dwbwu-EZ.js";import{u as q}from"./useSms-CF-rkG3j.js";import{f as S}from"./phone-B8ybmA3k.js";import"./client-BDPFytRs.js";import"./sms-oERaAemq.js";import"./isPossiblePhoneNumber-DES16dOz.js";const K=o.object({clientId:o.number({message:"O para é obrigatório"}).int().positive(),contactId:o.number({message:"O para é obrigatório"}).int().positive(),message:o.string().trim().min(1,{message:"A mensagem é obrigatória"})}),te=()=>{var u,g,h;const b=P(),{control:G,register:C,handleSubmit:y,setValue:c,formState:{errors:r}}=W({resolver:$(K),defaultValues:{attachments:[]}}),[i,l]=w.useState({isOpen:!1,client:{id:null,name:""},contact:{id:null,name:""}}),m=()=>{l(t=>({...t,isOpen:!0}))},T=()=>{l(t=>({...t,isOpen:!1}))},I=(t,a,n,k)=>{l({client:{id:t,name:a},contact:{id:n,name:k}}),c("clientId",t),c("contactId",n)},{findAllClients:p}=V(),{sendSms:x}=q(),M=async t=>{await x.mutateAsync(t).then(()=>b("/sms/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:y(M),children:e.jsx(s,{sx:{marginTop:3,gap:3},children:e.jsxs(A,{elevation:1,children:[e.jsx(B,{title:"Detalhes",description:"Para e mensagem do SMS",icon:e.jsx(O,{})}),e.jsxs(s,{sx:{padding:3,gap:2},children:[e.jsx(f,{fullWidth:!0,children:e.jsx(j,{label:"Para",placeholder:"Selecione o contacto de um cliente",value:i.client.name?`${S(i.contact.name)} (${i.client.name})`:"",onClick:m,InputProps:{readOnly:!0,startAdornment:e.jsx(F,{position:"start",children:e.jsx(L,{children:e.jsx(D,{onClick:m,children:e.jsx(H,{})})})})},error:!!r.clientId,helperText:(u=r.clientId)==null?void 0:u.message})}),e.jsx(f,{fullWidth:!0,children:e.jsx(j,{...C("message"),label:"Mensagem",error:!!r.message,helperText:(g=r.message)==null?void 0:g.message,autoComplete:"off",multiline:!0,rows:14})}),e.jsx(z,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(E,{loading:x.isPending,type:"submit",variant:"contained",children:"Enviar SMS"})})]})]})})}),e.jsx(N,{open:i.isOpen??!1,onClose:T,mode:"data",data:((h=p.data)==null?void 0:h.map(t=>({...t,filteredContacts:t.contacts.filter(a=>a.type==="Telemóvel"||a.type==="Telefone")})))??[],searchKeys:["name","contacts.contact"],isLoading:p.isLoading,title:"Contactos dos Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(t,a)=>e.jsxs(s,{sx:{border:"2px solid var(--elevation-level5)",borderRadius:"8px"},children:[e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",justifyContent:"flex-start",gap:1,marginInline:2,marginTop:2},children:[e.jsx(d,{variant:"h5",component:"h5",sx:{wordBreak:"break-all",textAlign:"start"},children:t.name}),t.description&&e.jsx(v,{fontSize:"small",title:t.description})]}),e.jsxs(s,{sx:{padding:1},children:[t.contacts.filter(n=>n.type==="Telemóvel"||n.type==="Telefone").map(n=>e.jsx(R,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:n.id===i.contact.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,marginTop:1,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{I(t.id,t.name,n.id,n.contact),a()},children:e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(d,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:S(n.contact)}),n.description&&e.jsx(v,{fontSize:"small",title:n.description})]})},n.id)),t.contacts.filter(n=>n.type==="Telemóvel"||n.type==="Telefone").length===0&&e.jsx(d,{variant:"p",component:"p",sx:{color:"var(--outline)",margin:1,marginTop:0},children:"Não há contactos de SMS disponíveis!"})]})]})})]})};export{te as default};
