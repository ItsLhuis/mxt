import{c as de,j as e,b as A,r as x,M as N,B as F,S as v,T as ce,I as ue,d as be,F as f,e as w,f as me,g as X,h as B,i as m,C as je,p as M,k as fe,a as ye,l as Ce,n as De,P as Ie,m as Se,H as Pe,o as Te,q as qe,D as ke,s as Ae,t as we,L as ne,v as Me,w as Re,x as Oe}from"./index-Njxcp4Ni.js";import{z as a,u as Ee,t as Fe,C as He}from"./index-D0OoFv_l.js";import{D as ie,a as We}from"./DatePicker-BZbZrYu1.js";import{s as U}from"./toast-CZYg6mVG.js";import{f as Y}from"./currency-DMbMY7YD.js";import{G as b}from"./Grid-Bp0T3iGh.js";import{f as pe,M as Le}from"./phone-yiAPl3ry.js";import{C as Ve}from"./Container-CBif9Wlv.js";import{A as ae}from"./Add-iYOmSR_p.js";const se=de(e.jsx("path",{d:"M15 18.5c-2.51 0-4.68-1.42-5.76-3.5H15l1-2H8.58c-.05-.33-.08-.66-.08-1s.03-.67.08-1H15l1-2H9.24C10.32 6.92 12.5 5.5 15 5.5c1.61 0 3.09.59 4.23 1.57L21 5.3C19.41 3.87 17.3 3 15 3c-3.92 0-7.24 2.51-8.48 6H3l-1 2h4.06c-.04.33-.06.66-.06 1s.02.67.06 1H3l-1 2h4.52c1.24 3.49 4.56 6 8.48 6 2.31 0 4.41-.87 6-2.3l-1.78-1.77c-1.13.98-2.6 1.57-4.22 1.57"}),"Euro"),_e=de(e.jsx("path",{d:"M7.5 11C9.43 11 11 9.43 11 7.5S9.43 4 7.5 4 4 5.57 4 7.5 5.57 11 7.5 11m0-5C8.33 6 9 6.67 9 7.5S8.33 9 7.5 9 6 8.33 6 7.5 6.67 6 7.5 6M4.0025 18.5832 18.59 3.9955l1.4142 1.4143L5.4167 19.9974zM16.5 13c-1.93 0-3.5 1.57-3.5 3.5s1.57 3.5 3.5 3.5 3.5-1.57 3.5-3.5-1.57-3.5-3.5-3.5m0 5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"Percent");let _;const Be=new Uint8Array(16);function Ne(){if(!_&&(_=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(Be)}const u=[];for(let t=0;t<256;++t)u.push((t+256).toString(16).slice(1));function Ue(t,r=0){return u[t[r+0]]+u[t[r+1]]+u[t[r+2]]+u[t[r+3]]+"-"+u[t[r+4]]+u[t[r+5]]+"-"+u[t[r+6]]+u[t[r+7]]+"-"+u[t[r+8]]+u[t[r+9]]+"-"+u[t[r+10]]+u[t[r+11]]+u[t[r+12]]+u[t[r+13]]+u[t[r+14]]+u[t[r+15]]}const ze=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),le={randomUUID:ze};function xe(t,r,y){if(le.randomUUID&&!r&&!t)return le.randomUUID();t=t||{};const j=t.random||(t.rng||Ne)();return j[6]=j[6]&15|64,j[8]=j[8]&63|128,Ue(j)}const $e=a.object({title:a.string({required_error:"O título é obrigatório"}).trim().min(1,{message:"O título é obrigatório"}),description:a.string(),service:a.string({required_error:"O serviço é obrigatório"}).trim().min(1,{message:"O serviço é obrigatório"}),quantity:a.number({invalid_type_error:"A quantidade é obrigatória"}).int({message:"A quantidade deve ser número inteiro"}).min(1,{message:"A quantidade deve ser maior que 0"}),price:a.number({invalid_type_error:"O preço é obrigatório",required_error:"O preço é obrigatório"}).min(1,{message:"O preço deve ser maior que 0,00"}),discount:a.union([a.number({invalid_type_error:"O desconto deve ser um número"}).min(0,{message:"O desconto deve ser maior ou igual a 0"}).max(100,{message:"O desconto deve ser menor ou igual a 100"}),a.nan()]).optional()}),Z=({mode:t,open:r,handleClose:y,onClick:j,services:z,products:s,initialValues:h})=>{const{control:p,register:T,handleSubmit:$,reset:Q,setValue:l,formState:{errors:d},getValues:C}=Ee({resolver:Fe($e)}),[G,R]=x.useState(!1),[D,O]=x.useState(null);x.useEffect(()=>{O(null),Q(),h&&(l("title",h.title),l("description",h.description),l("service",h.service),l("quantity",h.quantity),l("price",h.price),O(h.id),I())},[r]);const H=o=>{l("title",o.title),l("description",o.description),l("service",o.service),l("quantity",o.quantity),l("price",o.price),t==="add"&&!D&&O(o.id),I()},q=o=>{if(D){if((o.discount===null||o.discount===void 0||isNaN(o.discount))&&(o.discount=0),t==="add"){const S=xe(),g=M(o,k=>{k.id=S,k.total=C("total"),k.moreOptions={item:{id:S,...o,total:C("total")}}});j(g),U("Item adicionado com sucesso!")}else if(t==="edit"){const S=M(o,g=>{g.id=D,g.total=C("total"),g.moreOptions={item:{id:D,...o,total:C("total")}}});j(S),U("Item editado com sucesso!")}y()}},I=()=>{const{quantity:o,price:S,discount:g}=C(),k=parseFloat(o)||0,W=parseFloat(S)||0,L=parseFloat(g)||0,E=k*W,J=E*L/100,K=E-J;l("total",K.toFixed(2),{shouldValidate:!1})};return e.jsxs(N,{open:r,onClose:y,mode:"form",title:t==="edit"?"Editar Item":"Adicionar Item",submitButtonText:t==="edit"?"Editar Item":"Adicionar Item",onSubmit:$(q),children:[e.jsx(F,{sx:{padding:3,paddingTop:1},children:e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:12,children:e.jsxs(v,{sx:{flexDirection:"row",alignItems:"flex-start",gap:1},children:[e.jsx(ce,{title:"Pesquisar",placement:"bottom",children:e.jsx(ue,{sx:{marginTop:1},onClick:()=>R(!0),children:e.jsx(be,{})})}),e.jsx(f,{fullWidth:!0,children:e.jsx(w,{...T("title"),name:"title",label:"Título",placeholder:"Título",disabled:!0,InputLabelProps:{shrink:!0},error:!!d.title,helperText:d.title?d.title.message:"",onChange:o=>{o.target.value=C("title")||""}})})]})}),e.jsx(b,{item:!0,xs:12,children:e.jsx(f,{fullWidth:!0,children:e.jsx(w,{...T("description"),name:"description",label:"Descrição",placeholder:"Descrição",InputLabelProps:{shrink:!0},multiline:!0})})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(f,{fullWidth:!0,children:e.jsx(He,{name:"service",control:p,defaultValue:"",render:({field:o})=>e.jsx(me,{ref:o.ref,label:"Serviço",data:["",...z],value:o.value,onChange:o.onChange,error:!!d.service,helperText:d.service?d.service.message:""})})})}),e.jsx(b,{item:!0,xs:12,sm:3,children:e.jsx(f,{fullWidth:!0,children:e.jsx(w,{...T("quantity",{valueAsNumber:!0}),name:"quantity",label:"Quantidade",placeholder:"0",type:"number",InputLabelProps:{shrink:!0},error:!!d.quantity,helperText:d.quantity?d.quantity.message:"",onChange:o=>{l("quantity",o.target.value),I()}})})}),e.jsx(b,{item:!0,xs:12,sm:3,children:e.jsx(f,{fullWidth:!0,children:e.jsx(w,{...T("price",{valueAsNumber:!0}),name:"price",label:"Preço",placeholder:"0,00",type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(se,{fontSize:"small"})})},InputLabelProps:{shrink:!0},error:!!d.price,helperText:d.price?d.price.message:"",onChange:o=>{l("price",o.target.value),I()}})})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(f,{fullWidth:!0,children:e.jsx(w,{...T("discount",{valueAsNumber:!0}),name:"discount",label:"Desconto",placeholder:"0,00",type:"number",InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(_e,{fontSize:"small"})})},InputLabelProps:{shrink:!0},error:!!d.discount,helperText:d.discount?d.discount.message:"",onChange:o=>{l("discount",o.target.value),I()}})})}),e.jsx(b,{item:!0,xs:12,sm:6,children:e.jsx(f,{fullWidth:!0,children:e.jsx(w,{...T("total"),name:"total",label:"Total",placeholder:"0,00",disabled:!0,InputProps:{startAdornment:e.jsx(X,{position:"start",children:e.jsx(se,{fontSize:"small"})})},InputLabelProps:{shrink:!0},onChange:o=>{o.target.value=C("total")||""}})})})]})}),e.jsx(N,{open:G,onClose:()=>R(!1),title:"Produtos",placeholder:"Pesquise por um produto",mode:"data",data:s,buttonStructure:(o,S)=>{const g=D===o.id;return e.jsx(B,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",backgroundColor:g?"rgba(88, 101, 242, 0.15)":"var(--elevation-level2)",border:2,borderColor:g?"var(--primary)":"var(--elevation-level2)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,minHeight:"unset !important","&:hover":{backgroundColor:g?"rgba(88, 101, 242, 0.23)":"var(--elevation-level4)",borderColor:"var(--primary)"}},className:"Mui-selected",onClick:()=>{H(o),S()},children:e.jsxs(v,{sx:{gap:1,lineHeight:1.5,alignItems:"flex-start",width:"100%"},children:[e.jsx(m,{variant:"body2",component:"p",fontWeight:600,children:o.title}),e.jsx(m,{variant:"body3",component:"p",color:"var(--outline)",children:o.description}),e.jsx(m,{variant:"body3",component:"p",children:Y(o.price)}),e.jsx(F,{sx:{marginLeft:"auto"},children:e.jsx(je,{label:o.service})})]})})}})]})};Z.propTypes={mode:A.oneOf(["add","edit"]).isRequired,open:A.bool.isRequired,handleClose:A.func.isRequired,onClick:A.func.isRequired,services:A.array.isRequired,products:A.array.isRequired,initialValues:A.object};const Qe=t=>{const r=parseFloat(t);return(r%1!==0?r.toFixed(2).replace(".",","):r.toFixed(0))+" %"},Ge=a.object({client:a.object({id:a.number(),name:a.string(),country:a.string(),address:a.string(),phone:a.string()},{invalid_type_error:"O cliente é obrigatório"}),invoiceID:a.string(),state:a.string(),creationDate:a.date({invalid_type_error:"A data de criação é obrigatória"}),dueDate:a.date({invalid_type_error:"A data de vencimento é obrigatória"}),items:a.array(a.object({})).nonempty({message:"Pelo menos um item é obrigatório"})}).refine(t=>!t.dueDate||!t.creationDate||fe(t.dueDate,t.creationDate),{message:"A data de vencimento deve ser posterior à data de criação",path:["dueDate"]}),Je=()=>{const t=[];for(let r=1;r<=231;r++)t.push({id:r,name:`Cliente ${r}`,country:r%2===0?"Portugal":"Brasil",address:`Endereço ${r}`,phone:pe("987654321")});return t},Ke=()=>{const t=[];for(let r=1;r<=385;r++)t.push({id:r,title:`Produto ${r}`,description:`Produto ${r}`,service:"Venda de Produtos",quantity:1,price:29.99});return t},Xe=()=>{const t=[];for(let r=1;r<=26;r++){const y=xe();t.push({id:y,title:`Produto ${r}`,description:`Descrição do Produto ${r}`,service:"Venda de Produtos",quantity:1,price:29.99,discount:0,total:29.99,moreOptions:{item:{id:y,title:`Produto ${r}`,description:`Descrição do Produto ${r}`,service:"Venda de Produtos",quantity:1,price:29.99,discount:0,total:29.99}}})}return t},st=()=>{var ee,te,re,oe;const t=ye(),r=Ce(),y=De(r.breakpoints.down("md")),[j,z]=x.useState(!1),[s,h]=x.useState({client:null,invoiceID:"INV-9832-9123",state:"Rascunho",creationDate:new Date,dueDate:null,items:Xe()}),[p,T]=x.useState({}),[$,Q]=x.useState([]),[l,d]=x.useState([]),[C,G]=x.useState(null),[R,D]=x.useState({open:!1,items:[]}),[O,H]=x.useState(!1),[q,I]=x.useState({open:!1,item:null,mode:null}),o=()=>{I({open:!0,item:null,mode:"add"})},S=n=>{I({open:!0,item:n,mode:"edit"})};x.useEffect(()=>{const n=Je(),i=Ke();Q(n),d(i)},[]);const g=[{id:"title",label:"Título",align:"left",sortable:!1},{id:"description",label:"Descrição",align:"left",sortable:!1},{id:"service",label:"Serviço",align:"left",sortable:!1},{id:"quantity",label:"Quantidade",align:"left",sortable:!1},{id:"price",label:"Preço",align:"left",sortable:!1,formatter:Y},{id:"discount",label:"Desconto",align:"left",sortable:!1,formatter:Qe},{id:"total",label:"Total",align:"left",sortable:!1,formatter:Y},{id:"moreOptions",align:"center",sortable:!1,renderComponent:({data:n})=>e.jsx(Me,{mode:"custom",customButton:e.jsx(ce,{title:"Mais Opções",placement:"bottom",sx:{margin:-1},children:e.jsx(ue,{children:e.jsx(Le,{fontSize:"inherit"})})}),children:e.jsx(Re,{buttons:[{label:"Editar",onClick:()=>S(n.item)},{label:"Eliminar",color:"error",divider:!0,onClick:()=>{D({open:!0,items:[n.item.id]})}}]})})}],k=["Pago","Pendente","Atrasado","Rascunho"],W=["Reparação","Configuração de Redes","Backup e Recuperação de Dados","Consultoria","Manutenção Preventiva","Venda de Produtos","Formação","Suporte Técnico Remoto","Acessórios e Complementos"],L=(n,i)=>{h(M(c=>{c[n]=i}))},E=(n,i)=>{let c=i;n==="dueDate"&&(c=Oe(i)),L(n,c)},J=n=>{h(M(i=>{i.items.push(n)}))},K=n=>{h(M(i=>{const c=i.items.findIndex(P=>P.id===n.id);c!==-1&&(i.items[c]=n)}))},he=n=>{const i=new Set(n);h(M(c=>{c.items=c.items.filter(P=>!i.has(P.id))}))},ge=()=>new Promise((n,i)=>{setTimeout(()=>{he(R.items),U("Item(s) eliminado(s) com sucesso!"),C&&C(),D({open:!1,items:[]}),n(!0)},500)}),ve=()=>{const n=Ge.safeParse(s);if(n.success)z(!0),setTimeout(()=>{U("Fatura criada com sucesso!"),t("/invoice/list")},1e3);else{const i={};n.error.errors.forEach(c=>{const P=c.path[0],V=c.message;i[P]?i[P].message=V:i[P]={message:V}}),T(i)}};return e.jsx(x.Suspense,{fallback:e.jsx(Ie,{}),children:e.jsx(Se.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.2},children:e.jsx(F,{component:"main",className:"page-main",children:e.jsxs(Ve,{maxWidth:!1,children:[e.jsx(Pe,{title:"Criar Fatura",breadcrumbs:[{name:"Faturação"},{name:"Criar"}]}),e.jsx(Te,{elevation:1,children:e.jsxs(F,{sx:{marginTop:3},children:[e.jsxs(v,{sx:{flexDirection:y?"column":"row",gap:y?3:5,padding:3},children:[e.jsxs(v,{sx:{width:"100%",gap:2},children:[e.jsxs(v,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(m,{variant:"h6",component:"h6",sx:{color:"var(--outline)"},children:"De:"}),e.jsx(qe,{title:"Endereço padrão. Só o Chefe pode alterar."})]}),e.jsxs(v,{sx:{gap:1,padding:2,border:2,borderColor:"var(--elevation-level5)",borderRadius:2,lineHeight:1.5},children:[e.jsx(m,{variant:"body3",component:"p",children:"Mixtura"}),e.jsx(m,{variant:"body3",component:"p",children:"R. 15 751, 4500-159 Espinho, Portugal"}),e.jsx(m,{variant:"body3",component:"p",children:pe("220180486")})]})]}),e.jsx(ke,{sx:{height:"auto",borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(v,{sx:{width:"100%",gap:2},children:[e.jsx(m,{variant:"h6",component:"h6",sx:{color:"var(--outline)"},children:"Para:"}),e.jsxs(f,{children:[e.jsx(B,{startIcon:!s.client&&e.jsx(ae,{fontSize:"large",sx:{color:p.client&&"rgb(211, 47, 47) !important"}}),sx:{display:"flex",flexDirection:s.client?"column":"row",justifyContent:"center",alignItems:s.client?"flex-start":"center",padding:"16px !important",width:"100%",backgroundColor:"var(--elevation-level3)",border:2,borderColor:p.client?"rgb(211, 47, 47) !important":"var(--elevation-level3)",borderRadius:2,color:p.client?"rgb(211, 47, 47) !important":"var(--onSurface)",lineHeight:1.5,fontWeight:400,minHeight:"106px !important","&:hover":{backgroundColor:"var(--elevation-level5)",borderColor:"var(--primary)"}},onClick:()=>H(!0),children:s.client?e.jsxs(v,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",gap:1},children:[e.jsx(m,{variant:"body3",component:"p",textAlign:"left",children:s.client.name}),e.jsxs(m,{variant:"body3",component:"p",textAlign:"left",children:[s.client.address,", ",s.client.country]}),e.jsx(m,{variant:"body3",component:"p",textAlign:"left",children:s.client.phone})]}):"Adicionar Cliente"}),p.client&&e.jsx(Ae,{sx:{color:p.client&&"rgb(211, 47, 47)"},children:(ee=p.client)==null?void 0:ee.message})]})]})]}),e.jsx(F,{sx:{backgroundColor:"var(--elevation-level2)",padding:3,paddingTop:1},children:e.jsxs(b,{container:!0,spacing:2,children:[e.jsx(b,{item:!0,xs:12,md:12,lg:3,children:e.jsx(f,{fullWidth:!0,children:e.jsx(w,{name:"invoiceID",label:"Número da fatura",value:s.invoiceID,disabled:!0})})}),e.jsx(b,{item:!0,xs:12,md:12,lg:3,children:e.jsx(me,{label:"Estado",data:k,value:s.state,onChange:n=>L("state",n)})}),e.jsx(b,{item:!0,xs:12,md:12,lg:3,children:e.jsx(f,{fullWidth:!0,children:e.jsx(ie,{label:"Data de criação",value:s.creationDate,onChange:n=>E("creationDate",n),error:!!p.creationDate,helperText:(te=p.creationDate)==null?void 0:te.message})})}),e.jsx(b,{item:!0,xs:12,md:12,lg:3,children:e.jsx(f,{fullWidth:!0,children:e.jsx(ie,{label:"Data de vencimento",value:s.dueDate,onChange:n=>E("dueDate",n),minDate:s.creationDate,error:!!p.dueDate,helperText:(re=p.dueDate)==null?void 0:re.message})})})]})}),e.jsxs(v,{children:[e.jsxs(v,{sx:{flexDirection:"row",alignItems:"center",padding:3},children:[e.jsx(m,{variant:"h6",component:"h6",sx:{color:"var(--outline)"},children:"Detalhes:"}),e.jsx(B,{sx:{marginLeft:"auto"},startIcon:e.jsx(ae,{fontSize:"large",sx:{color:"var(--primary)"}}),onClick:o,children:"Adicionar Item"})]}),e.jsx(we,{data:s.items,columns:g,mode:"datatable",actions:[{icon:e.jsx(We,{}),title:"Eliminar",onClick:(n,i)=>{D({open:!0,items:n}),G(()=>i)}}],error:!!p.items,helperText:(oe=p.items)==null?void 0:oe.message}),e.jsx(v,{sx:{marginLeft:"auto",padding:1,paddingTop:3,paddingInline:3},children:e.jsx(m,{variant:"h5",component:"h5",children:"Total: 43 €"})})]}),e.jsxs(v,{sx:{flexDirection:"row",justifyContent:"flex-end",padding:3,gap:1},children:[e.jsx(ne,{loading:j,variant:"contained",color:"secondary",children:"Guardar Rascunho"}),e.jsx(ne,{loading:j,variant:"contained",onClick:ve,children:"Criar Fatura"})]})]})}),e.jsx(N,{open:O,onClose:()=>H(!1),title:"Clientes",placeholder:"Pesquise por um cliente",mode:"data",data:$,buttonStructure:(n,i)=>{var P;const c=((P=s.client)==null?void 0:P.id)===n.id;return e.jsx(B,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",backgroundColor:c?"rgba(88, 101, 242, 0.15)":"var(--elevation-level2)",border:2,borderColor:c?"var(--primary)":"var(--elevation-level2)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,minHeight:"unset !important","&:hover":{backgroundColor:c?"rgba(88, 101, 242, 0.23)":"var(--elevation-level4)",borderColor:"var(--primary)"}},className:"Mui-selected",onClick:()=>{h(M(V=>{V.client=n})),i()},children:e.jsxs(v,{sx:{gap:1,lineHeight:1.5,alignItems:"flex-start"},children:[e.jsx(m,{variant:"body2",component:"p",fontWeight:600,children:n.name}),e.jsxs(m,{variant:"body3",component:"p",color:"var(--outline)",children:[n.address,", ",n.country]}),e.jsx(m,{variant:"body3",component:"p",color:"var(--outline)",children:n.phone})]})})}}),e.jsx(Z,{mode:"add",open:q.mode==="add"&&q.open,handleClose:()=>I({open:!1,item:null,mode:null}),onClick:J,services:W,products:l}),e.jsx(Z,{mode:"edit",open:q.mode==="edit"&&q.open,handleClose:()=>I({open:!1,item:null,mode:null}),onClick:K,services:W,products:l,initialValues:q.item}),e.jsx(N,{open:R.open,onClose:()=>D({open:!1,items:[]}),onSubmit:ge,mode:"delete",description:"Deseja eliminar o(s) seguinte(s) item(s)?"})]})})})})};export{st as default};
