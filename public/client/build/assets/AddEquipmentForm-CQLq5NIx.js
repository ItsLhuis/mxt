import{d as V,r as P,j as e,S as g,f as R,H as Q,aU as U,F as u,T as q,ai as z,aH as G,aj as J,bi as K,aM as j,aQ as f,b4 as C,bc as X,B as Y,L as Z,b2 as _,aD as $,h as ee,aN as ne,ab as ae,s as te}from"./index-C9HasOiM.js";import{u as oe,a as re,C as p,t as se}from"./index-BTi6rd4V.js";import{e as ie}from"./equipment-D4V42Xnu.js";import{u as de}from"./useClient-C9FOb7yq.js";import{u as le}from"./useEquipment-ClzBGdbo.js";import"./client-CVPJ2IqU.js";import"./equipment-DQ8Bx2dX.js";const je=()=>{var S,E;const T=V(),{control:d,register:M,handleSubmit:w,setValue:b,formState:{errors:r},setError:A}=oe({resolver:se(ie)}),{findAllClients:v}=de(),{findAllEquipmentTypes:I,findAllEquipmentBrands:y,findAllEquipmentModelsByBrandId:N,createNewEquipment:B}=le(),{data:k,isLoading:W,isError:F}=N(re({control:d,name:"brandId"})),[h,x]=P.useState({isOpen:!1,client:{id:null,name:""}}),L=()=>{x(n=>({...n,isOpen:!0}))},D=()=>{x(n=>({...n,isOpen:!1}))},H=(n,a)=>{x({client:{id:n,name:a}}),b("clientId",n)},O=async n=>{await B.mutateAsync({...n,description:n.description===""?null:n.description}).then(()=>{T("/equipment/list"),ae("Equipamento adicionado com sucesso!")}).catch(a=>{if(a.error.code==="EQU-008"){A("sn",{type:"manual",message:"Número de série já existente"});return}te("Erro ao adicionar equipamento!")})};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:w(O),children:e.jsx(g,{sx:{marginTop:3,gap:3},children:e.jsxs(R,{elevation:1,children:[e.jsx(Q,{title:"Detalhes",description:"Cliente, tipo, marca, modelo,... do equipamento",icon:e.jsx(U,{})}),e.jsxs(g,{sx:{padding:3,gap:2},children:[e.jsx(u,{fullWidth:!0,children:e.jsx(q,{label:"Cliente",placeholder:"Selecione um cliente",value:h.client.name,onClick:L,InputProps:{readOnly:!0,startAdornment:e.jsx(z,{position:"start",children:e.jsx(G,{children:e.jsx(J,{onClick:L,children:e.jsx(K,{})})})})},error:!!r.clientId,helperText:(S=r.clientId)==null?void 0:S.message})}),e.jsx(j,{isLoading:I.isLoading,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"typeId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=I.data??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Tipo",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||"")},error:!!r.typeId,helperText:(i=r.typeId)==null?void 0:i.message})}})})}),e.jsx(j,{isLoading:y.isLoading,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"brandId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=y.data??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Marca",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||""),b("modelId","")},error:!!r.brandId,helperText:(i=r.brandId)==null?void 0:i.message})}})})}),e.jsx(j,{isLoading:W||F,LoadingComponent:e.jsx(f,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(u,{fullWidth:!0,children:e.jsx(p,{name:"modelId",control:d,defaultValue:"",render:({field:n})=>{var s,i;const a=k??[],l=["",...a.map(t=>t.name)],c=((s=a.find(t=>t.id===n.value))==null?void 0:s.name)||"";return e.jsx(C,{ref:n.ref,label:"Modelo",data:l,value:c,onChange:t=>{const o=a.find(m=>m.name===t);n.onChange((o==null?void 0:o.id)||"")},error:!!r.modelId,helperText:(i=r.modelId)==null?void 0:i.message})}})})}),e.jsx(u,{fullWidth:!0,children:e.jsx(q,{...M("sn"),label:"Número de série",error:!!r.sn,helperText:(E=r.sn)==null?void 0:E.message,autoComplete:"off"})}),e.jsx(p,{name:"description",control:d,defaultValue:"",render:({field:n})=>e.jsx(X,{label:"Descrição",value:n.value,onChange:n.onChange})}),e.jsx(Y,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(Z,{loading:B.isPending,type:"submit",variant:"contained",children:"Adicionar Equipamento"})})]})]})})}),e.jsx(_,{open:h.isOpen??!1,onClose:D,mode:"data",data:v.data??[],isLoading:v.isLoading,title:"Clientes",placeholder:"Pesquise por um cliente",buttonStructure:(n,a)=>e.jsx($,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:n.id===h.client.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{H(n.id,n.name),a()},children:e.jsxs(g,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(ee,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:n.name}),n.description&&e.jsx(ne,{fontSize:"small",title:n.description})]})})})]})};export{je as default};
