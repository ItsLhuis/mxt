import{e as T,r as p,j as s,S as i,aN as I,h as a,aZ as y,a_ as f,a$ as h,aE as _,aF as j,ax as z,aH as L,aj as B,ay as F,b0 as W,f as $,B as k,aM as P,b1 as U,aC as N,b2 as q,ab as H,s as v}from"./index-C9HasOiM.js";import{u as V}from"./useRepair-Cho1bqHB.js";import{R as Z}from"./List-DwAmCSFW.js";import{M as G}from"./MoreVert-CDz2P5kD.js";import{E as J}from"./Edit-CYRFZ1bJ.js";import"./repair-DgMqRd6F.js";import"./Container-B2tOqq2a.js";import"./Add-Hwv7pAxz.js";const te=()=>{const{role:b}=T(),{findAllEntryAccessories:A,deleteEntryAccessory:E}=V(),{data:g,isLoading:C}=A,[m,u]=p.useState({isOpen:!1,entryAccessory:null}),M=e=>{u({isOpen:!0,entryAccessory:e})},R=()=>{u({isOpen:!1,entryAccessory:null})},[c,x]=p.useState({isOpen:!1,entryAccessoryId:null}),S=e=>{x({isOpen:!0,entryAccessoryId:e})},r=()=>{x({isOpen:!1,entryAccessoryId:null})},D=()=>new Promise((e,t)=>{c.entryAccessoryId?E.mutateAsync({entryAccessoryId:c.entryAccessoryId}).then(()=>{H("Acessório da entrada eliminado com sucesso!"),r(),e()}).catch(n=>{if(n.error.code==="REP-011"){r(),v("Este acessório da entrada está associado a uma ou mais reparações e não pode ser eliminado!",{duration:6e3}),t();return}r(),v("Erro ao eliminar acessório da entrada"),t()}):(r(),t())}),O=p.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>s.jsxs(i,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&s.jsx(I,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,n,o,l,d;return s.jsx(s.Fragment,{children:s.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[s.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?s.jsxs(s.Fragment,{children:[s.jsx(y,{alt:(t=e==null?void 0:e.created_by_user)==null?void 0:t.username,src:`${f}/users/${(n=e==null?void 0:e.created_by_user)==null?void 0:n.id}/avatar?size=80`,name:(o=e==null?void 0:e.created_by_user)==null?void 0:o.username}),s.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(l=e==null?void 0:e.created_by_user)==null?void 0:l.username}),s.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(d=e==null?void 0:e.created_by_user)==null?void 0:d.role})]})]}):s.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),s.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),s.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(a,{variant:"p",component:"p",fontWeight:500,children:_(e==null?void 0:e.created_at_datetime)}),s.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:j(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var t,n,o,l,d;return s.jsx(s.Fragment,{children:e!=null&&e.last_modified_datetime?s.jsxs(i,{sx:{flexDirection:"row",gap:2},children:[s.jsx(i,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?s.jsxs(s.Fragment,{children:[s.jsx(y,{alt:(t=e==null?void 0:e.last_modified_by_user)==null?void 0:t.username,src:`${f}/users/${(n=e==null?void 0:e.last_modified_by_user)==null?void 0:n.id}/avatar?size=80`,name:(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.username}),s.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(a,{variant:"p",component:"p",fontWeight:500,children:(l=e==null?void 0:e.last_modified_by_user)==null?void 0:l.username}),s.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.role})]})]}):s.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),s.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),s.jsxs(i,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(a,{variant:"p",component:"p",fontWeight:500,children:_(e==null?void 0:e.last_modified_datetime)}),s.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:j(e==null?void 0:e.last_modified_datetime)})]})]}):s.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>s.jsx(z,{mode:"custom",customButton:s.jsx(L,{title:"Mais opções",sx:{margin:-1},children:s.jsx(B,{children:s.jsx(G,{})})}),children:s.jsx(F,{buttons:[{label:"Editar",icon:s.jsx(J,{fontSize:"small"}),onClick:()=>M(e)},...b!=="Funcionário"?[{label:"Eliminar",icon:s.jsx(W,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>S(e==null?void 0:e.id)}]:[]]})})}],[]);return s.jsx($,{elevation:1,children:s.jsxs(k,{sx:{marginTop:3},children:[s.jsx(P,{isLoading:C,LoadingComponent:s.jsx(U,{mode:"datatable"}),LoadedComponent:s.jsx(N,{mode:"datatable",data:g??[],columns:O})}),s.jsx(Z,{entryAccessory:m.entryAccessory,open:m.isOpen,onClose:R}),s.jsx(q,{mode:"delete",title:"Eliminar Acessório da Entrada",open:c.isOpen,onClose:r,onSubmit:D,description:"Tem a certeza que deseja eliminar este acessório da entrada?",subDescription:"Ao eliminar este acessório da entrada, os dados serão removidos de forma permanente."})]})})};export{te as default};
