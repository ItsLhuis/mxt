import{r as c,j as s,S as n,b7 as T,h as t,aV as u,aW as f,aE as _,aM as h,aN as b,aF as O,aP as z,ag as L,aQ as B,aG as W,aX as F,aY as j,f as $,B as k,aZ as P,a_ as N,aK as V,a$ as q,aj as G,s as y}from"./index-DJpfvod0.js";import{u as K}from"./useRepair-DQBibyZW.js";import{R as Q}from"./List-BlAMr6q2.js";import{E as X}from"./Edit-CSDBMvJz.js";import"./repair-CTbFyE7G.js";import"./Container-C0eSQIXe.js";import"./Add-Dwyl4Jrm.js";const te=()=>{const{findAllInterventionAccessoriesUsed:A,deleteInterventionAccessoryUsed:U}=K(),{data:g,isLoading:I}=A,[p,v]=c.useState({isOpen:!1,interventionAccessoryUsed:null}),C=e=>{v({isOpen:!0,interventionAccessoryUsed:e})},E=()=>{v({isOpen:!1,interventionAccessoryUsed:null})},[m,x]=c.useState({isOpen:!1,interventionAccessoryUsedId:null}),D=e=>{x({isOpen:!0,interventionAccessoryUsedId:e})},o=()=>{x({isOpen:!1,interventionAccessoryUsedId:null})},M=()=>new Promise((e,i)=>{m.interventionAccessoryUsedId?U.mutateAsync({interventionAccessoryUsedId:m.interventionAccessoryUsedId}).then(()=>{G("Acessório da intervenção eliminado com sucesso!"),o(),e()}).catch(a=>{if(a.error.code==="REP-020"){o(),y("Este acessório da intervenção está associado a uma ou mais reparações e não pode ser eliminado!",{duration:6e3}),i();return}o(),y("Erro ao eliminar acessório da intervenção"),i()}):(o(),i())}),R=c.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>s.jsxs(n,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&s.jsx(T,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,a,r,d,l;return s.jsx(s.Fragment,{children:s.jsxs(n,{sx:{flexDirection:"row",gap:2},children:[s.jsx(n,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?s.jsxs(s.Fragment,{children:[s.jsx(u,{alt:(i=e==null?void 0:e.created_by_user)==null?void 0:i.username,src:`${f}/users/${(a=e==null?void 0:e.created_by_user)==null?void 0:a.id}/avatar?size=80`,name:(r=e==null?void 0:e.created_by_user)==null?void 0:r.username}),s.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(d=e==null?void 0:e.created_by_user)==null?void 0:d.username}),s.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(l=e==null?void 0:e.created_by_user)==null?void 0:l.role})]})]}):s.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),s.jsx(_,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),s.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(t,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.created_at_datetime)}),s.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,a,r,d,l;return s.jsx(s.Fragment,{children:e!=null&&e.last_modified_datetime?s.jsxs(n,{sx:{flexDirection:"row",gap:2},children:[s.jsx(n,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?s.jsxs(s.Fragment,{children:[s.jsx(u,{alt:(i=e==null?void 0:e.last_modified_by_user)==null?void 0:i.username,src:`${f}/users/${(a=e==null?void 0:e.last_modified_by_user)==null?void 0:a.id}/avatar?size=80`,name:(r=e==null?void 0:e.last_modified_by_user)==null?void 0:r.username}),s.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.username}),s.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(l=e==null?void 0:e.last_modified_by_user)==null?void 0:l.role})]})]}):s.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),s.jsx(_,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),s.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[s.jsx(t,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.last_modified_datetime)}),s.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.last_modified_datetime)})]})]}):s.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>s.jsx(O,{mode:"custom",customButton:s.jsx(z,{title:"Mais opções",sx:{margin:-1},children:s.jsx(L,{children:s.jsx(B,{})})}),children:s.jsx(W,{buttons:[{label:"Editar",icon:s.jsx(X,{fontSize:"small"}),onClick:()=>C(e)},{label:"Eliminar",icon:s.jsx(F,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>D(e==null?void 0:e.id)}]})})}],[]),S=c.useMemo(()=>[{id:"name",label:"Acessório da intervenção"},{id:"created_by_user.username",label:"Criado por"},{id:"created_at_datetime",label:"Data de criação",formatter:e=>e?j(e):""},{id:"last_modified_by_user.username",label:"Modificado pela última vez por"},{id:"last_modified_datetime",label:"Última data de modificação",formatter:e=>e?j(e):""}],[]);return s.jsx($,{elevation:1,children:s.jsxs(k,{sx:{marginTop:3},children:[s.jsx(P,{isLoading:I,LoadingComponent:s.jsx(N,{mode:"datatable"}),LoadedComponent:s.jsx(V,{mode:"datatable",data:g??[],columns:R,exportFileName:"acessorios_intervencao_reparacao",exportColumns:S})}),s.jsx(Q,{interventionAccessoryUsed:p.interventionAccessoryUsed,open:p.isOpen,onClose:E}),s.jsx(q,{mode:"delete",title:"Eliminar Acessório da Intervenção",open:m.isOpen,onClose:o,onSubmit:M,description:"Tem a certeza que deseja eliminar este acessório da intervenção?",subDescription:"Ao eliminar este acessório da intervenção, os dados serão removidos de forma permanente."})]})})};export{te as default};
