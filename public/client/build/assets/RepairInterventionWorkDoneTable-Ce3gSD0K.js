import{e as S,r as p,j as n,S as a,aN as z,h as t,aZ as v,a_ as f,a$ as h,aE as _,aF as b,ax as T,aH as O,aj as L,ay as A,b0 as B,f as F,B as $,aM as P,b1 as U,aC as N,b2 as q,ab as H,s as j}from"./index-C9HasOiM.js";import{u as V}from"./useRepair-Cho1bqHB.js";import{R as Z}from"./List-BcH7lss6.js";import{M as G}from"./MoreVert-CDz2P5kD.js";import{E as J}from"./Edit-CYRFZ1bJ.js";import"./repair-DgMqRd6F.js";import"./Container-B2tOqq2a.js";import"./Add-Hwv7pAxz.js";const ie=()=>{const{role:D}=S(),{findAllInterventionWorksDone:W,deleteInterventionWorkDone:k}=V(),{data:g,isLoading:I}=W,[m,u]=p.useState({isOpen:!1,interventionWorkDone:null}),y=e=>{u({isOpen:!0,interventionWorkDone:e})},C=()=>{u({isOpen:!1,interventionWorkDone:null})},[c,x]=p.useState({isOpen:!1,interventionWorkDoneId:null}),E=e=>{x({isOpen:!0,interventionWorkDoneId:e})},s=()=>{x({isOpen:!1,interventionWorkDoneId:null})},R=()=>new Promise((e,i)=>{c.interventionWorkDoneId?k.mutateAsync({interventionWorkDoneId:c.interventionWorkDoneId}).then(()=>{H("Trabalho realizado eliminado com sucesso!"),s(),e()}).catch(o=>{if(o.error.code==="REP-017"){s(),j("Este trabalho realizado está associado a uma ou mais reparações e não pode ser eliminado!",{duration:6e3}),i();return}s(),j("Erro ao eliminar trabalho realizado"),i()}):(s(),i())}),M=p.useMemo(()=>[{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>n.jsxs(a,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&n.jsx(z,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,o,r,l,d;return n.jsx(n.Fragment,{children:n.jsxs(a,{sx:{flexDirection:"row",gap:2},children:[n.jsx(a,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?n.jsxs(n.Fragment,{children:[n.jsx(v,{alt:(i=e==null?void 0:e.created_by_user)==null?void 0:i.username,src:`${f}/users/${(o=e==null?void 0:e.created_by_user)==null?void 0:o.id}/avatar?size=80`,name:(r=e==null?void 0:e.created_by_user)==null?void 0:r.username}),n.jsxs(a,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[n.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(l=e==null?void 0:e.created_by_user)==null?void 0:l.username}),n.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(d=e==null?void 0:e.created_by_user)==null?void 0:d.role})]})]}):n.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),n.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),n.jsxs(a,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[n.jsx(t,{variant:"p",component:"p",fontWeight:500,children:_(e==null?void 0:e.created_at_datetime)}),n.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,o,r,l,d;return n.jsx(n.Fragment,{children:e!=null&&e.last_modified_datetime?n.jsxs(a,{sx:{flexDirection:"row",gap:2},children:[n.jsx(a,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?n.jsxs(n.Fragment,{children:[n.jsx(v,{alt:(i=e==null?void 0:e.last_modified_by_user)==null?void 0:i.username,src:`${f}/users/${(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.id}/avatar?size=80`,name:(r=e==null?void 0:e.last_modified_by_user)==null?void 0:r.username}),n.jsxs(a,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[n.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(l=e==null?void 0:e.last_modified_by_user)==null?void 0:l.username}),n.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.role})]})]}):n.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),n.jsx(h,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),n.jsxs(a,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[n.jsx(t,{variant:"p",component:"p",fontWeight:500,children:_(e==null?void 0:e.last_modified_datetime)}),n.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:b(e==null?void 0:e.last_modified_datetime)})]})]}):n.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>n.jsx(T,{mode:"custom",customButton:n.jsx(O,{title:"Mais opções",sx:{margin:-1},children:n.jsx(L,{children:n.jsx(G,{})})}),children:n.jsx(A,{buttons:[{label:"Editar",icon:n.jsx(J,{fontSize:"small"}),onClick:()=>y(e)},...D!=="Funcionário"?[{label:"Eliminar",icon:n.jsx(B,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>E(e==null?void 0:e.id)}]:[]]})})}],[]);return n.jsx(F,{elevation:1,children:n.jsxs($,{sx:{marginTop:3},children:[n.jsx(P,{isLoading:I,LoadingComponent:n.jsx(U,{mode:"datatable"}),LoadedComponent:n.jsx(N,{mode:"datatable",data:g??[],columns:M})}),n.jsx(Z,{interventionWorkDone:m.interventionWorkDone,open:m.isOpen,onClose:C}),n.jsx(q,{mode:"delete",title:"Eliminar Trabalho Realizado",open:c.isOpen,onClose:s,onSubmit:R,description:"Tem a certeza que deseja eliminar este trabalho realizado?",subDescription:"Ao eliminar este trabalho realizado, os dados serão removidos de forma permanente."})]})})};export{ie as default};
