import{d as k,r as w,j as e,S as s,f as A,H as B,aB as R,aZ as T,b6 as F,F as y,b1 as P,T as M,af as O,aP as $,ag as H,bg as V,ba as W,B as z,L as K,a$ as Z,aL as G,h as u,aE as J,b7 as q}from"./index-DJpfvod0.js";import{u as Q,C as x,t as U}from"./index-o_NukjCy.js";import{r as X}from"./repair-LpirZ2QJ.js";import{u as Y}from"./useEquipment-c2-M7uo4.js";import{u as _}from"./useRepair-DQBibyZW.js";import{D as ee}from"./DatePicker-Bd1MXzbJ.js";import"./repair-CTbFyE7G.js";import"./Tabs-C4Yd6ASD.js";const de=()=>{var b;const C=k(),{control:l,handleSubmit:S,setValue:D,formState:{errors:r}}=Q({resolver:U(X)}),[t,d]=w.useState({isOpen:!1,equipment:{id:null,clientName:"",typeName:"",brandName:"",modelName:""}}),h=()=>{d(a=>({...a,isOpen:!0}))},I=()=>{d(a=>({...a,isOpen:!1}))},E=(a,n,m,p,i)=>{d({equipment:{id:a,clientName:n,typeName:m,brandName:p,modelName:i}}),D("equipmentId",a)},{findAllEquipments:g}=Y(),{createNewRepair:j,findAllRepairStatuses:f}=_(),N=async a=>{await j.mutateAsync({...a,entryDescription:a.entryDescription===""?null:a.entryDescription}).then(()=>C("/repair/list"))};return e.jsxs(e.Fragment,{children:[e.jsx("form",{onSubmit:S(N),children:e.jsx(s,{sx:{marginTop:3,gap:3},children:e.jsxs(A,{elevation:1,children:[e.jsx(B,{title:"Detalhes",description:"Estado, equipamento, data da entrada,... da reparação",icon:e.jsx(R,{})}),e.jsxs(s,{sx:{padding:3,gap:2},children:[e.jsx(T,{isLoading:f.isLoading,LoadingComponent:e.jsx(F,{variant:"rounded",width:"100%",height:52}),LoadedComponent:e.jsx(y,{fullWidth:!0,children:e.jsx(x,{name:"statusId",control:l,defaultValue:"",render:({field:a})=>{var i,v;const n=f.data??[],m=["",...n.map(o=>o.name)],p=((i=n.find(o=>o.id===a.value))==null?void 0:i.name)||"";return e.jsx(P,{ref:a.ref,label:"Estado",data:m,value:p,onChange:o=>{const c=n.find(L=>L.name===o);a.onChange((c==null?void 0:c.id)||"")},error:!!r.statusId,helperText:(v=r.statusId)==null?void 0:v.message})}})})}),e.jsx(y,{fullWidth:!0,children:e.jsx(M,{label:"Equipamento",placeholder:"Selecione um equipamento",value:t.equipment.clientName?`${t.equipment.typeName} | ${t.equipment.brandName} ${t.equipment.modelName} (${t.equipment.clientName})`:"",onClick:h,InputProps:{readOnly:!0,startAdornment:e.jsx(O,{position:"start",children:e.jsx($,{children:e.jsx(H,{onClick:h,children:e.jsx(V,{})})})})},error:!!r.equipmentId,helperText:(b=r.equipmentId)==null?void 0:b.message})}),e.jsx(x,{name:"entryDatetime",control:l,defaultValue:new Date,render:({field:a})=>{var n;return e.jsx(ee,{label:"Data de entrada",value:a.value,onChange:a.onChange,error:!!r.entryDatetime,helperText:(n=r.entryDatetime)==null?void 0:n.message})}}),e.jsx(x,{name:"entryDescription",control:l,defaultValue:"",render:({field:a})=>e.jsx(W,{label:"Descrição da entrada",value:a.value,onChange:a.onChange,shouldImmediatelyRender:!0})}),e.jsx(z,{sx:{marginLeft:"auto",marginTop:1},children:e.jsx(K,{loading:j.isPending,type:"submit",variant:"contained",children:"Adicionar Reparação"})})]})]})})}),e.jsx(Z,{open:t.isOpen??!1,onClose:I,mode:"data",data:g.data??[],searchKeys:["client.name","type.name","brand.name","model.name"],isLoading:g.isLoading,title:"Equipamentos",placeholder:"Pesquise por um equipamento",buttonStructure:(a,n)=>e.jsx(G,{variant:"contained",color:"secondary",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"flex-start",padding:"16px !important",width:"100%",minHeight:"unset !important",border:2,borderColor:a.id===t.equipment.id?"var(--primary)":"var(--elevation-level3)",borderRadius:2,color:"var(--onSurface)",lineHeight:1.5,fontWeight:400,"&:hover":{borderColor:"var(--primary)"}},onClick:()=>{E(a.id,a.client.name,a.type.name,a.brand.name,a.model.name),n()},children:e.jsxs(s,{sx:{alignItems:"flex-start"},children:[e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1,marginBottom:1},children:[e.jsx(u,{variant:"h6",component:"h6",children:a.type.name}),e.jsx(J,{flexItem:!0,sx:{borderColor:"var(--outline)",opacity:.5,borderWidth:1}}),e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsxs(u,{variant:"h6",component:"h6",sx:{wordBreak:"break-all",textAlign:"start"},children:[a.brand.name," ",a.model.name]}),a.description&&e.jsx(q,{fontSize:"small",title:a.description})]})]}),e.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e.jsx(u,{variant:"p",component:"p",sx:{wordBreak:"break-all",textAlign:"start"},children:a.client.name}),a.client.description&&e.jsx(q,{fontSize:"small",title:a.client.description})]})]})})})]})};export{de as default};
