import{r,j as a,S as s,b7 as I,h as t,aV as f,aW as _,aE as b,aM as h,aN as j,aF as L,aP as B,ag as W,aQ as A,aG as F,aX as $,aY as v,f as k,B as U,aZ as N,a_ as P,aK as Q,a$ as R,aj as V,s as M}from"./index-QasZhORg.js";import{u as G}from"./useEquipment-WRg0P-gF.js";import{E as K}from"./List-wQddOfUW.js";import{E as X}from"./Edit-CaWpXbPs.js";import"./Container-C5Y6U86F.js";import"./Add-Bi3K8Nfu.js";const ae=()=>{const{findAllEquipmentModels:E,deleteEquipmentModel:g}=G(),{data:y,isLoading:C}=E,[p,u]=r.useState({isOpen:!1,model:null}),q=e=>{u({isOpen:!0,model:e})},D=()=>{u({isOpen:!1,model:null})},[c,x]=r.useState({isOpen:!1,modelId:null}),S=e=>{x({isOpen:!0,modelId:e})},n=()=>{x({isOpen:!1,modelId:null})},T=()=>new Promise((e,i)=>{c.modelId?g.mutateAsync({modelId:c.modelId}).then(()=>{V("Modelo eliminado com sucesso!"),n(),e()}).catch(l=>{if(l.error.code==="EQU-011"){n(),M("Este modelo está associado a um ou mais equipamentos e não pode ser eliminado!",{duration:6e3}),i();return}n(),M("Erro ao eliminar modelo"),i()}):(n(),i())}),O=r.useMemo(()=>[{id:"brand.name",label:"Marca",align:"left",sortable:!0},{id:"name",label:"Nome",align:"left",sortable:!0,renderComponent:({row:e})=>a.jsxs(s,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[e==null?void 0:e.name,(e==null?void 0:e.description)&&a.jsx(I,{fontSize:"small",title:e==null?void 0:e.description})]})},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,l,d,o,m;return a.jsx(a.Fragment,{children:a.jsxs(s,{sx:{flexDirection:"row",gap:2},children:[a.jsx(s,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.created_by_user?a.jsxs(a.Fragment,{children:[a.jsx(f,{alt:(i=e==null?void 0:e.created_by_user)==null?void 0:i.username,src:`${_}/users/${(l=e==null?void 0:e.created_by_user)==null?void 0:l.id}/avatar?size=80`,name:(d=e==null?void 0:e.created_by_user)==null?void 0:d.username}),a.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(o=e==null?void 0:e.created_by_user)==null?void 0:o.username}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(m=e==null?void 0:e.created_by_user)==null?void 0:m.role})]})]}):a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),a.jsx(b,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.created_at_datetime)}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:j(e==null?void 0:e.created_at_datetime)})]})]})})}},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:e})=>{var i,l,d,o,m;return a.jsx(a.Fragment,{children:e!=null&&e.last_modified_datetime?a.jsxs(s,{sx:{flexDirection:"row",gap:2},children:[a.jsx(s,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:e!=null&&e.last_modified_by_user?a.jsxs(a.Fragment,{children:[a.jsx(f,{alt:(i=e==null?void 0:e.last_modified_by_user)==null?void 0:i.username,src:`${_}/users/${(l=e==null?void 0:e.last_modified_by_user)==null?void 0:l.id}/avatar?size=80`,name:(d=e==null?void 0:e.last_modified_by_user)==null?void 0:d.username}),a.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:(o=e==null?void 0:e.last_modified_by_user)==null?void 0:o.username}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:(m=e==null?void 0:e.last_modified_by_user)==null?void 0:m.role})]})]}):a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),a.jsx(b,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),a.jsxs(s,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[a.jsx(t,{variant:"p",component:"p",fontWeight:500,children:h(e==null?void 0:e.last_modified_datetime)}),a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:j(e==null?void 0:e.last_modified_datetime)})]})]}):a.jsx(t,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})}},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:e})=>a.jsx(L,{mode:"custom",customButton:a.jsx(B,{title:"Mais opções",sx:{margin:-1},children:a.jsx(W,{children:a.jsx(A,{})})}),children:a.jsx(F,{buttons:[{label:"Editar",icon:a.jsx(X,{fontSize:"small"}),onClick:()=>q(e)},{label:"Eliminar",icon:a.jsx($,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>S(e==null?void 0:e.id)}]})})}],[]),z=r.useMemo(()=>[{id:"brand.name",label:"Marca"},{id:"name",label:"Modelo"},{id:"created_by_user.username",label:"Criado por"},{id:"created_at_datetime",label:"Data de criação",formatter:e=>e?v(e):""},{id:"last_modified_by_user.username",label:"Modificado pela última vez por"},{id:"last_modified_datetime",label:"Última data de modificação",formatter:e=>e?v(e):""}],[]);return a.jsx(k,{elevation:1,children:a.jsxs(U,{sx:{marginTop:3},children:[a.jsx(N,{isLoading:C,LoadingComponent:a.jsx(P,{mode:"datatable"}),LoadedComponent:a.jsx(Q,{mode:"datatable",data:y??[],columns:O,exportFileName:"modelos_equipamento",exportColumns:z})}),a.jsx(K,{model:p.model,open:p.isOpen,onClose:D}),a.jsx(R,{mode:"delete",title:"Eliminar Modelo",open:c.isOpen,onClose:n,onSubmit:T,description:"Tem a certeza que deseja eliminar este modelo?",subDescription:"Ao eliminar este modelo, os dados serão removidos de forma permanente."})]})})};export{ae as default};
