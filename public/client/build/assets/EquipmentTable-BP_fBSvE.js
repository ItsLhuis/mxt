import{f as b,j as e,u as W,S as I,r as s,Z as n,an as L,Y as a,au as l,av as r,aF as d,ab as O,ah as g,ai as C,ac as q,aw as V,aJ as k,aK as B,aH as R,B as c,ae as p,aA as y,a as U,ax as N,ay as P,aL as K}from"./index-BzXGUPkY.js";import{u as Q}from"./List-ulK7Am_n.js";import{f as m,a as x}from"./date-UO0O52K_.js";import{M as J}from"./MoreVert-DdwSIp8d.js";import{E as Y}from"./Edit-Djdsgm-9.js";import{C as Z,H as G}from"./History-CZxfx-C7.js";import"./Container-4S_WGgV-.js";import"./Add-C_HTBoeA.js";const X=b(e.jsx("path",{d:"M2 12.5C2 9.46 4.46 7 7.5 7H18c2.21 0 4 1.79 4 4s-1.79 4-4 4H9.5C8.12 15 7 13.88 7 12.5S8.12 10 9.5 10H17v2H9.41c-.55 0-.55 1 0 1H18c1.1 0 2-.9 2-2s-.9-2-2-2H7.5C5.57 9 4 10.57 4 12.5S5.57 16 7.5 16H17v2H7.5C4.46 18 2 15.54 2 12.5"}),"Attachment"),ee=b(e.jsx("path",{d:"M11.07 12.85c.77-1.39 2.25-2.21 3.11-3.44.91-1.29.4-3.7-2.18-3.7-1.69 0-2.52 1.28-2.87 2.34L6.54 6.96C7.25 4.83 9.18 3 11.99 3c2.35 0 3.96 1.07 4.78 2.41.7 1.15 1.11 3.3.03 4.9-1.2 1.77-2.35 2.31-2.97 3.45-.25.46-.35.76-.35 2.24h-2.89c-.01-.78-.13-2.05.48-3.15M14 20c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2"}),"QuestionMark"),te=b(e.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),ce=()=>{const S=W(),{role:v}=I(),{findAllEquipments:z}=Q(),{data:M,isLoading:F}=z,[H,_]=s.useState(!1),[o,j]=s.useState({url:"",name:"",size:"",type:""}),w=(i,u,f,h)=>{j({url:i,name:u,size:f,type:h}),_(!0)},D=()=>{_(!1),j({url:"",type:""})},A=s.useMemo(()=>[{id:"client.name",label:"Cliente",align:"left",sortable:!0,renderComponent:({row:i})=>e.jsxs(n,{sx:{flexDirection:"row",alignItems:"center",gap:1},children:[i.client.name,i.client.description&&e.jsx(L,{fontSize:"small",title:i.client.description,isHtml:!0})]})},{id:"type.name",label:"Tipo",align:"left",sortable:!0},{id:"brand.name",label:"Marca ",align:"left",sortable:!0},{id:"model.name",label:"Modelo",align:"left",sortable:!0},{id:"sn",label:"Número de série",align:"left",sortable:!0},{id:"created_by_user",visible:!1},{id:"created_at_datetime",label:"Criado por",align:"left",sortable:!0,renderComponent:({row:i})=>e.jsx(e.Fragment,{children:e.jsxs(n,{sx:{flexDirection:"row",gap:2},children:[e.jsx(n,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:i.created_by_user?e.jsxs(e.Fragment,{children:[e.jsx(l,{alt:i.created_by_user.username,src:`${r}/users/${i.created_by_user.id}/avatar?size=80`,name:i.created_by_user.username}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:i.created_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:i.created_by_user.role})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:m(i.created_at_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:x(i.created_at_datetime)})]})]})})},{id:"last_modified_by_user",visible:!1},{id:"last_modified_datetime",label:"Modificado pela última vez por",align:"left",sortable:!0,renderComponent:({row:i})=>e.jsx(e.Fragment,{children:i.last_modified_datetime?e.jsxs(n,{sx:{flexDirection:"row",gap:2},children:[e.jsx(n,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:i.last_modified_by_user?e.jsxs(e.Fragment,{children:[e.jsx(l,{alt:i.last_modified_by_user.username,src:`${r}/users/${i.last_modified_by_user.id}/avatar?size=80`,name:i.last_modified_by_user.username}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:i.last_modified_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:i.last_modified_by_user.role})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:m(i.last_modified_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:x(i.last_modified_datetime)})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Ainda não foi modificado"})})},{id:"more_options",align:"right",sortable:!1,renderComponent:({row:i})=>e.jsx(O,{mode:"custom",customButton:e.jsx(g,{title:"Mais opções",sx:{margin:-1},children:e.jsx(C,{children:e.jsx(J,{})})}),children:e.jsx(q,{buttons:[{label:"Editar",icon:e.jsx(Y,{fontSize:"small"}),onClick:()=>S(`/client/${i.id}`)},...v!=="Funcionário"?[{label:"Eliminar",icon:e.jsx(V,{fontSize:"small",color:"error"}),color:"error",divider:!0,onClick:()=>openDeleteClientModal(i.id)}]:[]]})})}],[]),T=s.useMemo(()=>({row:i})=>{const u=s.useMemo(()=>[{id:"file_mime_type",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsx(n,{sx:{alignItems:"flex-start"},children:t.file_mime_type==="application/pdf"?e.jsx(k,{fontSize:"medium",sx:{color:"rgb(223, 88, 84)"}}):t.file_mime_type.startsWith("image/")?e.jsx(B,{fontSize:"medium",sx:{color:"rgb(245, 128, 8)"}}):e.jsx(ee,{fontSize:"medium",sx:{color:"var(--outline)"}})})},{id:"original_filename",label:"Ficheiro",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsxs(n,{children:[e.jsx(a,{variant:"p",component:"p",children:t.original_filename}),e.jsx(a,{variant:"p",component:"p",sx:{color:"var(--outline)"},children:`${t.file_size<1048576?(t.file_size/1024).toFixed(2)+" Kb":(t.file_size/1048576).toFixed(2)+" Mb"}`})]})},{id:"uploaded_by_user",visible:!1},{id:"uploaded_at_datetime",label:"Carregado por",align:"left",sortable:!0,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:e.jsxs(n,{sx:{flexDirection:"row",gap:2},children:[e.jsx(n,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:t.uploaded_by_user?e.jsxs(e.Fragment,{children:[e.jsx(l,{alt:t.uploaded_by_user.username,src:`${r}/users/${t.uploaded_by_user.id}/avatar?size=80`,name:t.uploaded_by_user.username}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:t.uploaded_by_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:t.uploaded_by_user.role})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:m(t.uploaded_at_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:x(t.uploaded_at_datetime)})]})]})})},{id:"view_file",align:"right",sortable:!1,renderComponent:({row:t})=>e.jsx(g,{title:"Ver anexo",sx:{margin:-1},children:e.jsx(C,{onClick:()=>w(`${r}/equipments/${t.equipment_id}/attachments/${t.id}/${t.original_filename}`,t.original_filename,t.file_size,t.file_mime_type),children:e.jsx(te,{})})})}],[]),f=s.useMemo(()=>[{id:"type",label:"Atividade",align:"left",sortable:!0},{id:"responsible_user",label:"Responsável",align:"left",sortable:!1,renderComponent:({row:t})=>e.jsx(e.Fragment,{children:t.responsible_user?e.jsxs(n,{sx:{flexDirection:"row",gap:2},children:[e.jsxs(n,{sx:{flexDirection:"row",justifyContent:"center",alignItems:"center",gap:1},children:[e.jsx(l,{alt:t.responsible_user.username,src:`${r}/users/${t.responsible_user.id}/avatar?size=80`,name:t.responsible_user.username}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:t.responsible_user.username}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:t.responsible_user.role})]})]}),e.jsx(d,{sx:{borderColor:"var(--elevation-level5)",borderWidth:1}}),e.jsxs(n,{sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[e.jsx(a,{variant:"p",component:"p",fontWeight:500,children:m(t.created_at_datetime)}),e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:x(t.created_at_datetime)})]})]}):e.jsx(a,{variant:"p",component:"p",color:"var(--outline)",children:"Utilizador removido"})})}],[]),h=s.useMemo(()=>({row:t})=>{const E=s.useMemo(()=>[{id:"field",label:"Campo",align:"left",sortable:!0},{id:"before",label:"Antes",align:"left",sortable:!0},{id:"after",label:"Depois",align:"left",sortable:!0},{id:"changed",label:"Alterado",align:"left",sortable:!0,renderComponent:({row:$})=>e.jsx(e.Fragment,{children:$.changed?e.jsx(Z,{color:"success"}):e.jsx(R,{color:"error"})})}],[]);return e.jsx(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden",margin:3},children:e.jsx(p,{data:t.details??[],columns:E})})},[]);return e.jsxs(n,{sx:{margin:3,gap:3},children:[e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(y,{title:"Anexos",description:"Anexos do equipamento",icon:e.jsx(X,{})}),e.jsx(p,{mode:"datatable",data:i.attachments??[],columns:u})]}),v!=="Funcionário"&&e.jsxs(c,{sx:{border:"1px solid var(--elevation-level5)",borderRadius:2,overflow:"hidden"},children:[e.jsx(y,{title:"Histórico de Atividades",description:"Histórico de atividades sobre o equipamento",icon:e.jsx(G,{})}),e.jsx(p,{mode:"datatable",data:i.interactions_history??[],columns:f,ExpandableContentComponent:h})]})]})},[]);return e.jsx(U,{elevation:1,children:e.jsxs(c,{sx:{marginTop:3},children:[e.jsx(N,{isLoading:F,LoadingComponent:e.jsx(P,{mode:"datatable"}),LoadedComponent:e.jsx(p,{mode:"datatable",data:M??[],columns:A,ExpandableContentComponent:T})}),e.jsx(K,{open:H,onClose:D,file:o.url,fileName:o.name,fileSize:Number(o.size),fileType:o.type})]})})};export{ce as default};
